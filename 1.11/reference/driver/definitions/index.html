<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<meta name="author" content="">
<meta name="keyword" content="">

    <link rel="shortcut icon" href="/mongo-csharp-driver/2.0/img/favicon.png">

    <title>Definitions and Builders</title>

    <link rel="stylesheet" href="/mongo-csharp-driver/2.0/lib/bootstrap.css" type="text/css" />
<link rel="stylesheet" href="/mongo-csharp-driver/2.0/lib/font-awesome/css/font-awesome.min.css" type="text/css" />
<link rel="stylesheet" href="/mongo-csharp-driver/2.0/css/mongodb-docs.css" type="text/css" />
<link rel="stylesheet" href="/mongo-csharp-driver/2.0/css/overrides.css" type="text/css" />
<link rel="stylesheet" href="/mongo-csharp-driver/2.0/lib/highlight/styles/default.css" />


  </head>

  <body>
  
  <section id="container" class="">
      
      <header id="header-db" class="row" role="navigation">
  <div class="header-content">
    <div class="toggle-nav pull-left">
        <i class="fa fa-bars"></i>
        <div class="icon-reorder tooltips" data-original-title="Toggle Navigation" data-placement="bottom"></div>
    </div>
    
    <div class="logo pull-left">
      <a href="/mongo-csharp-driver/2.0/../">
        <img src="/mongo-csharp-driver/2.0/img/logo-mongodb-header.png", alt="MongoDB.org" />
      </a>
    </div>
    
    <div>
<div class="nav-items pull-right">
  <a href="https://university.mongodb.com" data-toggle="tooltip" data-placement="bottom" title="Try MongoDB in the browser">Try it Out</a>
  <a href="https://www.mongodb.com/try" data-toggle="tooltip" data-placement="bottom" title="Download MongoDB">Downloads</a>
  <a href="https://www.mongodb.com/community" data-toggle="tooltip" data-placement="bottom" title="Get involved with MongoDB">Community</a>
  <a href="https://www.mongodb.com/docs" data-toggle="tooltip" data-placement="bottom" title="The MongoDB Documentation">Docs</a>
  <a href="https://www.mongodb.com/blog" data-toggle="tooltip" data-placement="bottom" title="The MongoDB Blog">Blog</a>
</div>
</div>

  </div>
</header>

      

      
<aside id="sidebar" class="sidebar">
    <div class="ssidebar nav-collapse">
      <div class="ssidebarwrapper">
        <h3>
          <a class="index-link" href="/mongo-csharp-driver/2.0/../">MongoDB .NET Driver</a>
          <a class="version pull-right" href="/mongo-csharp-driver/2.0">2.0</a>
        </h3>

        
        <ul class="sidebar-menu">
          
          
          
          
          
          
          
          
          
          
          
          

          
          
            
            









  
    
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
    
      
    
  


          
            
            









  
    
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
    
      
    
  


          
            
            









  
    
    
      
      
        
        
        
        
        
        
        
        









  
    
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  
    
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
    
      
    
  


        
          
        
      
    
    
      
    
  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  
    
    
      
      
        
        
        
        
        
        
        
        









  
    
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
    
      
    
  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  
  
  
  
  
  
  
  

  
    
    
    
      
      
      
        
      
    
    
  
  


        
      
    
      
      
        
      
    
    
  


        
      
    
      
      
    
    
  


          
            
            









  


          

          

          
            
            
















<li class="toctree-l1 ">
  <a href="/mongo-csharp-driver/2.0/getting_started/" class="">
      <i class='fa fa-road'></i>
      <span>Getting Started</span>
      <span class="menu-arrow fa fa-angle-right"></span>
  </a>
    <ul >
        
        
        
        
















    <li class="toctree-l2">
    <a href="/mongo-csharp-driver/2.0/getting_started/connecting/">
        <i class='fa'></i>
        Connecting to the Server
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l2">
    <a href="/mongo-csharp-driver/2.0/getting_started/reading_and_writing/">
        <i class='fa'></i>
        Reading and Writing
    </a>
  </li>


        
        
    </ul>
  </li>


          
            
            
















<li class="toctree-l1 ">
  <a href="/mongo-csharp-driver/2.0/what_is_new/" class="">
      <i class='fa fa-star'></i>
      <span>What&#39;s New</span>
      <span class="menu-arrow fa fa-angle-right"></span>
  </a>
    <ul >
        
        
        
        
















    <li class="toctree-l2">
    <a href="/mongo-csharp-driver/2.0/upgrading/">
        <i class='fa'></i>
        Upgrading
    </a>
  </li>


        
        
    </ul>
  </li>


          
            
            













  




<li class="toctree-l1  current">
  <a href="/mongo-csharp-driver/2.0/reference/" class="">
      <i class='fa fa-book'></i>
      <span>Reference</span>
      <span class="menu-arrow fa fa-angle-down"></span>
  </a>
    <ul  class="current">
        
        
        
        
















<li class="toctree-l2 ">
  <a href="/mongo-csharp-driver/2.0/reference/bson/" class="">
      <i class='fa'></i>
      <span>BSON</span>
      
  </a>
    <ul >
        
        
        
        
















    <li class="toctree-l3">
    <a href="/mongo-csharp-driver/2.0/reference/bson/bson/">
        <i class='fa'></i>
        Reading and Writing BSON/JSON
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l3">
    <a href="/mongo-csharp-driver/2.0/reference/bson/bson_document/">
        <i class='fa'></i>
        BsonDocument
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l3">
    <a href="/mongo-csharp-driver/2.0/reference/bson/serialization/">
        <i class='fa'></i>
        Serialization
    </a>
  </li>


        
        
        
        
        
















<li class="toctree-l3 ">
  <a href="/mongo-csharp-driver/2.0/reference/bson/mapping/" class="">
      <i class='fa'></i>
      <span>Mapping Classes</span>
      
  </a>
    <ul >
        
        
        
        
















    <li class="toctree-l4">
    <a href="/mongo-csharp-driver/2.0/reference/bson/mapping/polymorphism/">
        <i class='fa'></i>
        Polymorphism
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l4">
    <a href="/mongo-csharp-driver/2.0/reference/bson/mapping/conventions/">
        <i class='fa'></i>
        Conventions
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l4">
    <a href="/mongo-csharp-driver/2.0/reference/bson/mapping/schema_changes/">
        <i class='fa'></i>
        Handling Schema Changes
    </a>
  </li>


        
        
    </ul>
  </li>


        
        
    </ul>
  </li>


        
        
        
        
        













  




<li class="toctree-l2  current">
  <a href="/mongo-csharp-driver/2.0/reference/driver/" class="">
      <i class='fa'></i>
      <span>Driver</span>
      
  </a>
    <ul  class="current">
        
        
        
        
















<li class="toctree-l3 ">
  <a href="/mongo-csharp-driver/2.0/reference/driver/connecting/" class="">
      <i class='fa'></i>
      <span>Connecting</span>
      
  </a>
    <ul >
        
        
        
        
















    <li class="toctree-l4">
    <a href="/mongo-csharp-driver/2.0/reference/driver/ssl/">
        <i class='fa'></i>
        SSL
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l4">
    <a href="/mongo-csharp-driver/2.0/reference/driver/authentication/">
        <i class='fa'></i>
        Authentication
    </a>
  </li>


        
        
    </ul>
  </li>


        
        
        
        
        













  




<li class="toctree-l3  current">
  <a href="/mongo-csharp-driver/2.0/reference/driver/definitions/" class="">
      <i class='fa'></i>
      <span>Definitions and Builders</span>
      
  </a>
    <ul  class="current">
        
        
        
        
















    <li class="toctree-l4">
    <a href="/mongo-csharp-driver/2.0/reference/driver/expressions/">
        <i class='fa'></i>
        Expressions
    </a>
  </li>


        
        
    </ul>
  </li>


        
        
        
        
        
















<li class="toctree-l3 ">
  <a href="/mongo-csharp-driver/2.0/reference/driver/crud/" class="">
      <i class='fa'></i>
      <span>CRUD Operations</span>
      
  </a>
    <ul >
        
        
        
        
















    <li class="toctree-l4">
    <a href="/mongo-csharp-driver/2.0/reference/driver/crud/reading/">
        <i class='fa'></i>
        Reading
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l4">
    <a href="/mongo-csharp-driver/2.0/reference/driver/crud/writing/">
        <i class='fa'></i>
        Writing
    </a>
  </li>


        
        
    </ul>
  </li>


        
        
    </ul>
  </li>


        
        
        
        
        
















    <li class="toctree-l2">
    <a href="/mongo-csharp-driver/2.0/reference/driver_core/">
        <i class='fa'></i>
        Driver Core
    </a>
  </li>


        
        
    </ul>
  </li>


          
            
            
















    <li class="toctree-l1">
    <a href="/mongo-csharp-driver/2.0/issues_help/">
        <i class='fa fa-life-ring'></i>
        Issues &amp; Help
    </a>
  </li>


          
        </ul>
        
    </div>
  </div>
  
</aside>






      
      <section id="main-content" class="content">
          <section class="main-column pull-left">
            <div class="document">
              <div class="documentwrapper">
                <div class="bodywrapper">
                  <div class="body">


   
<a class="edit-link" href="https://github.com/mongodb/mongo-csharp-driver/blob/master/docs/reference/content/reference%5cdriver%5cdefinitions.md" target="_blank" title="Edit reference\driver\definitions.md on GitHub"><i class="fa fa-pencil-square-o"></i></a>










<div class="bc">
<ul>
  
  
  
  
  <li><a href="/mongo-csharp-driver/2.0/reference/">Reference</a> <i class="fa fa-angle-right"></i></li>
  <li><a href="/mongo-csharp-driver/2.0/reference/driver/">Driver</a> <i class="fa fa-angle-right"></i></li>
  <li>Definitions and Builders</li>
</ul>
</div>




<h2 id="definitions-and-builders:ce6bd7650aa92e884a2bb6da9703168d">Definitions and Builders</h2>

<p>The driver has introduced a number of types related to the specification of filters, updates, projections, sorts, etc&hellip; These types are used throughout the <a href="/mongo-csharp-driver/2.0/reference/driver/crud/">API</a>. In addition, most of them have builders as well to aid in their creation.</p>

<h2 id="fields:ce6bd7650aa92e884a2bb6da9703168d">Fields</h2>

<p><a href="/mongo-csharp-driver/2.0/apidocs/html/T_MongoDB_Driver_FieldDefinition_1.htm
"><code>FieldDefinition&lt;TDocument&gt;</code></a> and <a href="/mongo-csharp-driver/2.0/apidocs/html/T_MongoDB_Driver_FieldDefinition_2.htm
"><code>FieldDefinition&lt;TDocument, TField&gt;</code></a> define how to get a field name. They are implicitly convertible from a string, so that you can simply pass the field name you&rsquo;d like.</p>

<p>For instance, with a <a href="/mongo-csharp-driver/2.0/apidocs/html/T_MongoDB_Bson_BsonDocument.htm
"><code>BsonDocument</code></a>, the following will be true:</p>

<pre><code class="language-csharp">// method definition
string GetFieldName&lt;TDocument&gt;(FieldDefinition&lt;TDocument&gt; field);

// invocation
var fieldName = GetFieldName&lt;BsonDocument&gt;(&quot;fun&quot;);

fieldName.Should().Be(&quot;fun&quot;);
</code></pre>

<p>However, if you are working with a <a href="/mongo-csharp-driver/2.0/reference/bson/mapping/">mapped class</a>, then 2 further options exist.</p>

<p>First, most locations that accept a <a href="/mongo-csharp-driver/2.0/apidocs/html/T_MongoDB_Driver_FieldDefinition_1.htm
"><code>FieldDefinition&lt;TDocument&gt;</code></a> or <a href="/mongo-csharp-driver/2.0/apidocs/html/T_MongoDB_Driver_FieldDefinition_2.htm
"><code>FieldDefinition&lt;TDocument, TField&gt;</code></a> will also have an overload (via extension method) that accepts a lambda expression. Given the following class definition marked with the <a href="/mongo-csharp-driver/2.0/apidocs/html/T_MongoDB_Bson_Serialization_Attributes_BsonElementAttribute.htm
"><code>BsonElementAttribute</code></a> instructing the use of a different field name:</p>

<pre><code class="language-csharp">class Person
{
    [BsonElement(&quot;fn&quot;)]
    public string FirstName { get; set; }

    [BsonElement(&quot;fn&quot;)]
    public string LastName { get; set; }
}
</code></pre>

<p>Then the following will be true.</p>

<pre><code class="language-csharp">// method definition
string GetFieldName&lt;TDocument&gt;(Expression&lt;Func&lt;TDocument, object&gt;&gt; field);

// invocation
var fieldName = GetFieldName&lt;Person&gt;(x =&gt; x.FirstName);

fieldName.Should().Be(&quot;fn&quot;);
</code></pre>

<p>In the same way, since we know the type of document, <code>Person</code> in this case, we can also translate fields names provided as a string.</p>

<pre><code class="language-csharp">// method definition
string GetFieldName&lt;TDocument&gt;(FieldDefinition&lt;TDocument&gt; field);

// invocation
var fieldName = GetFieldName&lt;Person&gt;(&quot;FirstName&quot;);

fieldName.Should().Be(&quot;fn&quot;);
</code></pre>

<p>Finally, we don&rsquo;t validate that the provided string exists as a mapped field, so it is still possible to provide a field that hasn&rsquo;t been mapped:</p>

<pre><code class="language-csharp">// method definition
string GetFieldName&lt;TDocument&gt;(FieldDefinition&lt;TDocument&gt; field);

// invocation
var fieldName = GetFieldName&lt;Person&gt;(&quot;fn&quot;);

fieldName.Should().Be(&quot;fn&quot;);
</code></pre>

<h2 id="filters:ce6bd7650aa92e884a2bb6da9703168d">Filters</h2>

<p><a href="/mongo-csharp-driver/2.0/apidocs/html/T_MongoDB_Driver_FilterDefinition_1.htm
"><code>FilterDefinition&lt;TDocument&gt;</code></a> defines a filter. It is implicity convertible from both a JSON string as well as a <a href="/mongo-csharp-driver/2.0/apidocs/html/T_MongoDB_Bson_BsonDocument.htm
"><code>BsonDocument</code></a>. Given the following method, all the following are valid:</p>

<pre><code class="language-csharp">// method definition
BsonDocument Filter(FilterDefinition&lt;BsonDocument&gt; filter);

// invocation
var doc = Filter(&quot;{ x: 1 }&quot;);
doc.ToJson().Should().Be(&quot;{ x: 1 }&quot;);

var doc = Filter(new BsonDocument(&quot;x&quot;, 1));
doc.ToJson().Should().Be(&quot;{ x: 1 }&quot;);
</code></pre>

<h3 id="filter-definition-builder:ce6bd7650aa92e884a2bb6da9703168d">Filter Definition Builder</h3>

<p><em>See the <a href="https://github.com/mongodb/mongo-csharp-driver/blob/master/src/MongoDB.Driver.Tests/FilterDefinitionBuilderTests.cs
">tests</a> for examples.</em></p>

<p>The <a href="/mongo-csharp-driver/2.0/apidocs/html/T_MongoDB_Driver_FilterDefinitionBuilder_1.htm
"><code>FilterDefinitionBuilder&lt;TDocument&gt;</code></a> provides a nice API for building up both simple and complex <a href="https://www.mongodb.com/docs/manual/reference/operator/query/
">MongoDB queries</a>.</p>

<p>For example, to build up the filter <code>{ x: 10, y: { $lt: 20 } }</code>, the following calls are all comparable.</p>

<pre><code class="language-csharp">var builder = Builders&lt;BsonDocument&gt;.Filter;
var filter = builder.Eq(&quot;x&quot;, 10) &amp; builder.Lt(&quot;y&quot;, 20);
</code></pre>

<p><div class="admonition note">
<h5 class="admonition-title">Note</h5>
Note that the <code>&amp;</code> operator is overloaded. Other overloaded operators include the <code>|</code> operator for &ldquo;or&rdquo; and the <code>!</code> operator for &ldquo;not&rdquo;.
</div>
</p>

<p>Given the following class:</p>

<pre><code class="language-csharp">class Widget
{
    [BsonElement(&quot;x&quot;)]
    public int X { get; set; }

    [BsonElement(&quot;y&quot;)]
    public int Y { get; set; }
}
</code></pre>

<p>We can achieve the same result in the typed variant:</p>

<pre><code class="language-csharp">var builder = Builders&lt;Widget&gt;.Filter;
var filter = builder.Eq(x =&gt; x.X, 10) &amp; builder.Lt(x =&gt; x.Y, 20);

// or

var filter = builder.Eq(&quot;X&quot;, 10) &amp; builder.Lt(&quot;Y&quot;, 20);

// or

var filter = builder.Eq(&quot;x&quot;, 10) &amp; builder.Lt(&quot;y&quot;, 20);
</code></pre>

<p>Or via a lambda expression:</p>

<pre><code class="language-csharp">var filter = Builders&lt;Widget&gt;.Filter.Where(x =&gt; x.X == 10 &amp;&amp; x.Y &lt; 20);
</code></pre>

<p>For more information on valid lambda expressions, see the <a href="/mongo-csharp-driver/2.0/reference/driver/expressions/">expressions documentation</a>.</p>

<h4 id="array-operators:ce6bd7650aa92e884a2bb6da9703168d">Array Operators</h4>

<p>When using entities with properties or fields that serialize to arrays, you can use the methods prefixed with &ldquo;Any&rdquo; to compare the entire array against a single item.</p>

<p>Given the following class:</p>

<pre><code class="language-csharp">public class Post
{
    public IEnumerable&lt;string&gt; Tags { get; set; }
}
</code></pre>

<p>To see if any of the tags equals &ldquo;mongodb&rdquo;:</p>

<pre><code class="language-csharp">var filter = Builders&lt;Post&gt;.Filter.AnyEq(x =&gt; x.Tags, &quot;mongodb&quot;);

// This will NOT compile:
// var filter = Builders&lt;Post&gt;.Filter.Eq(x =&gt; x.Tags, &quot;mongodb&quot;);
</code></pre>

<h2 id="pipelines:ce6bd7650aa92e884a2bb6da9703168d">Pipelines</h2>

<p>A pipeline definition defines an entire aggregation pipeline. It is implicitly convertible from a <a href="/mongo-csharp-driver/2.0/apidocs/html/T_MongoDB_Bson_BsonDocument.htm
"><code>List&lt;BsonDocument&gt;</code></a>, a <a href="/mongo-csharp-driver/2.0/apidocs/html/T_MongoDB_Bson_BsonDocument.htm
"><code>BsonDocument[]</code></a>, a <a href="/mongo-csharp-driver/2.0/apidocs/html/T_MongoDB_Driver_IPipelineStageDefinition.htm
"><code>List&lt;IPipelineStageDefinition&gt;</code></a> , and a <a href="/mongo-csharp-driver/2.0/apidocs/html/T_MongoDB_Driver_IPipelineStageDefinition.htm
"><code>IPipelineStageDefinition[]</code></a>.</p>

<p>For example:</p>

<pre><code class="language-csharp">PipelineDefinition pipeline = new BsonDocument[] 
{
    new BsonDocument { { &quot;$match&quot;, new BsonDocument(&quot;x&quot;, 1) } },
    new BsonDocument { { &quot;$sort&quot;, new BsonDocument(&quot;y&quot;, 1) } }
};
</code></pre>

<p><div class="admonition note">
<h5 class="admonition-title">Note</h5>
<p>There is no builder for a PipelineDefinition. In most cases, the <a href="/mongo-csharp-driver/2.0/apidocs/html/T_MongoDB_Driver_IAggregateFluent_1.htm"><code>IAggregateFluent&lt;TDocument&gt;</code></a> interface would be used which is returned from the <a href="/mongo-csharp-driver/2.0/apidocs/html/M_MongoDB_Driver_IMongoCollectionExtensions_Aggregate__1.htm"><code>IMongoCollection&lt;TDocument&gt;.Aggregate</code></a> method.</p>

</div>
</p>

<h2 id="projections:ce6bd7650aa92e884a2bb6da9703168d">Projections</h2>

<p>There are two forms of a projection definition, one where the type of the projection is known (<a href="/mongo-csharp-driver/2.0/apidocs/html/T_MongoDB_Driver_ProjectionDefinition_2.htm
"><code>ProjectionDefinition&lt;TDocument, TProjection&gt;</code></a>) and one where the type of the projection is not yet known (<a href="/mongo-csharp-driver/2.0/apidocs/html/T_MongoDB_Driver_ProjectionDefinition_1.htm
"><code>ProjectionDefinition&lt;TDocument&gt;</code></a>). The latter, while implicitly convertible to the first, is merely used as a building block. The <a href="/mongo-csharp-driver/2.0/reference/driver/crud/">high-level APIs</a> that take a projection will always take the former. This is because, when determining how to handle a projection client-side, it is not enough to know what fields and transformations will take place. It also requires that we know how to interpret the projected shape as a .NET type. Since the driver allows you to work with custom classes, it is imperative that any projection also include the &ldquo;interpretation instructions&rdquo; for projecting into a custom class.</p>

<h3 id="projection-definition-builder:ce6bd7650aa92e884a2bb6da9703168d">Projection Definition Builder</h3>

<p><em>See the <a href="https://github.com/mongodb/mongo-csharp-driver/blob/master/src/MongoDB.Driver.Tests/ProjectionDefinitionBuilderTests.cs
">tests</a> for examples.</em></p>

<p>The <a href="/mongo-csharp-driver/2.0/apidocs/html/T_MongoDB_Driver_ProjectionDefinitionBuilder_1.htm
"><code>ProjectionDefinitionBuilder&lt;TDocument&gt;</code></a> exists to make it easier to build up projections in MongoDB&rsquo;s syntax. To render the projection <code>{ x: 1, y: 1, _id: 0 }</code>, the following should be done:</p>

<pre><code class="language-csharp">var projection = Builders&lt;BsonDocument&gt;.Projection.Include(&quot;x&quot;).Include(&quot;y&quot;).Exclude(&quot;_id&quot;);
</code></pre>

<p>Using the <code>Widget</code> class:</p>

<pre><code class="language-csharp">class Widget
{
    public ObjectId Id { get; set; }

    [BsonElement(&quot;x&quot;)]
    public int X { get; set; }

    [BsonElement(&quot;y&quot;)]
    public int Y { get; set; }
}
</code></pre>

<p>We can render the same projection in a couple of ways:</p>

<pre><code class="language-csharp">var projection = Builders&lt;Widget&gt;.Projection.Include(&quot;X&quot;).Include(&quot;Y&quot;).Exclude(&quot;Id&quot;);

// or

var projection = Builders&lt;Widget&gt;.Projection.Include(&quot;x&quot;).Include(&quot;y&quot;).Exclude(&quot;_id&quot;);

// or

var projection = Builders&lt;Widget&gt;.Projection.Include(x =&gt; x.X).Include(x =&gt; x.Y).Exclude(x =&gt; x.Id);

// or

var projection = Builders&lt;Widget&gt;.Projection.Expression(x =&gt; new { X = x.X, Y = x.Y });
</code></pre>

<p>This last projection where we&rsquo;ve used the <a href="/mongo-csharp-driver/2.0/apidocs/html/M_MongoDB_Driver_ProjectionDefinitionBuilder_1_Expression__1.htm
"><code>Expression</code></a> method is subtly different as is explained below, and its return type is a (<a href="/mongo-csharp-driver/2.0/apidocs/html/T_MongoDB_Driver_ProjectionDefinition_2.htm
"><code>ProjectionDefinition&lt;TDocument, TProjection&gt;</code></a>) as opposed to the others which return a (<a href="/mongo-csharp-driver/2.0/apidocs/html/T_MongoDB_Driver_ProjectionDefinition_1.htm
"><code>ProjectionDefinition&lt;TDocument&gt;</code></a>).</p>

<h4 id="lambda-expressions:ce6bd7650aa92e884a2bb6da9703168d">Lambda Expressions</h4>

<p>The driver supports using expression trees to render projections. The same expression tree will sometimes render differently when used in a Find operation versus when used in an Aggregate operation. Inherently, a lambda expression contains all the information necessary to form both the projection on the server as well as the client-side result and requires no further information.</p>

<h5 id="find:ce6bd7650aa92e884a2bb6da9703168d">Find</h5>

<p><em>See the <a href="https://github.com/mongodb/mongo-csharp-driver/blob/master/src/MongoDB.Driver.Tests/Linq/Translators/FindProjectionTranslatorTests.cs
">tests</a> for examples.</em></p>

<p>When a Find projection is defined using a lambda expression, it is run client-side. The driver inspects the lambda expression to determine which fields are referenced and automatically constructs a server-side projection to return only those fields.</p>

<p>Given the following class:</p>

<pre><code class="language-csharp">class Widget
{
    public ObjectId Id { get; set; }

    [BsonElement(&quot;x&quot;)]
    public int X { get; set; }

    [BsonElement(&quot;y&quot;)]
    public int Y { get; set; }
}
</code></pre>

<p>The following lambda expressions will all result in the projection <code>{ x: 1, y: 1, _id: 0 }</code>. This is because we inspect the expression tree to discover all the fields that are used and tell the server to include them. We then run the lambda expression client-side. As such, Find projections support virtually the entire breadth of the C# language.</p>

<pre><code class="language-csharp">var projection = Builders&lt;Widget&gt;.Projection.Expression(x =&gt; new { X = x.X, Y = x.Y });

var projection = Builders&lt;Widget&gt;.Projection.Expression(x =&gt; new { Sum = x.X + x.Y });

var projection = Builders&lt;Widget&gt;.Projection.Expression(x =&gt; new { Avg = (x.X + x.Y) / 2 });

var projection = Builders&lt;Widget&gt;.Projection.Expression(x =&gt; (x.X + x.Y) / 2);
</code></pre>

<p>The <code>_id</code> field is excluded automatically when we know for certain that it isn&rsquo;t necessary, as is the case in all the above examples.</p>

<h5 id="aggregate:ce6bd7650aa92e884a2bb6da9703168d">Aggregate</h5>

<p><em>See the <a href="https://github.com/mongodb/mongo-csharp-driver/blob/master/src/MongoDB.Driver.Tests/Linq/Translators/AggregateProjectionTranslatorTests_Project.cs
">tests</a> for examples.</em></p>

<p>When an aggregate projection is defined using a lambda expression, a majority of the <a href="https://www.mongodb.com/docs/manual/reference/operator/aggregation/#expression-operators
">aggregation expression operators</a> are supported and translated. Unlike a project for Find, no part of the lambda expression is run client-side. This means that all expressions in a projection for the <a href="https://www.mongodb.com/docs/manual/core/aggregation-pipeline/
">Aggregation Framework</a> must be expressible on the server.</p>

<h5 id="grouping:ce6bd7650aa92e884a2bb6da9703168d">Grouping</h5>

<p><em>See the <a href="https://github.com/mongodb/mongo-csharp-driver/blob/master/src/MongoDB.Driver.Tests/Linq/Translators/AggregateProjectionTranslatorTests_Group.cs
">tests</a> for examples.</em></p>

<p>A projection is also used when performing grouping in the <a href="https://www.mongodb.com/docs/manual/core/aggregation-pipeline/
">Aggregation Framework</a>. In addition to the expression operators used in an aggregate projection, the <a href="https://www.mongodb.com/docs/manual/reference/operator/aggregation/group/#accumulator-operator
">aggregation accumulator operators</a> are also supported.</p>

<h2 id="sorts:ce6bd7650aa92e884a2bb6da9703168d">Sorts</h2>

<p><a href="/mongo-csharp-driver/2.0/apidocs/html/T_MongoDB_Driver_SortDefinition_1.htm
"><code>SortDefinition&lt;TDocument&gt;</code></a> defines how to render a valid sort document. It is implicity convertible from both a JSON string as well as a <a href="/mongo-csharp-driver/2.0/apidocs/html/T_MongoDB_Bson_BsonDocument.htm
"><code>BsonDocument</code></a>. Given the following method, all the following are valid:</p>

<pre><code class="language-csharp">// method definition
BsonDocument Sort(SortDefinition&lt;BsonDocument&gt; filter);

// invocation
var doc = Sort(&quot;{ x: 1 }&quot;);
doc.ToJson().Should().Be(&quot;{x : 1 }&quot;);

var doc = Sort(new BsonDocument(&quot;x&quot;, 1));
doc.ToJson().Should().Be(&quot;{ x: 1 }&quot;);
</code></pre>

<h3 id="sort-definition-builder:ce6bd7650aa92e884a2bb6da9703168d">Sort Definition Builder</h3>

<p><em>See the <a href="https://github.com/mongodb/mongo-csharp-driver/blob/master/src/MongoDB.Driver.Tests/SortDefinitionBuilderTests.cs
">tests</a> for examples.</em></p>

<p>The <a href="/mongo-csharp-driver/2.0/apidocs/html/T_MongoDB_Driver_SortDefinitionBuilder_1.htm
"><code>SortDefinitionBuilder&lt;TDocument&gt;</code></a> provides a nice API for building up <a href="https://www.mongodb.com/docs/manual/reference/method/cursor.sort/
">MongoDB sort syntax</a>.</p>

<p>For example, to build up the sort <code>{ x: 1, y: -1 }</code>, do the following:</p>

<pre><code class="language-csharp">var builder = Builders&lt;BsonDocument&gt;.Sort;
var sort = builder.Ascending(&quot;x&quot;).Descending(&quot;y&quot;);
</code></pre>

<p>Given the following class:</p>

<pre><code class="language-csharp">class Widget
{
    [BsonElement(&quot;x&quot;)]
    public int X { get; set; }

    [BsonElement(&quot;y&quot;)]
    public int Y { get; set; }
}
</code></pre>

<p>We can achieve the same result in the typed variant:</p>

<pre><code class="language-csharp">var builder = Builders&lt;Widget&gt;.Sort;
var sort = builder.Ascending(x =&gt; x.X).Descending(x =&gt; x.Y);

// or

var sort = builder.Ascending(&quot;X&quot;).Descending(&quot;Y&quot;);

// or

var sort = builder.Ascending(&quot;x&quot;).Descending(&quot;y&quot;);
</code></pre>

<h2 id="updates:ce6bd7650aa92e884a2bb6da9703168d">Updates</h2>

<p><a href="/mongo-csharp-driver/2.0/apidocs/html/T_MongoDB_Driver_UpdateDefinition_1.htm
"><code>UpdateDefinition&lt;TDocument&gt;</code></a> defines how to render a valid update document. It is implicity convertible from both a JSON string as well as a <a href="/mongo-csharp-driver/2.0/apidocs/html/T_MongoDB_Bson_BsonDocument.htm
"><code>BsonDocument</code></a>. Given the following method, all the following are valid:</p>

<pre><code class="language-csharp">// method definition
BsonDocument Update(UpdateDefinition&lt;BsonDocument&gt; filter);

// invocation
var doc = Update(&quot;{ $set: { x: 1 } }&quot;);
doc.ToJson().Should().Be(&quot;{ $set: { x: 1 } }&quot;);

var doc = Sort(new BsonDocument(&quot;$set&quot;, new BsonDocument(&quot;x&quot;, 1)));
doc.ToJson().Should().Be(&quot;{ $set: { x: 1 } }&quot;);
</code></pre>

<h3 id="update-definition-builder:ce6bd7650aa92e884a2bb6da9703168d">Update Definition Builder</h3>

<p><em>See the <a href="https://github.com/mongodb/mongo-csharp-driver/blob/master/src/MongoDB.Driver.Tests/UpdateDefinitionBuilderTests.cs
">tests</a> for examples.</em></p>

<p>The <a href="/mongo-csharp-driver/2.0/apidocs/html/T_MongoDB_Driver_UpdateDefinitionBuilder_1.htm
"><code>UpdateDefinitionBuilder&lt;TDocument&gt;</code></a> provides a nice API for building the <a href="https://www.mongodb.com/docs/manual/reference/operator/update/
">MongoDB update specification</a>.</p>

<p>For example, to build up the update <code>{ $set: { x: 1, y: 3 }, $inc: { z: 1 } }</code>, do the following:</p>

<pre><code class="language-csharp">var builder = Builders&lt;BsonDocument&gt;.Update;
var update = builder.Set(&quot;x&quot;, 1).Set(&quot;y&quot;, 3).Inc(&quot;z&quot;, 1);
</code></pre>

<p>Given the following class:</p>

<pre><code class="language-csharp">class Widget
{
    [BsonElement(&quot;x&quot;)]
    public int X { get; set; }

    [BsonElement(&quot;y&quot;)]
    public int Y { get; set; }

    [BsonElement(&quot;z&quot;)]
    public int Z { get; set; }
}
</code></pre>

<p>We can achieve the same result in a typed variant:</p>

<pre><code class="language-csharp">var builder = Builders&lt;Widget&gt;.Update;
var update = builder.Set(x =&gt; x.X, 1).Set(x =&gt; x.Y, 3).Inc(x =&gt; x.Z, 1);

// or

var update = builder.Set(&quot;X&quot;, 1).Set(&quot;Y&quot;, 3).Inc(&quot;Z&quot;, 1);

// or

var update = builder.Set(&quot;x&quot;, 1).Set(&quot;y&quot;, 3).Inc(&quot;z&quot;, 1);
</code></pre>






<div id="btnv">
  
  <div class="pull-left">
  <a class="navigation prev" href="/mongo-csharp-driver/2.0/reference/driver/connecting/">
      <i class="fa fa-long-arrow-left"> </i> Connecting
  </a>
  </div>
  
  
  <div class="pull-right">
  <a class="navigation next" href="/mongo-csharp-driver/2.0/reference/driver/crud/">
    CRUD Operations <i class="fa fa-long-arrow-right"> </i>
  </a>
  
</div>
</div>


</div>
<div class="right-column">
<div class="wrapper">
  
  <div class="toc">
    <span class="toc-header">On this page</span>
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#definitions-and-builders:ce6bd7650aa92e884a2bb6da9703168d">Definitions and Builders</a></li>
<li><a href="#fields:ce6bd7650aa92e884a2bb6da9703168d">Fields</a></li>
<li><a href="#filters:ce6bd7650aa92e884a2bb6da9703168d">Filters</a>
<ul>
<li><a href="#filter-definition-builder:ce6bd7650aa92e884a2bb6da9703168d">Filter Definition Builder</a>
<ul>
<li><a href="#array-operators:ce6bd7650aa92e884a2bb6da9703168d">Array Operators</a></li>
</ul></li>
</ul></li>
<li><a href="#pipelines:ce6bd7650aa92e884a2bb6da9703168d">Pipelines</a></li>
<li><a href="#projections:ce6bd7650aa92e884a2bb6da9703168d">Projections</a>
<ul>
<li><a href="#projection-definition-builder:ce6bd7650aa92e884a2bb6da9703168d">Projection Definition Builder</a>
<ul>
<li><a href="#lambda-expressions:ce6bd7650aa92e884a2bb6da9703168d">Lambda Expressions</a>
<ul>
<li><a href="#find:ce6bd7650aa92e884a2bb6da9703168d">Find</a></li>
<li><a href="#aggregate:ce6bd7650aa92e884a2bb6da9703168d">Aggregate</a></li>
<li><a href="#grouping:ce6bd7650aa92e884a2bb6da9703168d">Grouping</a></li>
</ul></li>
</ul></li>
</ul></li>
<li><a href="#sorts:ce6bd7650aa92e884a2bb6da9703168d">Sorts</a>
<ul>
<li><a href="#sort-definition-builder:ce6bd7650aa92e884a2bb6da9703168d">Sort Definition Builder</a></li>
</ul></li>
<li><a href="#updates:ce6bd7650aa92e884a2bb6da9703168d">Updates</a>
<ul>
<li><a href="#update-definition-builder:ce6bd7650aa92e884a2bb6da9703168d">Update Definition Builder</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
  </div>
  
</div>
</div>

</div>
</div>
</div>
</section>
</section>

</section>


<script type="text/javascript">
  var DOCUMENTATION_OPTIONS = {
   URL_ROOT:    "/mongo-csharp-driver/2.0",
   VERSION:     "",
   COLLAPSE_INDEX: false,
   FILE_SUFFIX: '.html',
   HAS_SOURCE:  true,
  };
</script>
<script type="text/javascript" src="/mongo-csharp-driver/2.0/js/jquery.js"></script>
<script type="text/javascript" src="/mongo-csharp-driver/2.0/lib/bootstrap.js"></script>
<script type="text/javascript" src="/mongo-csharp-driver/2.0/js/navbar.js"></script>
<script type="text/javascript" src="/mongo-csharp-driver/2.0/lib/highlight/highlight.pack.js"></script>
<script type="text/javascript" src="/mongo-csharp-driver/2.0/js/scripts.js"></script>



<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-K75Z5Q"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push(
{'gtm.start': new Date().getTime(),event:'gtm.js'}
);var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-K75Z5Q');</script>


<script type="text/javascript">
var _elqQ = _elqQ || [];
_elqQ.push(['elqSetSiteId', '413370795']);
_elqQ.push(['elqTrackPageView']);
(function () {
function async_load()
{ var s = document.createElement('script'); s.type = 'text/javascript'; s.async = true; s.src = '//img03.en25.com/i/elqCfg.min.js'; var x = document.getElementsByTagName('script')[0]; x.parentNode.insertBefore(s, x); }
if (window.addEventListener) window.addEventListener('DOMContentLoaded', async_load, false);
else if (window.attachEvent) window.attachEvent('onload', async_load);
})();
</script>

</body>
</html>

