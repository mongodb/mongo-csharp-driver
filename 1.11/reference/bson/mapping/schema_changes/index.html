<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<meta name="author" content="">
<meta name="keyword" content="">

    <link rel="shortcut icon" href="/mongo-csharp-driver/2.0/img/favicon.png">

    <title>Handling Schema Changes</title>

    <link rel="stylesheet" href="/mongo-csharp-driver/2.0/lib/bootstrap.css" type="text/css" />
<link rel="stylesheet" href="/mongo-csharp-driver/2.0/lib/font-awesome/css/font-awesome.min.css" type="text/css" />
<link rel="stylesheet" href="/mongo-csharp-driver/2.0/css/mongodb-docs.css" type="text/css" />
<link rel="stylesheet" href="/mongo-csharp-driver/2.0/css/overrides.css" type="text/css" />
<link rel="stylesheet" href="/mongo-csharp-driver/2.0/lib/highlight/styles/default.css" />


  </head>

  <body>
  
  <section id="container" class="">
      
      <header id="header-db" class="row" role="navigation">
  <div class="header-content">
    <div class="toggle-nav pull-left">
        <i class="fa fa-bars"></i>
        <div class="icon-reorder tooltips" data-original-title="Toggle Navigation" data-placement="bottom"></div>
    </div>
    
    <div class="logo pull-left">
      <a href="/mongo-csharp-driver/2.0/../">
        <img src="/mongo-csharp-driver/2.0/img/logo-mongodb-header.png", alt="MongoDB.org" />
      </a>
    </div>
    
    <div>
<div class="nav-items pull-right">
  <a href="https://university.mongodb.com" data-toggle="tooltip" data-placement="bottom" title="Try MongoDB in the browser">Try it Out</a>
  <a href="https://www.mongodb.com/try" data-toggle="tooltip" data-placement="bottom" title="Download MongoDB">Downloads</a>
  <a href="https://www.mongodb.com/community" data-toggle="tooltip" data-placement="bottom" title="Get involved with MongoDB">Community</a>
  <a href="https://www.mongodb.com/docs" data-toggle="tooltip" data-placement="bottom" title="The MongoDB Documentation">Docs</a>
  <a href="https://www.mongodb.com/blog" data-toggle="tooltip" data-placement="bottom" title="The MongoDB Blog">Blog</a>
</div>
</div>

  </div>
</header>

      

      
<aside id="sidebar" class="sidebar">
    <div class="ssidebar nav-collapse">
      <div class="ssidebarwrapper">
        <h3>
          <a class="index-link" href="/mongo-csharp-driver/2.0/../">MongoDB .NET Driver</a>
          <a class="version pull-right" href="/mongo-csharp-driver/2.0">2.0</a>
        </h3>

        
        <ul class="sidebar-menu">
          
          
          
          
          
          
          
          
          
          
          
          

          
          
            
            









  
    
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
    
      
    
  


          
            
            









  
    
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
    
      
    
  


          
            
            









  
    
    
      
      
        
        
        
        
        
        
        
        









  
    
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  
    
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  
  
  
  
  
  
  
  

  
    
    
    
      
      
      
        
        
        
          
        
      
      
    
    
  
  


        
      
    
    
  


        
      
    
    
  


        
      
    
      
      
        
      
    
      
      
    
    
  


          
            
            









  


          

          

          
            
            
















<li class="toctree-l1 ">
  <a href="/mongo-csharp-driver/2.0/getting_started/" class="">
      <i class='fa fa-road'></i>
      <span>Getting Started</span>
      <span class="menu-arrow fa fa-angle-right"></span>
  </a>
    <ul >
        
        
        
        
















    <li class="toctree-l2">
    <a href="/mongo-csharp-driver/2.0/getting_started/connecting/">
        <i class='fa'></i>
        Connecting to the Server
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l2">
    <a href="/mongo-csharp-driver/2.0/getting_started/reading_and_writing/">
        <i class='fa'></i>
        Reading and Writing
    </a>
  </li>


        
        
    </ul>
  </li>


          
            
            
















<li class="toctree-l1 ">
  <a href="/mongo-csharp-driver/2.0/what_is_new/" class="">
      <i class='fa fa-star'></i>
      <span>What&#39;s New</span>
      <span class="menu-arrow fa fa-angle-right"></span>
  </a>
    <ul >
        
        
        
        
















    <li class="toctree-l2">
    <a href="/mongo-csharp-driver/2.0/upgrading/">
        <i class='fa'></i>
        Upgrading
    </a>
  </li>


        
        
    </ul>
  </li>


          
            
            













  




<li class="toctree-l1  current">
  <a href="/mongo-csharp-driver/2.0/reference/" class="">
      <i class='fa fa-book'></i>
      <span>Reference</span>
      <span class="menu-arrow fa fa-angle-down"></span>
  </a>
    <ul  class="current">
        
        
        
        













  




<li class="toctree-l2  current">
  <a href="/mongo-csharp-driver/2.0/reference/bson/" class="">
      <i class='fa'></i>
      <span>BSON</span>
      
  </a>
    <ul  class="current">
        
        
        
        
















    <li class="toctree-l3">
    <a href="/mongo-csharp-driver/2.0/reference/bson/bson/">
        <i class='fa'></i>
        Reading and Writing BSON/JSON
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l3">
    <a href="/mongo-csharp-driver/2.0/reference/bson/bson_document/">
        <i class='fa'></i>
        BsonDocument
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l3">
    <a href="/mongo-csharp-driver/2.0/reference/bson/serialization/">
        <i class='fa'></i>
        Serialization
    </a>
  </li>


        
        
        
        
        













  




<li class="toctree-l3  current">
  <a href="/mongo-csharp-driver/2.0/reference/bson/mapping/" class="">
      <i class='fa'></i>
      <span>Mapping Classes</span>
      
  </a>
    <ul  class="current">
        
        
        
        
















    <li class="toctree-l4">
    <a href="/mongo-csharp-driver/2.0/reference/bson/mapping/polymorphism/">
        <i class='fa'></i>
        Polymorphism
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l4">
    <a href="/mongo-csharp-driver/2.0/reference/bson/mapping/conventions/">
        <i class='fa'></i>
        Conventions
    </a>
  </li>


        
        
        
        
        













  




    <li class="toctree-l4">
    <a href="/mongo-csharp-driver/2.0/reference/bson/mapping/schema_changes/">
        <i class='fa'></i>
        Handling Schema Changes
    </a>
  </li>


        
        
    </ul>
  </li>


        
        
    </ul>
  </li>


        
        
        
        
        
















<li class="toctree-l2 ">
  <a href="/mongo-csharp-driver/2.0/reference/driver/" class="">
      <i class='fa'></i>
      <span>Driver</span>
      
  </a>
    <ul >
        
        
        
        
















<li class="toctree-l3 ">
  <a href="/mongo-csharp-driver/2.0/reference/driver/connecting/" class="">
      <i class='fa'></i>
      <span>Connecting</span>
      
  </a>
    <ul >
        
        
        
        
















    <li class="toctree-l4">
    <a href="/mongo-csharp-driver/2.0/reference/driver/ssl/">
        <i class='fa'></i>
        SSL
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l4">
    <a href="/mongo-csharp-driver/2.0/reference/driver/authentication/">
        <i class='fa'></i>
        Authentication
    </a>
  </li>


        
        
    </ul>
  </li>


        
        
        
        
        
















<li class="toctree-l3 ">
  <a href="/mongo-csharp-driver/2.0/reference/driver/definitions/" class="">
      <i class='fa'></i>
      <span>Definitions and Builders</span>
      
  </a>
    <ul >
        
        
        
        
















    <li class="toctree-l4">
    <a href="/mongo-csharp-driver/2.0/reference/driver/expressions/">
        <i class='fa'></i>
        Expressions
    </a>
  </li>


        
        
    </ul>
  </li>


        
        
        
        
        
















<li class="toctree-l3 ">
  <a href="/mongo-csharp-driver/2.0/reference/driver/crud/" class="">
      <i class='fa'></i>
      <span>CRUD Operations</span>
      
  </a>
    <ul >
        
        
        
        
















    <li class="toctree-l4">
    <a href="/mongo-csharp-driver/2.0/reference/driver/crud/reading/">
        <i class='fa'></i>
        Reading
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l4">
    <a href="/mongo-csharp-driver/2.0/reference/driver/crud/writing/">
        <i class='fa'></i>
        Writing
    </a>
  </li>


        
        
    </ul>
  </li>


        
        
    </ul>
  </li>


        
        
        
        
        
















    <li class="toctree-l2">
    <a href="/mongo-csharp-driver/2.0/reference/driver_core/">
        <i class='fa'></i>
        Driver Core
    </a>
  </li>


        
        
    </ul>
  </li>


          
            
            
















    <li class="toctree-l1">
    <a href="/mongo-csharp-driver/2.0/issues_help/">
        <i class='fa fa-life-ring'></i>
        Issues &amp; Help
    </a>
  </li>


          
        </ul>
        
    </div>
  </div>
  
</aside>






      
      <section id="main-content" class="content">
          <section class="main-column pull-left">
            <div class="document">
              <div class="documentwrapper">
                <div class="bodywrapper">
                  <div class="body">


   
<a class="edit-link" href="https://github.com/mongodb/mongo-csharp-driver/blob/master/docs/reference/content/reference%5cbson%5cmapping%5cschema_changes.md" target="_blank" title="Edit reference\bson\mapping\schema_changes.md on GitHub"><i class="fa fa-pencil-square-o"></i></a>










<div class="bc">
<ul>
  
  
  
  <li><a href="/mongo-csharp-driver/2.0/reference/">Reference</a> <i class="fa fa-angle-right"></i></li>
  <li><a href="/mongo-csharp-driver/2.0/reference/bson/">BSON</a> <i class="fa fa-angle-right"></i></li>
  <li><a href="/mongo-csharp-driver/2.0/reference/bson/mapping/">Mapping Classes</a> <i class="fa fa-angle-right"></i></li>
  <li>Handling Schema Changes</li>
</ul>
</div>




<h2 id="handling-schema-changes:3d4bdfa14ec4eda85bd3b08b8c601569">Handling Schema Changes</h2>

<p>Just because MongoDB is schema-less does not mean that your code can handle a schema-less document. Most likely, if you are using a statically typed language like C# or VB.NET, then your code is not flexible and needs to be mapped to a known schema.</p>

<p>There are a number of different ways that a schema can change from one version of your application to the next.</p>

<ol>
<li><a href="#a-member-has-been-added:3d4bdfa14ec4eda85bd3b08b8c601569">A new member is added</a></li>
<li><a href="#a-member-has-been-removed:3d4bdfa14ec4eda85bd3b08b8c601569">A member is removed</a></li>
<li><a href="#a-member-has-been-renamed:3d4bdfa14ec4eda85bd3b08b8c601569">A member is renamed</a></li>
<li><a href="#the-type-of-a-member-is-changed:3d4bdfa14ec4eda85bd3b08b8c601569">The type of a member is changed</a></li>
<li><a href="#the-representation-of-a-member-is-changed:3d4bdfa14ec4eda85bd3b08b8c601569">The representation of a member is changed</a></li>
</ol>

<p>How you handle these is up to you. There are two different strategies:</p>

<ol>
<li>Write an upgrade script.</li>
<li>Incrementally update your documents as they are used.</li>
</ol>

<p>The easiest strategy is to write an upgrade script. There is effectively no difference to this method between a relational database (SQL Server, Oracle) and MongoDB. Identify the documents that need to be changed and update them.</p>

<p>Alternatively, and not supportable in most relational databases, is the incremental upgrade. The idea is that your documents get updated as they are used. Documents that are never used never get updated. Because of this, there are some definite pitfalls you will need to be aware of.</p>

<p>First, queries against a schema where half the documents are version 1 and half the documents are version 2 could go awry. For instance, if you rename an element, then your query will need to test both the old element name and the new element name to get all the results.</p>

<p>Second, any incremental upgrade code must stay in the code-base until all the documents have been upgraded. For instance, if there have been 3 versions of a document, [1, 2, and 3] and we remove the upgrade code from version 1 to version 2, any documents that still exist as version 1 are un-upgradeable.</p>

<h2 id="a-member-has-been-added:3d4bdfa14ec4eda85bd3b08b8c601569">A Member Has Been Added</h2>

<p>When a new member is added to an entity, there is nothing that needs to be done other than restarting the application if you are using the auto mapping features. If not, then you will manually need to map the member in the same way all the other members are getting mapped.</p>

<p>Existing documents will not have this element and it will show up in your class with its default value. You can, of course, specify a default value.</p>

<h2 id="a-member-has-been-removed:3d4bdfa14ec4eda85bd3b08b8c601569">A Member Has Been Removed</h2>

<p>When a member has been removed from am entity, it will continue to exist in the documents. The serializer will throw an exception when this element is seen because it doesn’t know what to do with it. See the sections on <a href="/mongo-csharp-driver/2.0/reference/bson/mapping/#supporting-extra-elements:d680e8a854a7cbad6d490c445cba2eba">supporting extra elements</a> and <a href="/mongo-csharp-driver/2.0/reference/bson/mapping/#ignoring-extra-elements:d680e8a854a7cbad6d490c445cba2eba">ignoring extra elements</a> for information on how to deal with this.</p>

<h2 id="a-member-has-been-renamed:3d4bdfa14ec4eda85bd3b08b8c601569">A Member Has Been Renamed</h2>

<p>When a member has been renamed, it will exist in old documents with the old name and in new documents with the new name. The way to handle incremental upgrades for this rename would be to implement an <a href="/mongo-csharp-driver/2.0/reference/bson/mapping/#supporting-extra-elements:d680e8a854a7cbad6d490c445cba2eba">ExtraElements</a> member in conjunction with <a href="/mongo-csharp-driver/2.0/reference/bson/mapping/#issuportinitialize:d680e8a854a7cbad6d490c445cba2eba">ISupportInitialize</a>.</p>

<p>For example, let’s say that a class used to have a <code>Name</code> property which has now been split into a <code>FirstName</code> and a <code>LastName</code> property.</p>

<pre><code class="language-csharp">public class MyClass : ISupportInitialize 
{
    public string FirstName { get; set; }
    public string LastName { get; set; }

    [BsonExtraElements]
    public IDictionary&lt;string, object&gt; ExtraElements { get; set; }

    void ISupportInitialize.BeginInit() 
    {
        // nothing to do at beginning
    }

    void ISupportInitialize.EndInit() 
    {
        object nameValue;
        if (!ExtraElements.TryGetValue(&quot;Name&quot;, out nameValue)) {
            return;
        }

        var name = (string)nameValue;

        // remove the Name element so that it doesn't get persisted back to the database
        ExtraElements.Remove(&quot;Name&quot;);

        // assuming all names are &quot;First Last&quot;
        var nameParts = name.Split(' ');

        FirstName = nameParts[0];
        LastName = nameParts[1];
    }
}
</code></pre>

<h2 id="the-type-of-a-member-is-changed:3d4bdfa14ec4eda85bd3b08b8c601569">The Type of a Member Is Changed</h2>

<p>If the .NET type is compatible with the old type (an integer is changed to a double), then everything will continue to work. Otherwise, a custom serializer or a migration script will be required.</p>

<h2 id="the-representation-of-a-member-is-changed:3d4bdfa14ec4eda85bd3b08b8c601569">The Representation of a Member Is Changed</h2>

<p>If the <a href="/mongo-csharp-driver/2.0/reference/bson/mapping/#representation:d680e8a854a7cbad6d490c445cba2eba">representation of a member</a> is changed and the representations are compatible, then everything will continue to work. Otherwise, a custom serializer or a migration script will be required.</p>






<div id="btnv">
  
  <div class="pull-left">
  <a class="navigation prev" href="/mongo-csharp-driver/2.0/reference/bson/mapping/conventions/">
      <i class="fa fa-long-arrow-left"> </i> Conventions
  </a>
  </div>
  
  
  <div class="pull-right">
  <a class="navigation next" href="/mongo-csharp-driver/2.0/reference/driver/">
    Driver <i class="fa fa-long-arrow-right"> </i>
  </a>
  
</div>
</div>


</div>
<div class="right-column">
<div class="wrapper">
  
  <div class="toc">
    <span class="toc-header">On this page</span>
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#handling-schema-changes:3d4bdfa14ec4eda85bd3b08b8c601569">Handling Schema Changes</a></li>
<li><a href="#a-member-has-been-added:3d4bdfa14ec4eda85bd3b08b8c601569">A Member Has Been Added</a></li>
<li><a href="#a-member-has-been-removed:3d4bdfa14ec4eda85bd3b08b8c601569">A Member Has Been Removed</a></li>
<li><a href="#a-member-has-been-renamed:3d4bdfa14ec4eda85bd3b08b8c601569">A Member Has Been Renamed</a></li>
<li><a href="#the-type-of-a-member-is-changed:3d4bdfa14ec4eda85bd3b08b8c601569">The Type of a Member Is Changed</a></li>
<li><a href="#the-representation-of-a-member-is-changed:3d4bdfa14ec4eda85bd3b08b8c601569">The Representation of a Member Is Changed</a></li>
</ul></li>
</ul>
</nav>
  </div>
  
</div>
</div>

</div>
</div>
</div>
</section>
</section>

</section>


<script type="text/javascript">
  var DOCUMENTATION_OPTIONS = {
   URL_ROOT:    "/mongo-csharp-driver/2.0",
   VERSION:     "",
   COLLAPSE_INDEX: false,
   FILE_SUFFIX: '.html',
   HAS_SOURCE:  true,
  };
</script>
<script type="text/javascript" src="/mongo-csharp-driver/2.0/js/jquery.js"></script>
<script type="text/javascript" src="/mongo-csharp-driver/2.0/lib/bootstrap.js"></script>
<script type="text/javascript" src="/mongo-csharp-driver/2.0/js/navbar.js"></script>
<script type="text/javascript" src="/mongo-csharp-driver/2.0/lib/highlight/highlight.pack.js"></script>
<script type="text/javascript" src="/mongo-csharp-driver/2.0/js/scripts.js"></script>



<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-K75Z5Q"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push(
{'gtm.start': new Date().getTime(),event:'gtm.js'}
);var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-K75Z5Q');</script>


<script type="text/javascript">
var _elqQ = _elqQ || [];
_elqQ.push(['elqSetSiteId', '413370795']);
_elqQ.push(['elqTrackPageView']);
(function () {
function async_load()
{ var s = document.createElement('script'); s.type = 'text/javascript'; s.async = true; s.src = '//img03.en25.com/i/elqCfg.min.js'; var x = document.getElementsByTagName('script')[0]; x.parentNode.insertBefore(s, x); }
if (window.addEventListener) window.addEventListener('DOMContentLoaded', async_load, false);
else if (window.attachEvent) window.attachEvent('onload', async_load);
})();
</script>

</body>
</html>

