<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>References on MongoDB .NET Driver</title>
    <link>/mongo-csharp-driver/2.0/reference/</link>
    <description>Recent content in References on MongoDB .NET Driver</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>en-us</language>
    <lastBuildDate>Thu, 07 May 2015 15:36:56 +0000</lastBuildDate>
    <atom:link href="/mongo-csharp-driver/2.0/reference/index.xml" rel="self" type="application/rss+xml" />
    
    <item>
      <title>Administration</title>
      <link>/mongo-csharp-driver/2.0/reference/driver/admin/</link>
      <pubDate>Thu, 07 May 2015 15:36:56 +0000</pubDate>
      
      <guid>/mongo-csharp-driver/2.0/reference/driver/admin/</guid>
      <description>

&lt;h2 id=&#34;adminstration&#34;&gt;Adminstration&lt;/h2&gt;

&lt;p&gt;The administration operations exist in multiple places in the driver&amp;rsquo;s API. Database-related operations exist on the database object and collection-related operations exist on the collection object. If there isn&amp;rsquo;t a method for the admin operation you want to use, the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/M_MongoDB_Driver_IMongoDatabase_RunCommandAsync__1.htm
&#34;&gt;&lt;code&gt;RunCommandAsync&lt;/code&gt;&lt;/a&gt; method on &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_IMongoDatabase.htm
&#34;&gt;&lt;code&gt;IMongoDatabase&lt;/code&gt;&lt;/a&gt; is available.&lt;/p&gt;

&lt;h2 id=&#34;databases&#34;&gt;Databases&lt;/h2&gt;

&lt;p&gt;These operations exist on the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_IMongoClient.htm
&#34;&gt;&lt;code&gt;IMongoClient&lt;/code&gt;&lt;/a&gt; interface.&lt;/p&gt;

&lt;h3 id=&#34;getting-a-database&#34;&gt;Getting a database&lt;/h3&gt;

&lt;p&gt;To get a database, use the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/M_MongoDB_Driver_IMongoClient_GetDatabase.htm
&#34;&gt;&lt;code&gt;GetDatabase&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;div class=&#34;admonition note&#34;&gt;
&lt;h5 class=&#34;admonition-title&#34;&gt;Note&lt;/h5&gt;
&lt;p&gt;There is no command for creating a database. The database will be created the first time it is used.&lt;/p&gt;

&lt;/div&gt;
&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;// get the test database
var db = client.GetDatabase(&amp;quot;test&amp;quot;);
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;dropping-a-database&#34;&gt;Dropping a database&lt;/h3&gt;

&lt;p&gt;Use the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/M_MongoDB_Driver_IMongoClient_DropDatabaseAsync.htm
&#34;&gt;&lt;code&gt;DropDatabaseAsync&lt;/code&gt;&lt;/a&gt; method.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;// drops the test database
await client.DropDatabaseAsync(&amp;quot;test&amp;quot;);
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;listing-the-databases&#34;&gt;Listing the databases&lt;/h3&gt;

&lt;p&gt;Use the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/M_MongoDB_Driver_IMongoClient_ListDatabasesAsync.htm
&#34;&gt;&lt;code&gt;ListDatabasesAsync&lt;/code&gt;&lt;/a&gt; method.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;using (var cursor = await client.ListDatabaseAsync())
{
    var list = await cursor.ToListAsync();
    // do something with the list
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;collections&#34;&gt;Collections&lt;/h2&gt;

&lt;p&gt;These operations exists on the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_IMongoDatabase.htm
&#34;&gt;&lt;code&gt;IMongoDatabase&lt;/code&gt;&lt;/a&gt; interface.&lt;/p&gt;

&lt;h3 id=&#34;getting-a-collection&#34;&gt;Getting a collection&lt;/h3&gt;

&lt;p&gt;The &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/M_MongoDB_Driver_IMongoDatabase_GetCollection__1.htm
&#34;&gt;&lt;code&gt;GetCollection&amp;lt;TDocument&amp;gt;&lt;/code&gt;&lt;/a&gt; method returns an &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_IMongoCollection_1.htm
&#34;&gt;&lt;code&gt;IMongoCollection&amp;lt;TDocument&amp;gt;&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;The generic parameter on the method defines the schema your application will use when working with the collection. Generally, this type will either be a &lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/bson/bson_document/&#34;&gt;&lt;code&gt;BsonDocument&lt;/code&gt;&lt;/a&gt; which provides no schema enforcement or a &lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/bson/mapping/&#34;&gt;mapped class (POCO)&lt;/a&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;// gets a collection named &amp;quot;foo&amp;quot; using a BsonDocument
var collection = db.GetCollection&amp;lt;BsonDocument&amp;gt;(&amp;quot;foo&amp;quot;);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;For more information on working with collections, see the &lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/driver/crud/&#34;&gt;CRUD Operations section&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&#34;creating-a-collection&#34;&gt;Creating a collection&lt;/h3&gt;

&lt;p&gt;Just like databases, there is no need to create a collection before working with it. It will be created upon first use. However, certain features of collections require explicit creation. The &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/M_MongoDB_Driver_IMongoDatabase_CreateCollectionAsync.htm
&#34;&gt;&lt;code&gt;CreateCollectionAsync&lt;/code&gt;&lt;/a&gt; method allows you to specify not only a name, but also &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_CreateCollectionOptions.htm
&#34;&gt;&lt;code&gt;CreateCollectionOptions&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;// creates a capped collection named &amp;quot;foo&amp;quot; with a maximum size of 10,000 bytes
await db.CreateCollectionAsync(
    &amp;quot;foo&amp;quot;, 
    new CreateCollectionOptions
    {
        Capped = true,
        MaxSize = 10000
    });
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;dropping-a-collection&#34;&gt;Dropping a collection&lt;/h3&gt;

&lt;p&gt;Use the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/M_MongoDB_Driver_IMongoDatabase_DropCollectionAsync.htm
&#34;&gt;&lt;code&gt;DropCollectionAsync&lt;/code&gt;&lt;/a&gt; method.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;// drops the &amp;quot;foo&amp;quot; collection
await db.DropCollectionAsync(&amp;quot;test&amp;quot;);
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;listing-the-collections&#34;&gt;Listing the collections&lt;/h3&gt;

&lt;p&gt;Use the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/M_MongoDB_Driver_IMongoDatabase_ListCollectionsAsync.htm
&#34;&gt;&lt;code&gt;ListCollectionsAsync&lt;/code&gt;&lt;/a&gt; method.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;using (var cursor = await db.ListCollectionsAsync())
{
    var list = await cursor.ToListAsync();
    // do something with the list
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;renaming-a-collection&#34;&gt;Renaming a collection&lt;/h3&gt;

&lt;p&gt;Use the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/M_MongoDB_Driver_IMongoDatabase_RenameCollectionAsync.htm
&#34;&gt;&lt;code&gt;RenameCollectionAsync&lt;/code&gt;&lt;/a&gt; method.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;// rename the &amp;quot;foo&amp;quot; collection to &amp;quot;bar&amp;quot;
await db.RenameCollectionAsync(&amp;quot;foo&amp;quot;, &amp;quot;bar&amp;quot;);
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;indexes&#34;&gt;Indexes&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_IMongoCollection_1.htm
&#34;&gt;&lt;code&gt;IMongoCollection&amp;lt;T&amp;gt;&lt;/code&gt;&lt;/a&gt; contains an &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/P_MongoDB_Driver_IMongoCollection_1_Indexes.htm
&#34;&gt;&lt;code&gt;Indexes&lt;/code&gt;&lt;/a&gt; property which gives access to all the index-related operations for a collection.&lt;/p&gt;

&lt;p&gt;A number of the methods take an &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_IndexKeysDefinition_1.htm
&#34;&gt;&lt;code&gt;IndexKeysDefinition&amp;lt;TDocument&amp;gt;&lt;/code&gt;&lt;/a&gt;. See the documentation on the &lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/driver/definitions/#index-keys &#34;&gt;index keys builder&lt;/a&gt; for more information.&lt;/p&gt;

&lt;h3 id=&#34;creating-an-index&#34;&gt;Creating an index&lt;/h3&gt;

&lt;p&gt;Use the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/M_MongoDB_Driver_IMongoIndexManager_1_CreateOneAsync.htm
&#34;&gt;&lt;code&gt;CreateOneAsync&lt;/code&gt;&lt;/a&gt; to create a single index. For instance, to create an ascending index on the &amp;ldquo;x&amp;rdquo; and &amp;ldquo;y&amp;rdquo; fields,&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;await collection.Indexes.CreateOneAsync(&amp;quot;{x: 1, y: 1}&amp;quot;);

// or

await collection.Indexes.CreateOneAsync(new BsonDocument(&amp;quot;x&amp;quot;, 1).Add(&amp;quot;y&amp;quot;, 1));

// or

await collection.Indexes.CreateOneAsync(Builders&amp;lt;BsonDocument&amp;gt;.IndexKeys.Ascending(&amp;quot;x&amp;quot;).Ascending(&amp;quot;y&amp;quot;));
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;In addition, there are a number of options available when creating index. These are present on the optional &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_CreateIndexOptions.htm
&#34;&gt;&lt;code&gt;CreateIndexOptions&lt;/code&gt;&lt;/a&gt; parameter. For instance, to create a unique ascending index on &amp;ldquo;x&amp;rdquo;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;await collection.Indexes.CreateOneAsync(&amp;quot;{x: 1}&amp;quot;, new CreateIndexOptions { Unique = true });
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;dropping-an-index&#34;&gt;Dropping an index&lt;/h3&gt;

&lt;p&gt;Use the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/M_MongoDB_Driver_IMongoIndexManager_1_DropOneAsync.htm
&#34;&gt;&lt;code&gt;DropOneAsync&lt;/code&gt;&lt;/a&gt; to drop a single index or the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/M_MongoDB_Driver_IMongoIndexManager_1_DropAllAsync.htm
&#34;&gt;&lt;code&gt;DropAllAsync&lt;/code&gt;&lt;/a&gt; to drop all indexes.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;// drop the index named &amp;quot;x_1&amp;quot;;
await collection.Indexes.DropOneAsync(&amp;quot;x_1&amp;quot;);

// drop all indexes
await collection.Indexes.DropAllAsync();
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;listing-indexes&#34;&gt;Listing indexes&lt;/h3&gt;

&lt;p&gt;To see all the indexes in a collection, use the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/M_MongoDB_Driver_IMongoIndexManager_1_ListAsync.htm
&#34;&gt;&lt;code&gt;ListAsync&lt;/code&gt;&lt;/a&gt; method.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;using(var cursor = await collection.Indexes.ListAsync())
{
    var list = await cursor.ToListAsync();
    // do something with the list...
}
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>Authentication</title>
      <link>/mongo-csharp-driver/2.0/reference/driver/authentication/</link>
      <pubDate>Tue, 17 Mar 2015 15:36:56 +0000</pubDate>
      
      <guid>/mongo-csharp-driver/2.0/reference/driver/authentication/</guid>
      <description>

&lt;h2 id=&#34;authentication&#34;&gt;Authentication&lt;/h2&gt;

&lt;p&gt;The .NET driver supports all &lt;a href=&#34;http://docs.mongodb.org/manual/core/authentication/
&#34;&gt;MongoDB authentication mechanisms&lt;/a&gt; including those in the &lt;a href=&#34;http://docs.mongodb.org/manual/administration/install-enterprise/
&#34;&gt;Enterprise Edition&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Authentication credentials are created by the application as instances of &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_MongoCredential.htm
&#34;&gt;&lt;code&gt;MongoCredential&lt;/code&gt;&lt;/a&gt; which includes static factory methods for each of the supported authentication mechanisms. A list of these instances must be passed to the driver using the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/M_MongoDB_Driver_MongoClient__ctor_1.htm
&#34;&gt;&lt;code&gt;MongoClient constructor&lt;/code&gt;&lt;/a&gt; that takes a &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_MongoClientSettings.htm
&#34;&gt;&lt;code&gt;MongoClientSettings&lt;/code&gt;&lt;/a&gt;. When only one credential is necessary, it is possible to specify via the &lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/driver/connecting/#connection-string&#34;&gt;connection string&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&#34;default&#34;&gt;Default&lt;/h3&gt;

&lt;p&gt;MongoDB 3.0 changed the default authentication mechanism from &lt;a href=&#34;http://docs.mongodb.org/manual/core/authentication/#mongodb-cr-authentication&#34;&gt;MONGODB-CR&lt;/a&gt; to &lt;a href=&#34;http://docs.mongodb.org/manual/core/authentication/#scram-sha-1-authentication&#34;&gt;SCRAM-SHA-1&lt;/a&gt;. To create a credential that will authenticate properly regardless of server version, create a credential using the following static factory method.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;var credential = MongoCredential.CreateCredential(databaseName, username, password);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Or via the connection string:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;mongodb://username:password@myserver/databaseName
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This is the recommended approach as it will make upgrading from MongoDB 2.6 to MongoDB 3.0 seamless, even after &lt;a href=&#34;http://docs.mongodb.org/manual/release-notes/3.0-scram/#upgrade-mongodb-cr-to-scram&#34;&gt;upgrading the authentication schema&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;div class=&#34;admonition note&#34;&gt;
&lt;h5 class=&#34;admonition-title&#34;&gt;Note&lt;/h5&gt;
The databaseName part of the connection string indicates which database the credentials are located in. See the &lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/driver/connecting/#connection-string&#34;&gt;connection string section&lt;/a&gt; for more information on connection strings.
&lt;/div&gt;
&lt;/p&gt;

&lt;h3 id=&#34;x-509-authentication&#34;&gt;x.509 Authentication&lt;/h3&gt;

&lt;p&gt;The &lt;a href=&#34;http://docs.mongodb.org/manual/core/authentication/#x-509-certificate-authentication&#34;&gt;x.509&lt;/a&gt; mechanism authenticates a user whose name is derived from the distinguished subject name of the x.509 certificate presented by the driver during SSL negotiation. This authentication method requires the use of &lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/driver/ssl/&#34;&gt;SSL connections&lt;/a&gt; with certificate validation and is available in MongoDB 2.6 and newer. To create a credential of this type, use the following static factory method:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;var credential = MongoCredential.CreateX509Credential(username);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Or via the connection string:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;mongodb://username@myserver/?authMechanism=MONGODB-X509
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Even when using the connection string to provide the credential, the certificate must still be provided via code. This certificate can be pulled out of the trust stores on the box, or from a file. However, to be used with client authentication, the &lt;a href=&#34;https://msdn.microsoft.com/en-us/library/system.security.cryptography.x509certificates.x509certificate.aspx&#34;&gt;&lt;code&gt;X509Certificate&lt;/code&gt;&lt;/a&gt; provided to the driver must contain the &lt;a href=&#34;https://msdn.microsoft.com/en-us/library/system.security.cryptography.x509certificates.x509certificate2.privatekey.aspx&#34;&gt;&lt;code&gt;PrivateKey&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;var cert = new X509Certificate2(&amp;quot;client.pfx&amp;quot;, &amp;quot;mySuperSecretPassword&amp;quot;);

var settings = new MongoClientSettings
{
    Credentials = new[] 
    {
        MongoCredential.CreateMongoX509Credential(&amp;quot;CN=client,OU=user,O=organization,L=Some City,ST=Some State,C=Some Country&amp;quot;)
    },
    SslSettings = new SslSettings
    {
        ClientCertificates = new[] { cert },
    },
    UseSsl = true
};
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;gssapi-kerberos&#34;&gt;GSSAPI/Kerberos&lt;/h3&gt;

&lt;p&gt;&lt;a href=&#34;http://www.mongodb.com/products/mongodb-enterprise&#34;&gt;MongoDB Enterprise&lt;/a&gt; supports authentication using &lt;a href=&#34;http://docs.mongodb.org/manual/core/authentication/#kerberos-authentication&#34;&gt;Kerberos/GSSAPI&lt;/a&gt;. To create a Kerberos/GSSAPI credential, use the following method:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;var credential = MongoCredential.CreateGssapiCredential(username, password);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Or via the connection string:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;mongodb://username%40REALM.com:password@myserver/?authMechanism=GSSAPI
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;div class=&#34;admonition note&#34;&gt;
&lt;h5 class=&#34;admonition-title&#34;&gt;Note&lt;/h5&gt;
Note that the username will need to have a REALM associated with it. When used in a connection string, &lt;code&gt;%40&lt;/code&gt; is the escape character for the &lt;code&gt;@&lt;/code&gt; symbol.
&lt;/div&gt;
&lt;/p&gt;

&lt;p&gt;If the process owner running your application is the same as the user needing authentication, you can omit the password:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;var credential = MongoCredential.CreateGssapiCredential(username);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Or via the connection string:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;mongodb://username%40REALM.com@myserver/?authMechanism=GSSAPI
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Depending on the kerberos setup, it may be required to specify some additional properties. These may be specified in the connection string or via code.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;CANONICALIZE_HOST_NAME&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Uses the DNS server to retrieve the fully qualified domain name (FQDN) of the host.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;credential = credential.WithMechanismProperty(&amp;quot;CANONICALIZE_HOST_NAME&amp;quot;, &amp;quot;true&amp;quot;);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Or via the connection string:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;mongodb://username@myserver/?authMechanism=GSSAPI&amp;amp;authMechanismProperties=CANONICALIZE_HOSTNAME:true
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;strong&gt;REALM&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;This is used when the user&amp;rsquo;s realm is different from the service&amp;rsquo;s realm.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;credential = credential.WithMechanismProperty(&amp;quot;REALM&amp;quot;, &amp;quot;otherrealm&amp;quot;);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Or via the connection string:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;mongodb://username%40REALM.com@myserver/?authMechanism=GSSAPI&amp;amp;authMechanismProperties=REALM:otherrealm
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;strong&gt;SERVICE_NAME&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;This is used when the service&amp;rsquo;s name is different that the default &lt;code&gt;mongodb&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;credential = credential.WithMechanismProperty(&amp;quot;SERVICE_NAME&amp;quot;, &amp;quot;othername&amp;quot;);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Or via the connection string:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;mongodb://username%40REALM.com@myserver/?authMechanism=GSSAPI&amp;amp;authMechanismProperties=SERVICE_NAME:othername
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;In addition, it is possible to use multiple authentication mechanism properties either via code or in the connection string. In code, call &lt;code&gt;WithMechanismProperty&lt;/code&gt; multiple times. In the connection string, separate the entries with a &lt;code&gt;,&lt;/code&gt; (comma).&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;mongodb://username%40REALM.com@myserver/?authMechanism=GSSAPI&amp;amp;authMechanismProperties=SERVICE_NAME:othername,REALM:otherrealm
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;ldap-plain&#34;&gt;LDAP (PLAIN)&lt;/h3&gt;

&lt;p&gt;&lt;a href=&#34;http://www.mongodb.com/products/mongodb-enterprise&#34;&gt;MongoDB Enterprise&lt;/a&gt; supports proxy authentication through a Lightweight Directory Access Protocol (LDAP) service. To create a credential of type LDAP use the following static factory method:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;var credential = MongoCredential.CreatePlainCredential(&amp;quot;$external&amp;quot;, username, password);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Or via the connection string:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;mongodb://username:password@myserver/?authSource=$external&amp;amp;authMechanism=PLAIN
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;div class=&#34;admonition note&#34;&gt;
&lt;h5 class=&#34;admonition-title&#34;&gt;Note&lt;/h5&gt;
Note that the method refers to the plain authentication mechanism instead of LDAP because technically the driver is authenticating via the PLAIN SASL mechanism. This means that your credentials are in plain text on the wire. Therefore, PLAIN should only be used in conjunction with SSL.
&lt;/div&gt;
&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>BSON</title>
      <link>/mongo-csharp-driver/2.0/reference/bson/</link>
      <pubDate>Tue, 17 Mar 2015 15:36:56 +0000</pubDate>
      
      <guid>/mongo-csharp-driver/2.0/reference/bson/</guid>
      <description>

&lt;h2 id=&#34;bson-reference&#34;&gt;BSON Reference&lt;/h2&gt;

&lt;p&gt;The MongoDB.Bson library handles &lt;a href=&#34;http://bsonspec.org&#34;&gt;BSON&lt;/a&gt; and &lt;a href=&#34;http://json.org&#34;&gt;JSON&lt;/a&gt; as well as serialization to and from .NET types.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/bson/bson/&#34;&gt;Reading and Writing BSON/JSON&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/bson/bson_document/&#34;&gt;BsonDocument&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/bson/serialization/&#34;&gt;Serialization&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/bson/mapping/&#34;&gt;Mapping Classes&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>BSON/JSON</title>
      <link>/mongo-csharp-driver/2.0/reference/bson/bson/</link>
      <pubDate>Tue, 17 Mar 2015 15:36:56 +0000</pubDate>
      
      <guid>/mongo-csharp-driver/2.0/reference/bson/bson/</guid>
      <description>

&lt;h2 id=&#34;reading&#34;&gt;Reading&lt;/h2&gt;

&lt;p&gt;The &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_IO_IBsonReader.htm
&#34;&gt;&lt;code&gt;IBsonReader&lt;/code&gt;&lt;/a&gt; interface contains all the methods necessary to read a &lt;a href=&#34;http://bsonspec.org&#34;&gt;BSON&lt;/a&gt; document or a &lt;a href=&#34;http://json.org&#34;&gt;JSON&lt;/a&gt; document. There is an implementation for each format.&lt;/p&gt;

&lt;h3 id=&#34;bson&#34;&gt;BSON&lt;/h3&gt;

&lt;p&gt;&lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_IO_BsonBinaryReader.htm
&#34;&gt;&lt;code&gt;BsonBinaryReader&lt;/code&gt;&lt;/a&gt; is for reading binary BSON. For example, to read a BSON file containing the document &lt;code&gt;{ a: 1 }&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;string inputFileName; // initialize to a file containing BSON

using (var stream = File.OpenRead(inputFileName))
using (var reader = new BsonBinaryReader(stream))
{
    reader.ReadStartDocument();
    string fieldName = reader.ReadName();
    int value = reader.ReadInt32();
    reader.ReadEndDocument();
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;json&#34;&gt;JSON&lt;/h3&gt;

&lt;p&gt;In the same way, we can read a JSON string using a &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_IO_JsonReader.htm
&#34;&gt;&lt;code&gt;JsonReader&lt;/code&gt;&lt;/a&gt;. For example, to read the document &lt;code&gt;{ a: 1 }&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;var jsonString = &amp;quot;{ a: 1 }&amp;quot;;
using (var reader = new JsonReader(jsonString))
{
    reader.ReadStartDocument();
    string fieldName = reader.ReadName();
    int value = reader.ReadInt32();
    reader.ReadEndDocument();
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_IO_JsonReader.htm
&#34;&gt;&lt;code&gt;JsonReader&lt;/code&gt;&lt;/a&gt; supports reading strict JSON as well as both flavors of &lt;a href=&#34;http://docs.mongodb.org/manual/reference/mongodb-extended-json/
&#34;&gt;MongoDB Extended JSON&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&#34;writing&#34;&gt;Writing&lt;/h2&gt;

&lt;p&gt;The &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_IO_IBsonWriter.htm
&#34;&gt;&lt;code&gt;IBsonWriter&lt;/code&gt;&lt;/a&gt; interface contains all the methods necessary to write a &lt;a href=&#34;http://bsonspec.org&#34;&gt;BSON&lt;/a&gt; document or a &lt;a href=&#34;http://json.org&#34;&gt;JSON&lt;/a&gt; document. There is an implementation for each format.&lt;/p&gt;

&lt;h3 id=&#34;bson-1&#34;&gt;BSON&lt;/h3&gt;

&lt;p&gt;&lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_IO_BsonBinaryWriter.htm
&#34;&gt;&lt;code&gt;BsonBinaryWriter&lt;/code&gt;&lt;/a&gt; is for writing binary BSON. For example, to write the document &lt;code&gt;{ a: 1 }&lt;/code&gt; to a BSON file:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;string outputFileName; // initialize to the file to write to.

using (var stream = File.OpenWrite(outputFileName))
using (var writer = new BsonBinaryWriter(stream))
{
    writer.WriteStartDocument();
    writer.WriteName(&amp;quot;a&amp;quot;);
    writer.WriteInt32(1);
    writer.WriteEndDocument();
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;json-1&#34;&gt;JSON&lt;/h3&gt;

&lt;p&gt;In the same way, we can write a JSON string using a &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_IO_JsonWriter.htm
&#34;&gt;&lt;code&gt;JsonWriter&lt;/code&gt;&lt;/a&gt;. For example, to write the document &lt;code&gt;{ a: 1 }&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;string outputFileName; // initialize to the file to write to.

using (var output = new StreamWriter(outputFileName))
using (var writer = new JsonWriter(output))
{
    writer.WriteStartDocument();
    writer.WriteName(&amp;quot;a&amp;quot;);
    writer.WriteInt32(1);
    writer.WriteEndDocument();
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;settings&#34;&gt;Settings&lt;/h4&gt;

&lt;p&gt;&lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_IO_JsonWriter.htm
&#34;&gt;&lt;code&gt;JsonWriter&lt;/code&gt;&lt;/a&gt; supports writing strict JSON as well as both flavors of &lt;a href=&#34;http://docs.mongodb.org/manual/reference/mongodb-extended-json/
&#34;&gt;MongoDB Extended JSON&lt;/a&gt;. This, and other things, can be customized with the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_IO_JsonWriterSettings.htm
&#34;&gt;&lt;code&gt;JsonWriterSettings&lt;/code&gt;&lt;/a&gt; class.&lt;/p&gt;

&lt;p&gt;For instance, to write in a format for the &lt;a href=&#34;http://docs.mongodb.org/manual/administration/scripting/&#34;&gt;MongoDB Shell&lt;/a&gt;, you can set the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/P_MongoDB_Bson_IO_JsonWriterSettings_OutputMode.htm
&#34;&gt;&lt;code&gt;OutputMode&lt;/code&gt;&lt;/a&gt; to &lt;code&gt;Shell&lt;/code&gt; and also set the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/P_MongoDB_Bson_IO_JsonWriterSettings_ShellVersion.htm
&#34;&gt;&lt;code&gt;ShellVersion&lt;/code&gt;&lt;/a&gt; to the desired shell version.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;var settings = new JsonWriterSettings
{
    OutputMode = JsonOutputMode.Shell,
    ShellVersion = new Version(3.0) // target the syntax of MongoDB 3.0
};
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>BsonDocument</title>
      <link>/mongo-csharp-driver/2.0/reference/bson/bson_document/</link>
      <pubDate>Tue, 17 Mar 2015 15:36:56 +0000</pubDate>
      
      <guid>/mongo-csharp-driver/2.0/reference/bson/bson_document/</guid>
      <description>

&lt;h2 id=&#34;bsondocument&#34;&gt;BsonDocument&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_BsonDocument.htm
&#34;&gt;&lt;code&gt;BsonDocument&lt;/code&gt;&lt;/a&gt; is the default type used for documents. It handles dynamic documents of any complexity. For instance, the document &lt;code&gt;{ a: 1, b: [{ c: 1 }] }&lt;/code&gt; can be built as follows:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;var doc = new BsonDocument
{
    { &amp;quot;a&amp;quot;, 1 },
    { &amp;quot;b&amp;quot;, new BsonArray
           {
                new BsonDocument(&amp;quot;c&amp;quot;, 1)
           }}
};
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;In addition, there is a &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/M_MongoDB_Bson_BsonDocument_Parse.htm
&#34;&gt;&lt;code&gt;Parse&lt;/code&gt;&lt;/a&gt; method to make reading a JSON string simple.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;var doc = BsonDocument.Parse(&amp;quot;{ a: 1, b: [{ c: 1 }] }&amp;quot;);
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>Connecting</title>
      <link>/mongo-csharp-driver/2.0/reference/driver/connecting/</link>
      <pubDate>Tue, 17 Mar 2015 15:36:56 +0000</pubDate>
      
      <guid>/mongo-csharp-driver/2.0/reference/driver/connecting/</guid>
      <description>

&lt;h2 id=&#34;connection-string&#34;&gt;Connection String&lt;/h2&gt;

&lt;p&gt;The &lt;a href=&#34;http://docs.mongodb.org/manual/reference/connection-string/&#34;&gt;connection string&lt;/a&gt; is the simplest way to connect to one or more MongoDB servers. A connection string mostly follows &lt;a href=&#34;http://tools.ietf.org/html/rfc3986&#34;&gt;RFC 3986&lt;/a&gt; with the exception of the domain name. For MongoDB, it is possible to list multiple domain names separated by a comma. Below are some example connection strings&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;For a standalone mongod, mongos, or a direct connection to a member of a replica set:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;mongodb://host:27017
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;To connect to multiple mongos or a replica set:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;mongodb://host1:27017,host2:27017
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The &lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/driver/authentication/&#34;&gt;authentication guide&lt;/a&gt; contains information on how to provide credentials.&lt;/p&gt;

&lt;p&gt;&lt;div class=&#34;admonition important&#34;&gt;
&lt;h5 class=&#34;admonition-title&#34;&gt;important&lt;/h5&gt;
When connecting to a replica set, it is highly suggested that you include the replica set name as a connection string option. This will allow the driver to skip the cluster discovery step and ensure that all hosts on the seedlist are connecting to the intended replica set.
&lt;/div&gt;
&lt;/p&gt;

&lt;h3 id=&#34;the-database-component&#34;&gt;The Database Component&lt;/h3&gt;

&lt;p&gt;The database component is optional and is used to indicate which database to authenticate against. When the database component is not provided, the &amp;ldquo;admin&amp;rdquo; database is used.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;mongodb://host:27017/mydb
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Above, the database by the name of &amp;ldquo;mydb&amp;rdquo; is where the credentials are stored for the application.&lt;/p&gt;

&lt;p&gt;&lt;div class=&#34;admonition note&#34;&gt;
&lt;h5 class=&#34;admonition-title&#34;&gt;Note&lt;/h5&gt;
Some drivers utilize the database component to indicate which database to work with by default. The .NET driver, while it parses the database component, does not use the database component for anything other than authentication.
&lt;/div&gt;
&lt;/p&gt;

&lt;h3 id=&#34;options&#34;&gt;Options&lt;/h3&gt;

&lt;p&gt;Many options can be provided via the connection string. The ones that cannot may be provided in a &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_MongoClientSettings.htm
&#34;&gt;&lt;code&gt;MongoClientSettings&lt;/code&gt;&lt;/a&gt; object. To provide an option on the connection string, append a &lt;code&gt;?&lt;/code&gt; and separate multiple options by an &lt;code&gt;&amp;amp;&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;mongodb://host:27017/?replicaSet=rs0&amp;amp;uuidRepresentation=standard
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The above connection string sets the &lt;code&gt;replicaSet&lt;/code&gt; value to &lt;code&gt;rs0&lt;/code&gt; and the &lt;code&gt;uuidRepresentation&lt;/code&gt; to &lt;code&gt;standard&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;For a comprehensive list of the available options, see the MongoDB &lt;a href=&#34;http://docs.mongodb.org/manual/reference/connection-string/&#34;&gt;connection string&lt;/a&gt; documentation.&lt;/p&gt;

&lt;h2 id=&#34;mongo-client&#34;&gt;Mongo Client&lt;/h2&gt;

&lt;p&gt;A &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_MongoClient.htm
&#34;&gt;&lt;code&gt;MongoClient&lt;/code&gt;&lt;/a&gt; object will be the root object. It is thread-safe and is all that is needed to handle connecting to servers, monitoring servers, and performing operations against those servers. Without any arguments, constructing a &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_MongoClient.htm
&#34;&gt;&lt;code&gt;MongoClient&lt;/code&gt;&lt;/a&gt; instance will connect to &amp;ldquo;localhost&amp;rdquo; port 27017.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var client = new MongoClient();
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Alternatively, a connection string may be provided:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var client = new MongoClient(&amp;quot;mongodb://host:27017,host2:27017/?replicaSet=rs0&amp;quot;);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Finally, &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_MongoClientSettings.htm
&#34;&gt;&lt;code&gt;MongoClientSettings&lt;/code&gt;&lt;/a&gt; provides an in code way to set the same options.&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;var settings = new MongoClientSettings { ReplicaSetName = &amp;quot;rs0&amp;quot; };
var client = new MongoClient(settings);
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;re-use&#34;&gt;Re-use&lt;/h3&gt;

&lt;p&gt;It is recommended to store a &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_MongoClient.htm
&#34;&gt;&lt;code&gt;MongoClient&lt;/code&gt;&lt;/a&gt; instance in a global place, either as a static variable or in an IoC container with a singleton lifetime.&lt;/p&gt;

&lt;p&gt;However, multiple &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_MongoClient.htm
&#34;&gt;&lt;code&gt;MongoClient&lt;/code&gt;&lt;/a&gt; instances created with the same settings will utilize the same connection pools underneath. Unfortunately, certain types of settings are not able to be compared for equality. For instance, the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/P_MongoDB_Driver_MongoClientSettings_ClusterConfigurator.htm
&#34;&gt;&lt;code&gt;ClusterConfigurator&lt;/code&gt;&lt;/a&gt; property is a delegate and only its address is known for comparison. If you wish to construct multiple &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_MongoClient.htm
&#34;&gt;&lt;code&gt;MongoClients&lt;/code&gt;&lt;/a&gt;, ensure that your delegates are all using the same address if the intent is to share connection pools.&lt;/p&gt;

&lt;h3 id=&#34;monitoring&#34;&gt;Monitoring&lt;/h3&gt;

&lt;p&gt;&lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_MongoClient.htm
&#34;&gt;&lt;code&gt;MongoClient&lt;/code&gt;&lt;/a&gt; utilizes an &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_Core_Clusters_ICluster.htm
&#34;&gt;&lt;code&gt;ICluster&lt;/code&gt;&lt;/a&gt; from &lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/driver_core/&#34;&gt;MongoDB.Driver.Core&lt;/a&gt; which handles monitoring the cluster.&lt;/p&gt;

&lt;h2 id=&#34;mongo-database&#34;&gt;Mongo Database&lt;/h2&gt;

&lt;p&gt;An &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_IMongoDatabase.htm
&#34;&gt;&lt;code&gt;IMongoDatabase&lt;/code&gt;&lt;/a&gt; represents a database in a MongoDB server. Databases are retrieved from an &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_IMongoClient.htm
&#34;&gt;&lt;code&gt;IMongoClient&lt;/code&gt;&lt;/a&gt; instance using the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/M_MongoDB_Driver_IMongoClient_GetDatabase.htm
&#34;&gt;&lt;code&gt;GetDatabase&lt;/code&gt;&lt;/a&gt; method:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;var db = client.GetDatabase(&amp;quot;hr&amp;quot;);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Above, we have gotten the &amp;ldquo;hr&amp;rdquo; database. If the database does not exist on the server, it will be created automatically upon first use. If you want to use more than one database, call &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/M_MongoDB_Driver_IMongoClient_GetDatabase.htm
&#34;&gt;&lt;code&gt;GetDatabase&lt;/code&gt;&lt;/a&gt; once for each database you&amp;rsquo;d like to work with.&lt;/p&gt;

&lt;h3 id=&#34;re-use-1&#34;&gt;Re-use&lt;/h3&gt;

&lt;p&gt;The implementation of &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_IMongoDatabase.htm
&#34;&gt;&lt;code&gt;IMongoDatabase&lt;/code&gt;&lt;/a&gt; provided by a &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_MongoClient.htm
&#34;&gt;&lt;code&gt;MongoClient&lt;/code&gt;&lt;/a&gt; is thread-safe and is safe to be stored globally or in an IoC container.&lt;/p&gt;

&lt;h3 id=&#34;mongo-collection&#34;&gt;Mongo Collection&lt;/h3&gt;

&lt;p&gt;An &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_IMongoCollection_1.htm
&#34;&gt;&lt;code&gt;IMongoCollection&amp;lt;TDocument&amp;gt;&lt;/code&gt;&lt;/a&gt; represents a collection in a MongoDB database. Collections are retrieved from an &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_IMongoDatabase.htm
&#34;&gt;&lt;code&gt;IMongoDatabase&lt;/code&gt;&lt;/a&gt; with the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/M_MongoDB_Driver_IMongoDatabase_GetCollection__1.htm
&#34;&gt;&lt;code&gt;GetCollection&amp;lt;TDocument&amp;gt;&lt;/code&gt;&lt;/a&gt; method:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;var collection = db.GetCollection&amp;lt;BsonDocument&amp;gt;(&amp;quot;people&amp;quot;);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Above, we have gotten the &amp;ldquo;people&amp;rdquo; collection. IF the collection does not exist on the server, it will be created automatically upon first use. If you want to use more than one database, call &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/M_MongoDB_Driver_IMongoDatabase_GetCollection__1.htm
&#34;&gt;&lt;code&gt;GetCollection&amp;lt;TDocument&amp;gt;&lt;/code&gt;&lt;/a&gt; once for each database you&amp;rsquo;d like to work with.&lt;/p&gt;

&lt;p&gt;The generic parameter &lt;code&gt;TDocument&lt;/code&gt; is the type of document that is stored in your collection. It can, effectively, be any type that can be mapped to and from BSON. The driver utilizes the &lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/bson/&#34;&gt;BSON library&lt;/a&gt; to handle this mapping. The most common types you will use are:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Custom Class - useful for representing known schemas. See the &lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/bson/mapping/&#34;&gt;mapping section&lt;/a&gt; for more information. The majority of applications will not work with dynamic schemas, but rather with something more rigid. In addition, if you work in a static language, it is nice to work with static types that provide compile time type checking.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_BsonDocument.htm
&#34;&gt;&lt;code&gt;BsonDocument&lt;/code&gt;&lt;/a&gt; - useful for representing dynamic schemas.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;div class=&#34;admonition note&#34;&gt;
&lt;h5 class=&#34;admonition-title&#34;&gt;Note&lt;/h5&gt;
&lt;p&gt;It is possible to mix both these models by utilizing a &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_BsonDocument.htm&#34;&gt;&lt;code&gt;BsonDocument&lt;/code&gt;&lt;/a&gt; inside your custom class.&lt;/p&gt;

&lt;/div&gt;
&lt;/p&gt;

&lt;p&gt;A majority of the methods and extension methods for an &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_IMongoCollection_1.htm
&#34;&gt;&lt;code&gt;IMongoCollection&amp;lt;TDocument&amp;gt;&lt;/code&gt;&lt;/a&gt; utilize the &lt;code&gt;TDocument&lt;/code&gt; generic parameter in some fashion.&lt;/p&gt;

&lt;h3 id=&#34;re-use-2&#34;&gt;Re-use&lt;/h3&gt;

&lt;p&gt;The implementation of &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_IMongoCollection_1.htm
&#34;&gt;&lt;code&gt;IMongoCollection&amp;lt;TDocument&amp;gt;&lt;/code&gt;&lt;/a&gt; ultimately provided by a &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_MongoClient.htm
&#34;&gt;&lt;code&gt;MongoClient&lt;/code&gt;&lt;/a&gt; is thread-safe and is safe to be stored globally or in an IoC container.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Conventions</title>
      <link>/mongo-csharp-driver/2.0/reference/bson/mapping/conventions/</link>
      <pubDate>Tue, 17 Mar 2015 15:36:56 +0000</pubDate>
      
      <guid>/mongo-csharp-driver/2.0/reference/bson/mapping/conventions/</guid>
      <description>

&lt;h2 id=&#34;conventions&#34;&gt;Conventions&lt;/h2&gt;

&lt;p&gt;When &lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/bson/mapping/#automap&#34;&gt;automapping&lt;/a&gt; a class, there are a lot of decisions that need to be made. For example:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;Which members of the class should be serialized&lt;/li&gt;
&lt;li&gt;Which member of the class is the “Id”&lt;/li&gt;
&lt;li&gt;What element name should be used in the BSON document&lt;/li&gt;
&lt;li&gt;If the class is being used polymorphically, what discriminator values are used&lt;/li&gt;
&lt;li&gt;What should happen if a BSON document has elements we don’t recognize&lt;/li&gt;
&lt;li&gt;Does the member have a default value&lt;/li&gt;
&lt;li&gt;Should the default value be serialized or ignored&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Answers to these questions are represented by a set of “conventions”. For each convention, there is a default convention that is the most likely one you will be using, but you can override individual conventions as necessary.&lt;/p&gt;

&lt;p&gt;If you want to use your own conventions that differ from the defaults, simply create an instance of &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_Conventions_ConventionPack.htm
&#34;&gt;&lt;code&gt;ConventionPack&lt;/code&gt;&lt;/a&gt;, add in the conventions you want to use, and then register that pack. For example:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;var pack = new ConventionPack();
pack.Add(new CamelCaseElementNameConvention());

ConventionRegistry.Register(
   &amp;quot;My Custom Conventions&amp;quot;,
   pack,
   t =&amp;gt; t.FullName.StartsWith(&amp;quot;MyNamespace.&amp;quot;));
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The third parameter is a filter function that defines when this convention pack should be used. Above, we are saying that any classes whose full names begin with &amp;ldquo;MyNamespace.&amp;rdquo; should use these conventions.&lt;/p&gt;

&lt;h2 id=&#34;custom-conventions&#34;&gt;Custom Conventions&lt;/h2&gt;

&lt;p&gt;In addition to pre-packaged conventions, it is possible to write your own. There are 4 classes of conventions which can be created and registered. These 4 classes of conventions correspond with the 4 stages in which they will be run.&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;&lt;strong&gt;Class Stage:&lt;/strong&gt; &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_Conventions_IClassMapConvention.htm
&#34;&gt;&lt;code&gt;IClassMapConvention&lt;/code&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Run against the class map.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;strong&gt;Member Stage:&lt;/strong&gt; &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_Conventions_IMemberMapConvention.htm
&#34;&gt;&lt;code&gt;IMemberMapConvention&lt;/code&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Run against each member map discovered during the Class stage.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;strong&gt;Creator Stage:&lt;/strong&gt; &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_Conventions_ICreatorMapConvention.htm
&#34;&gt;&lt;code&gt;ICreatorMapConvention&lt;/code&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Run against each CreatorMap discovered during the Class stage.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;strong&gt;Post Processing Stage:&lt;/strong&gt; &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_Conventions_IPostProcessingConvention.htm
&#34;&gt;&lt;code&gt;IPostProcessingConvention&lt;/code&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Run against the class map.&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Conventions get run in the order they were registered in each stage. The default set of conventions is registered first. This allows any user registered conventions to override the values applied by the default conventions. Hence, it is possible that certain values may get applied and overwritten. It is up to the user to ensure that the order is correct.&lt;/p&gt;

&lt;p&gt;&lt;div class=&#34;admonition note&#34;&gt;
&lt;h5 class=&#34;admonition-title&#34;&gt;Note&lt;/h5&gt;
&lt;p&gt;If a custom implementation of an &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_Conventions_IPostProcessingConvention.htm&#34;&gt;&lt;code&gt;IPostProcessingConvention&lt;/code&gt;&lt;/a&gt; is registered before a customer implementation of an &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_Conventions_IClassMapConvention.htm&#34;&gt;&lt;code&gt;IClassMapConvention&lt;/code&gt;&lt;/a&gt;, the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_Conventions_IClassMapConvention.htm&#34;&gt;&lt;code&gt;IClassMapConvention&lt;/code&gt;&lt;/a&gt; will be run first because the Class Stage is before the Post Processing Stage.&lt;/p&gt;

&lt;/div&gt;
&lt;/p&gt;

&lt;h3 id=&#34;example&#34;&gt;Example&lt;/h3&gt;

&lt;p&gt;As an example, we will write a custom convention to name all the elements the corresponding lower-case version of the member name. We can implement this convention as follows:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;public class LowerCaseElementNameConvention : IMemberMapConvention 
{
    public void Apply(BsonMemberMap memberMap) 
    {
        memberMap.SetElementName(memberMap.MemberName.ToLower());
    }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;When you are doing one-off conventions like this, it might be easier to create them with a simple lambda expresion instead. For example:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;var pack = new ConventionPack();
pack.AddMemberMapConvention(
    &amp;quot;LowerCaseElementName&amp;quot;,
    m =&amp;gt; m.SetElementName(m.MemberName.ToLower()));
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;For the best examples of writing custom conventions, it is good to consult the source for the pre-packaged conventions.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Definitions and Builders</title>
      <link>/mongo-csharp-driver/2.0/reference/driver/definitions/</link>
      <pubDate>Tue, 17 Mar 2015 15:36:56 +0000</pubDate>
      
      <guid>/mongo-csharp-driver/2.0/reference/driver/definitions/</guid>
      <description>

&lt;h2 id=&#34;definitions-and-builders&#34;&gt;Definitions and Builders&lt;/h2&gt;

&lt;p&gt;The driver has introduced a number of types related to the specification of filters, updates, projections, sorts, and index keys. These types are used throughout the &lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/driver/crud/&#34;&gt;API&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Most of the definitions also have builders to aid in their creation. Each builder has a generic type parameter &lt;code&gt;TDocument&lt;/code&gt; which represents the type of document with which you are working. It will almost always match the generic &lt;code&gt;TDocument&lt;/code&gt; parameter used in an &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_IMongoCollection_1.htm
&#34;&gt;&lt;code&gt;IMongoCollection&amp;lt;TDocument&amp;gt;&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&#34;fields&#34;&gt;Fields&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_FieldDefinition_1.htm
&#34;&gt;&lt;code&gt;FieldDefinition&amp;lt;TDocument&amp;gt;&lt;/code&gt;&lt;/a&gt; and &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_FieldDefinition_2.htm
&#34;&gt;&lt;code&gt;FieldDefinition&amp;lt;TDocument, TField&amp;gt;&lt;/code&gt;&lt;/a&gt; define how to get a field name. They are implicitly convertible from a string, so that you can simply pass the field name you&amp;rsquo;d like. For instance, to use the field named &amp;ldquo;fn&amp;rdquo; with a &lt;code&gt;TDocument&lt;/code&gt; of &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_BsonDocument.htm
&#34;&gt;&lt;code&gt;BsonDocument&lt;/code&gt;&lt;/a&gt;, do the following:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;FieldDefinition&amp;lt;BsonDocument&amp;gt; field = &amp;quot;fn&amp;quot;;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;However, if you are working with a &lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/bson/mapping/&#34;&gt;mapped class&lt;/a&gt;, then we are able to translate a string that equals the property name. For instance, given the below &lt;code&gt;Person&lt;/code&gt; class:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;class Person
{
    [BsonElement(&amp;quot;fn&amp;quot;)]
    public string FirstName { get; set; }

    [BsonElement(&amp;quot;ln&amp;quot;)]
    public string LastName { get; set; }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Since we know the type is &lt;code&gt;Person&lt;/code&gt;, we can provide the property name, &lt;code&gt;FirstName&lt;/code&gt;, from the class and &amp;ldquo;fn&amp;rdquo; will still be used.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;FieldDefinition&amp;lt;Person&amp;gt; field = &amp;quot;FirstName&amp;quot;;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;div class=&#34;admonition note&#34;&gt;
&lt;h5 class=&#34;admonition-title&#34;&gt;Note&lt;/h5&gt;
&lt;p&gt;We don&amp;rsquo;t validate that the provided string exists as a mapped field, so it is still possible to provide a field that hasn&amp;rsquo;t been mapped:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;FieldDefinition&amp;lt;Person&amp;gt; field = &amp;quot;fn&amp;quot;;
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;And the output field name of this will be just &amp;ldquo;fn&amp;rdquo;.&lt;/p&gt;

&lt;/div&gt;
&lt;/p&gt;

&lt;h2 id=&#34;filters&#34;&gt;Filters&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_FilterDefinition_1.htm
&#34;&gt;&lt;code&gt;FilterDefinition&amp;lt;TDocument&amp;gt;&lt;/code&gt;&lt;/a&gt; defines a filter. It is implicity convertible from both a JSON string as well as a &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_BsonDocument.htm
&#34;&gt;&lt;code&gt;BsonDocument&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;FilterDefinition&amp;lt;BsonDocument&amp;gt; filter = &amp;quot;{ x: 1 }&amp;quot;;

// or

FilterDefinition&amp;lt;BsonDocument&amp;gt; filter = new BsonDocument(&amp;quot;x&amp;quot;, 1);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Both of these will render the filter &lt;code&gt;{ x: 1 }&lt;/code&gt;.&lt;/p&gt;

&lt;h3 id=&#34;filter-definition-builder&#34;&gt;Filter Definition Builder&lt;/h3&gt;

&lt;p&gt;&lt;em&gt;See the &lt;a href=&#34;https://github.com/mongodb/mongo-csharp-driver/blob/master/src/MongoDB.Driver.Tests/FilterDefinitionBuilderTests.cs
&#34;&gt;tests&lt;/a&gt; for examples.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;The &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_FilterDefinitionBuilder_1.htm
&#34;&gt;&lt;code&gt;FilterDefinitionBuilder&amp;lt;TDocument&amp;gt;&lt;/code&gt;&lt;/a&gt; provides a type-safe API for building up both simple and complex &lt;a href=&#34;http://docs.mongodb.org/manual/reference/operator/query/
&#34;&gt;MongoDB queries&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;For example, to build up the filter &lt;code&gt;{ x: 10, y: { $lt: 20 } }&lt;/code&gt;, the following calls are all equivalent.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;var builder = Builders&amp;lt;BsonDocument&amp;gt;.Filter;
var filter = builder.Eq(&amp;quot;x&amp;quot;, 10) &amp;amp; builder.Lt(&amp;quot;y&amp;quot;, 20);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;div class=&#34;admonition note&#34;&gt;
&lt;h5 class=&#34;admonition-title&#34;&gt;Note&lt;/h5&gt;
The &lt;code&gt;&amp;amp;&lt;/code&gt; operator is overloaded. Other overloaded operators include the &lt;code&gt;|&lt;/code&gt; operator for &amp;ldquo;or&amp;rdquo; and the &lt;code&gt;!&lt;/code&gt; operator for &amp;ldquo;not&amp;rdquo;.
&lt;/div&gt;
&lt;/p&gt;

&lt;p&gt;Given the following class:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;class Widget
{
    [BsonElement(&amp;quot;x&amp;quot;)]
    public int X { get; set; }

    [BsonElement(&amp;quot;y&amp;quot;)]
    public int Y { get; set; }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;You can achieve the same result in the typed variant:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;var builder = Builders&amp;lt;Widget&amp;gt;.Filter;
var filter = builder.Eq(widget =&amp;gt; widget.X, 10) &amp;amp; builder.Lt(widget =&amp;gt; widget.Y, 20);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The benefits to this form is the compile-time safety inherent in using types. In addition, your IDE can provide refactoring support.&lt;/p&gt;

&lt;p&gt;Alternatively, you can elect to use a string-based field name instead.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;var filter = builder.Eq(&amp;quot;X&amp;quot;, 10) &amp;amp; builder.Lt(&amp;quot;Y&amp;quot;, 20);

// or

var filter = builder.Eq(&amp;quot;x&amp;quot;, 10) &amp;amp; builder.Lt(&amp;quot;y&amp;quot;, 20);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;For more information on valid lambda expressions, see the &lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/driver/expressions/&#34;&gt;expressions documentation&lt;/a&gt;.&lt;/p&gt;

&lt;h4 id=&#34;array-operators&#34;&gt;Array Operators&lt;/h4&gt;

&lt;p&gt;When using entities with properties or fields that serialize to arrays, you can use the methods prefixed with &amp;ldquo;Any&amp;rdquo; to compare the entire array against a single item.&lt;/p&gt;

&lt;p&gt;Given the following class:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;public class Post
{
    public IEnumerable&amp;lt;string&amp;gt; Tags { get; set; }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;To see if any of the tags equals &amp;ldquo;mongodb&amp;rdquo;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;var filter = Builders&amp;lt;Post&amp;gt;.Filter.AnyEq(x =&amp;gt; x.Tags, &amp;quot;mongodb&amp;quot;);

// This will NOT compile:
// var filter = Builders&amp;lt;Post&amp;gt;.Filter.Eq(x =&amp;gt; x.Tags, &amp;quot;mongodb&amp;quot;);
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;pipelines&#34;&gt;Pipelines&lt;/h2&gt;

&lt;p&gt;A pipeline definition defines an entire aggregation pipeline. It is implicitly convertible from a &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_BsonDocument.htm
&#34;&gt;&lt;code&gt;List&amp;lt;BsonDocument&amp;gt;&lt;/code&gt;&lt;/a&gt;, a &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_BsonDocument.htm
&#34;&gt;&lt;code&gt;BsonDocument&lt;/code&gt;&lt;/a&gt;, a &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_IPipelineStageDefinition.htm
&#34;&gt;&lt;code&gt;List&amp;lt;IPipelineStageDefinition&amp;gt;&lt;/code&gt;&lt;/a&gt; , and a &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_IPipelineStageDefinition.htm
&#34;&gt;&lt;code&gt;IPipelineStageDefinition[]&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;For example:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;PipelineDefinition pipeline = new BsonDocument[] 
{
    new BsonDocument { { &amp;quot;$match&amp;quot;, new BsonDocument(&amp;quot;x&amp;quot;, 1) } },
    new BsonDocument { { &amp;quot;$sort&amp;quot;, new BsonDocument(&amp;quot;y&amp;quot;, 1) } }
};
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;div class=&#34;admonition note&#34;&gt;
&lt;h5 class=&#34;admonition-title&#34;&gt;Note&lt;/h5&gt;
&lt;p&gt;There is no builder for a PipelineDefinition. In most cases, the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_IAggregateFluent_1.htm&#34;&gt;&lt;code&gt;IAggregateFluent&amp;lt;TDocument&amp;gt;&lt;/code&gt;&lt;/a&gt; interface would be used which is returned from the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/M_MongoDB_Driver_IMongoCollectionExtensions_Aggregate__1.htm&#34;&gt;&lt;code&gt;IMongoCollection&amp;lt;TDocument&amp;gt;.Aggregate&lt;/code&gt;&lt;/a&gt; method.&lt;/p&gt;

&lt;/div&gt;
&lt;/p&gt;

&lt;h2 id=&#34;projections&#34;&gt;Projections&lt;/h2&gt;

&lt;p&gt;There are two forms of a projection definition: one where the type of the projection is known, &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_ProjectionDefinition_2.htm
&#34;&gt;&lt;code&gt;ProjectionDefinition&amp;lt;TDocument, TProjection&amp;gt;&lt;/code&gt;&lt;/a&gt;, and one where the type of the projection is not yet known, &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_ProjectionDefinition_1.htm
&#34;&gt;&lt;code&gt;ProjectionDefinition&amp;lt;TDocument&amp;gt;&lt;/code&gt;&lt;/a&gt;. The latter, while implicitly convertible to the first, is merely used as a building block. The &lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/driver/crud/&#34;&gt;high-level APIs&lt;/a&gt; that take a projection will always take the former. This is because, when determining how to handle a projection client-side, it is not enough to know what fields and transformations will take place. It also requires that we know how to interpret the projected shape as a .NET type. Since the driver allows you to work with custom classes, it is imperative that any projection also include the &amp;ldquo;interpretation instructions&amp;rdquo; for projecting into a custom class.&lt;/p&gt;

&lt;p&gt;Each projection definition is implicity convertible from both a JSON string as well as a &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_BsonDocument.htm
&#34;&gt;&lt;code&gt;BsonDocument&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;ProjectionDefinition&amp;lt;BsonDocument&amp;gt; projection = &amp;quot;{ x: 1 }&amp;quot;;

// or

ProjectionDefinition&amp;lt;BsonDocument&amp;gt; projection = new BsonDocument(&amp;quot;x&amp;quot;, 1);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Both of these will render the projection &lt;code&gt;{ x: 1 }&lt;/code&gt;.&lt;/p&gt;

&lt;h3 id=&#34;projection-definition-builder&#34;&gt;Projection Definition Builder&lt;/h3&gt;

&lt;p&gt;&lt;em&gt;See the &lt;a href=&#34;https://github.com/mongodb/mongo-csharp-driver/blob/master/src/MongoDB.Driver.Tests/ProjectionDefinitionBuilderTests.cs
&#34;&gt;tests&lt;/a&gt; for examples.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;The &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_ProjectionDefinitionBuilder_1.htm
&#34;&gt;&lt;code&gt;ProjectionDefinitionBuilder&amp;lt;TDocument&amp;gt;&lt;/code&gt;&lt;/a&gt; exists to make it easier to build up projections in MongoDB&amp;rsquo;s syntax. For the projection &lt;code&gt;{ x: 1, y: 1, _id: 0 }&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;var projection = Builders&amp;lt;BsonDocument&amp;gt;.Projection.Include(&amp;quot;x&amp;quot;).Include(&amp;quot;y&amp;quot;).Exclude(&amp;quot;_id&amp;quot;);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Using the &lt;code&gt;Widget&lt;/code&gt; class:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;class Widget
{
    public ObjectId Id { get; set; }

    [BsonElement(&amp;quot;x&amp;quot;)]
    public int X { get; set; }

    [BsonElement(&amp;quot;y&amp;quot;)]
    public int Y { get; set; }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;We can render the same projection in a couple of ways:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;var projection = Builders&amp;lt;Widget&amp;gt;.Projection.Include(&amp;quot;X&amp;quot;).Include(&amp;quot;Y&amp;quot;).Exclude(&amp;quot;Id&amp;quot;);

// or

var projection = Builders&amp;lt;Widget&amp;gt;.Projection.Include(&amp;quot;x&amp;quot;).Include(&amp;quot;y&amp;quot;).Exclude(&amp;quot;_id&amp;quot;);

// or

var projection = Builders&amp;lt;Widget&amp;gt;.Projection.Include(x =&amp;gt; x.X).Include(x =&amp;gt; x.Y).Exclude(x =&amp;gt; x.Id);

// or

var projection = Builders&amp;lt;Widget&amp;gt;.Projection.Expression(x =&amp;gt; new { X = x.X, Y = x.Y });
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This last projection where we&amp;rsquo;ve used the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/M_MongoDB_Driver_ProjectionDefinitionBuilder_1_Expression__1.htm
&#34;&gt;&lt;code&gt;Expression&lt;/code&gt;&lt;/a&gt; method is subtly different as is explained below, and its return type is a (&lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_ProjectionDefinition_2.htm
&#34;&gt;&lt;code&gt;ProjectionDefinition&amp;lt;TDocument, TProjection&amp;gt;&lt;/code&gt;&lt;/a&gt;) as opposed to the others which return a (&lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_ProjectionDefinition_1.htm
&#34;&gt;&lt;code&gt;ProjectionDefinition&amp;lt;TDocument&amp;gt;&lt;/code&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;h4 id=&#34;lambda-expressions&#34;&gt;Lambda Expressions&lt;/h4&gt;

&lt;p&gt;The driver supports using expression trees to render projections. The same expression tree will sometimes render differently when used in a Find operation versus when used in an Aggregate operation. Inherently, a lambda expression contains all the information necessary to form both the projection on the server as well as the client-side result and requires no further information.&lt;/p&gt;

&lt;h5 id=&#34;find&#34;&gt;Find&lt;/h5&gt;

&lt;p&gt;&lt;em&gt;See the &lt;a href=&#34;https://github.com/mongodb/mongo-csharp-driver/blob/master/src/MongoDB.Driver.Tests/Linq/Translators/FindProjectionTranslatorTests.cs
&#34;&gt;tests&lt;/a&gt; for examples.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;When a Find projection is defined using a lambda expression, it is run client-side. The driver inspects the lambda expression to determine which fields are referenced and automatically constructs a server-side projection to return only those fields.&lt;/p&gt;

&lt;p&gt;Given the following class:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;class Widget
{
    public ObjectId Id { get; set; }

    [BsonElement(&amp;quot;x&amp;quot;)]
    public int X { get; set; }

    [BsonElement(&amp;quot;y&amp;quot;)]
    public int Y { get; set; }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The following lambda expressions will all result in the projection &lt;code&gt;{ x: 1, y: 1, _id: 0 }&lt;/code&gt;. This is because we inspect the expression tree to discover all the fields that are used and tell the server to include them. We then run the lambda expression client-side. As such, Find projections support virtually the entire breadth of the C# language.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;var projection = Builders&amp;lt;Widget&amp;gt;.Projection.Expression(x =&amp;gt; new { X = x.X, Y = x.Y });

var projection = Builders&amp;lt;Widget&amp;gt;.Projection.Expression(x =&amp;gt; new { Sum = x.X + x.Y });

var projection = Builders&amp;lt;Widget&amp;gt;.Projection.Expression(x =&amp;gt; new { Avg = (x.X + x.Y) / 2 });

var projection = Builders&amp;lt;Widget&amp;gt;.Projection.Expression(x =&amp;gt; (x.X + x.Y) / 2);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The &lt;code&gt;_id&lt;/code&gt; field is excluded automatically when we know for certain that it isn&amp;rsquo;t necessary, as is the case in all the above examples.&lt;/p&gt;

&lt;h5 id=&#34;aggregate&#34;&gt;Aggregate&lt;/h5&gt;

&lt;p&gt;&lt;em&gt;See the &lt;a href=&#34;https://github.com/mongodb/mongo-csharp-driver/blob/master/src/MongoDB.Driver.Tests/Linq/Translators/AggregateProjectionTranslatorTests_Project.cs
&#34;&gt;tests&lt;/a&gt; for examples.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;When an aggregate projection is defined using a lambda expression, a majority of the &lt;a href=&#34;http://docs.mongodb.org/manual/reference/operator/aggregation/#expression-operators
&#34;&gt;aggregation expression operators&lt;/a&gt; are supported and translated. Unlike a project for Find, no part of the lambda expression is run client-side. This means that all expressions in a projection for the &lt;a href=&#34;http://docs.mongodb.org/manual/core/aggregation-pipeline/
&#34;&gt;Aggregation Framework&lt;/a&gt; must be expressible on the server.&lt;/p&gt;

&lt;h5 id=&#34;grouping&#34;&gt;Grouping&lt;/h5&gt;

&lt;p&gt;&lt;em&gt;See the &lt;a href=&#34;https://github.com/mongodb/mongo-csharp-driver/blob/master/src/MongoDB.Driver.Tests/Linq/Translators/AggregateProjectionTranslatorTests_Group.cs
&#34;&gt;tests&lt;/a&gt; for examples.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;A projection is also used when performing grouping in the &lt;a href=&#34;http://docs.mongodb.org/manual/core/aggregation-pipeline/
&#34;&gt;Aggregation Framework&lt;/a&gt;. In addition to the expression operators used in an aggregate projection, the &lt;a href=&#34;http://docs.mongodb.org/manual/reference/operator/aggregation/group/#accumulator-operator
&#34;&gt;aggregation accumulator operators&lt;/a&gt; are also supported.&lt;/p&gt;

&lt;h2 id=&#34;sorts&#34;&gt;Sorts&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_SortDefinition_1.htm
&#34;&gt;&lt;code&gt;SortDefinition&amp;lt;TDocument&amp;gt;&lt;/code&gt;&lt;/a&gt; defines how to render a valid sort document. It is implicity convertible from both a JSON string as well as a &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_BsonDocument.htm
&#34;&gt;&lt;code&gt;BsonDocument&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;SortDefinition&amp;lt;BsonDocument&amp;gt; sort = &amp;quot;{ x: 1 }&amp;quot;;

// or

SortDefinition&amp;lt;BsonDocument&amp;gt; sort = new BsonDocument(&amp;quot;x&amp;quot;, 1);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Both of these will render the sort &lt;code&gt;{ x: 1 }&lt;/code&gt;.&lt;/p&gt;

&lt;h3 id=&#34;sort-definition-builder&#34;&gt;Sort Definition Builder&lt;/h3&gt;

&lt;p&gt;&lt;em&gt;See the &lt;a href=&#34;https://github.com/mongodb/mongo-csharp-driver/blob/master/src/MongoDB.Driver.Tests/SortDefinitionBuilderTests.cs
&#34;&gt;tests&lt;/a&gt; for examples.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;The &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_SortDefinitionBuilder_1.htm
&#34;&gt;&lt;code&gt;SortDefinitionBuilder&amp;lt;TDocument&amp;gt;&lt;/code&gt;&lt;/a&gt; provides a type-safe API for building up &lt;a href=&#34;http://docs.mongodb.org/manual/reference/method/cursor.sort/
&#34;&gt;MongoDB sort syntax&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;For example, to build up the sort &lt;code&gt;{ x: 1, y: -1 }&lt;/code&gt;, do the following:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;var builder = Builders&amp;lt;BsonDocument&amp;gt;.Sort;
var sort = builder.Ascending(&amp;quot;x&amp;quot;).Descending(&amp;quot;y&amp;quot;);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Given the following class:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;class Widget
{
    [BsonElement(&amp;quot;x&amp;quot;)]
    public int X { get; set; }

    [BsonElement(&amp;quot;y&amp;quot;)]
    public int Y { get; set; }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;We can achieve the same result in the typed variant:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;var builder = Builders&amp;lt;Widget&amp;gt;.Sort;
var sort = builder.Ascending(x =&amp;gt; x.X).Descending(x =&amp;gt; x.Y);

// or

var sort = builder.Ascending(&amp;quot;X&amp;quot;).Descending(&amp;quot;Y&amp;quot;);

// or

var sort = builder.Ascending(&amp;quot;x&amp;quot;).Descending(&amp;quot;y&amp;quot;);
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;updates&#34;&gt;Updates&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_UpdateDefinition_1.htm
&#34;&gt;&lt;code&gt;UpdateDefinition&amp;lt;TDocument&amp;gt;&lt;/code&gt;&lt;/a&gt; defines how to render a valid update document. It is implicity convertible from both a JSON string as well as a &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_BsonDocument.htm
&#34;&gt;&lt;code&gt;BsonDocument&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;// invocation
UpdateDefinition&amp;lt;BsonDocument&amp;gt; update = &amp;quot;{ $set: { x: 1 } }&amp;quot;;

// or

UpdateDefinition&amp;lt;BsonDocument&amp;gt; update = new BsonDocument(&amp;quot;$set&amp;quot;, new BsonDocument(&amp;quot;x&amp;quot;, 1));
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Both of these will render the update &lt;code&gt;{ $set: { x: 1 } }&lt;/code&gt;.&lt;/p&gt;

&lt;h3 id=&#34;update-definition-builder&#34;&gt;Update Definition Builder&lt;/h3&gt;

&lt;p&gt;&lt;em&gt;See the &lt;a href=&#34;https://github.com/mongodb/mongo-csharp-driver/blob/master/src/MongoDB.Driver.Tests/UpdateDefinitionBuilderTests.cs
&#34;&gt;tests&lt;/a&gt; for examples.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;The &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_UpdateDefinitionBuilder_1.htm
&#34;&gt;&lt;code&gt;UpdateDefinitionBuilder&amp;lt;TDocument&amp;gt;&lt;/code&gt;&lt;/a&gt; provides a type-safe API for building the &lt;a href=&#34;http://docs.mongodb.org/manual/reference/operator/update/
&#34;&gt;MongoDB update specification&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;For example, to build up the update &lt;code&gt;{ $set: { x: 1, y: 3 }, $inc: { z: 1 } }&lt;/code&gt;, do the following:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;var builder = Builders&amp;lt;BsonDocument&amp;gt;.Update;
var update = builder.Set(&amp;quot;x&amp;quot;, 1).Set(&amp;quot;y&amp;quot;, 3).Inc(&amp;quot;z&amp;quot;, 1);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Given the following class:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;class Widget
{
    [BsonElement(&amp;quot;x&amp;quot;)]
    public int X { get; set; }

    [BsonElement(&amp;quot;y&amp;quot;)]
    public int Y { get; set; }

    [BsonElement(&amp;quot;z&amp;quot;)]
    public int Z { get; set; }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;We can achieve the same result in a typed variant:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;var builder = Builders&amp;lt;Widget&amp;gt;.Update;
var update = builder.Set(widget =&amp;gt; widget.X, 1).Set(widget =&amp;gt; widget.Y, 3).Inc(widget =&amp;gt; widget.Z, 1);

// or

var update = builder.Set(&amp;quot;X&amp;quot;, 1).Set(&amp;quot;Y&amp;quot;, 3).Inc(&amp;quot;Z&amp;quot;, 1);

// or

var update = builder.Set(&amp;quot;x&amp;quot;, 1).Set(&amp;quot;y&amp;quot;, 3).Inc(&amp;quot;z&amp;quot;, 1);
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;index-keys&#34;&gt;Index Keys&lt;/h2&gt;

&lt;p&gt;&lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_IndexKeysDefinition_1.htm
&#34;&gt;&lt;code&gt;IndexKeysDefinition&amp;lt;TDocument&amp;gt;&lt;/code&gt;&lt;/a&gt; defines the keys for index. It is implicity convertible from both a JSON string as well as a &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_BsonDocument.htm
&#34;&gt;&lt;code&gt;BsonDocument&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;IndexKeysDefinition&amp;lt;BsonDocument&amp;gt; keys = &amp;quot;{ x: 1 }&amp;quot;;

// or

IndexKeysDefinition&amp;lt;BsonDocument&amp;gt; keys = new BsonDocument(&amp;quot;x&amp;quot;, 1);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Both of these will render the keys &lt;code&gt;{ x: 1 }&lt;/code&gt;.&lt;/p&gt;

&lt;h3 id=&#34;index-keys-definition-builder&#34;&gt;Index Keys Definition Builder&lt;/h3&gt;

&lt;p&gt;&lt;em&gt;See the &lt;a href=&#34;https://github.com/mongodb/mongo-csharp-driver/blob/master/src/MongoDB.Driver.Tests/IndexKeysDefinitionBuilderTests.cs
&#34;&gt;tests&lt;/a&gt; for examples.&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;The &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_IndexKeysDefinitionBuilder_1.htm
&#34;&gt;&lt;code&gt;IndexKeysDefinitionBuilder&amp;lt;TDocument&amp;gt;&lt;/code&gt;&lt;/a&gt; provides a type-safe API to build an index keys definition.&lt;/p&gt;

&lt;p&gt;For example, to build up the keys &lt;code&gt;{ x: 1, y: -1 }&lt;/code&gt;, do the following:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;var builder = Builders&amp;lt;BsonDocument&amp;gt;.IndexKeys;
var keys = builder.Ascending(&amp;quot;x&amp;quot;).Descending(&amp;quot;y&amp;quot;);
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Given the following class:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;class Widget
{
    [BsonElement(&amp;quot;x&amp;quot;)]
    public int X { get; set; }

    [BsonElement(&amp;quot;y&amp;quot;)]
    public int Y { get; set; }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;We can achieve the same result in the typed variant:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;var builder = Builders&amp;lt;Widget&amp;gt;.IndexKeys;
var keys = builder.Ascending(x =&amp;gt; x.X).Descending(x =&amp;gt; x.Y);

// or

var keys = builder.Ascending(&amp;quot;X&amp;quot;).Descending(&amp;quot;Y&amp;quot;);

// or

var keys = builder.Ascending(&amp;quot;x&amp;quot;).Descending(&amp;quot;y&amp;quot;);
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>Driver</title>
      <link>/mongo-csharp-driver/2.0/reference/driver/</link>
      <pubDate>Tue, 17 Mar 2015 15:36:56 +0000</pubDate>
      
      <guid>/mongo-csharp-driver/2.0/reference/driver/</guid>
      <description>

&lt;h2 id=&#34;driver-reference&#34;&gt;Driver Reference&lt;/h2&gt;

&lt;p&gt;The MongoDB .NET Driver is mostly just a wrapper around &lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/driver_core/&#34;&gt;MongoDB.Driver.Core&lt;/a&gt;. It takes the very verbose and low-level core driver and creates a nice high-level API.&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/driver/connecting/&#34;&gt;Connecting&lt;/a&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/driver/authentication/&#34;&gt;Authentication&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/driver/ssl/&#34;&gt;SSL&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/driver/admin/&#34;&gt;Administration&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/driver/definitions/&#34;&gt;Definitions and Builders&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/driver/crud/&#34;&gt;CRUD Operations&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/driver/error_handling/&#34;&gt;Error Handling&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;Experimental Features&lt;/li&gt;
&lt;/ul&gt;
</description>
    </item>
    
    <item>
      <title>Driver Core</title>
      <link>/mongo-csharp-driver/2.0/reference/driver_core/</link>
      <pubDate>Tue, 17 Mar 2015 15:36:56 +0000</pubDate>
      
      <guid>/mongo-csharp-driver/2.0/reference/driver_core/</guid>
      <description>

&lt;h2 id=&#34;driver-core&#34;&gt;Driver Core&lt;/h2&gt;

&lt;p&gt;Driver Core is a full driver with complete support for all types of deployment configurations, authentication, SSL, and cursors. The API is verbose, but highly configurable which is why it&amp;rsquo;s a great solution to build higher-level APIs upon. The [MongoDB .NET Driver](/mongo-csharp-driver/2.0/reference/driver/ is built upon Driver Core.&lt;/p&gt;

&lt;h2 id=&#34;services&#34;&gt;Services&lt;/h2&gt;

&lt;p&gt;Driver core provides a number of services that higher-level drivers can utilize either implicitly or explicitly.&lt;/p&gt;

&lt;h3 id=&#34;connection-pooling&#34;&gt;Connection Pooling&lt;/h3&gt;

&lt;p&gt;Connection pooling is provided for every server that is discovered. There are a number of settings that govern behavior ranging from connection lifetimes to the maximum number of connections in the pool.&lt;/p&gt;

&lt;h3 id=&#34;server-monitoring&#34;&gt;Server Monitoring&lt;/h3&gt;

&lt;p&gt;Each server that is discovered is monitored. By default, this monitoring happens every 10 seconds and consists of an &lt;code&gt;{ ismaster: 1 }&lt;/code&gt; call followed by a &lt;code&gt;{ buildinfo: 1 }&lt;/code&gt; call. When servers go down, the frequency of these calls will be increased to 500 milliseconds. See the &lt;a href=&#34;https://github.com/mongodb/specifications/blob/master/source/server-discovery-and-monitoring/server-discovery-and-monitoring-summary.rst&#34;&gt;Server Discovery and Monitory Specification&lt;/a&gt; for more information.&lt;/p&gt;

&lt;h3 id=&#34;server-selection&#34;&gt;Server Selection&lt;/h3&gt;

&lt;p&gt;An API is provided to allow for robust and configurable server selection capabilities. These capabilities align with the &lt;a href=&#34;https://github.com/mongodb/specifications/blob/master/source/server-selection/server-selection.rst&#34;&gt;Server Selection Specification&lt;/a&gt;, but are also extensible if additional needs are required.&lt;/p&gt;

&lt;h3 id=&#34;operations&#34;&gt;Operations&lt;/h3&gt;

&lt;p&gt;A large number of operations have been implemented for everything from a generic command like &amp;ldquo;ismaster&amp;rdquo; to the extremely complicated bulk write (&amp;ldquo;insert&amp;rdquo;, &amp;ldquo;update&amp;rdquo;, and &amp;ldquo;delete&amp;rdquo;) commands and presented as instantiatable classes. These classes handle version checking the server to ensure that they will function against all versions of the server in which they exist as well as ensuring that subsequent correlated operations (such as get more&amp;rsquo;s for cursors) function correctly.&lt;/p&gt;

&lt;h3 id=&#34;bindings&#34;&gt;Bindings&lt;/h3&gt;

&lt;p&gt;Bindings glue together server selection and operation execution by influencing how and where operations get executed. It would be possible to construct bindings that, for instance, pipeline multiple operations down the same connection or ensure that OP_GETMORE requests are sent down the same connection as the initial OP_QUERY.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Error Handling</title>
      <link>/mongo-csharp-driver/2.0/reference/driver/error_handling/</link>
      <pubDate>Tue, 17 Mar 2015 15:36:56 +0000</pubDate>
      
      <guid>/mongo-csharp-driver/2.0/reference/driver/error_handling/</guid>
      <description>

&lt;h2 id=&#34;error-handling&#34;&gt;Error Handling&lt;/h2&gt;

&lt;p&gt;Error handling using the .NET driver is a requirement for a fault-tolerant system. While MongoDB supports &lt;a href=&#34;http://docs.mongodb.org/manual/core/replica-set-high-availability/
&#34;&gt;automatic replica set failover&lt;/a&gt; and the driver supports multiple &lt;a href=&#34;http://docs.mongodb.org/manual/reference/program/mongos/
&#34;&gt;mongos&lt;/a&gt;&amp;rsquo;s, this doesn&amp;rsquo;t make a program immune to errors.&lt;/p&gt;

&lt;p&gt;Almost all errors will occur while attempting to perform an operation on the server. In other words, you will not receive an error when constructing a &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_MongoClient.htm
&#34;&gt;&lt;code&gt;MongoClient&lt;/code&gt;&lt;/a&gt;, getting a database, or getting a collection. This is because we are connecting to servers in the background and continually trying to reconnect when a problem occurs. Only when you attempt to perform an operation do those errors become apparent.&lt;/p&gt;

&lt;p&gt;There are a few types of errors you will see.&lt;/p&gt;

&lt;h2 id=&#34;server-selection-errors&#34;&gt;Server Selection Errors&lt;/h2&gt;

&lt;p&gt;Even when some servers are available, it might not be possible to satisfy a request. For example, using &lt;a href=&#34;http://docs.mongodb.org/manual/core/read-preference/#tag-sets
&#34;&gt;tag sets&lt;/a&gt; in a read preference when no server exists with those tags or attempting to write to a &lt;a href=&#34;http://docs.mongodb.org/manual/core/replication-introduction/
&#34;&gt;replica set&lt;/a&gt; when the Primary is unavailable. Both of these would result in a &lt;a href=&#34;https://msdn.microsoft.com/en-us/library/system.timeoutexception.aspx&#34;&gt;&lt;code&gt;TimeoutException&lt;/code&gt;&lt;/a&gt;. Below is an example exception (formatted for readability) when attempting to insert into a replica set without a primary.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;System.TimeoutException: A timeout occured after 30000ms selecting a server using 
CompositeServerSelector{ 
    Selectors = 
        WritableServerSelector, 
        LatencyLimitingServerSelector{ AllowedLatencyRange = 00:00:00.0150000 } 
}. 

Client view of cluster state is 
{ 
    ClusterId : &amp;quot;1&amp;quot;, 
    Type : &amp;quot;ReplicaSet&amp;quot;, 
    State : &amp;quot;Connected&amp;quot;, 
    Servers : [
        { 
            ServerId: &amp;quot;{ ClusterId : 1, EndPoint : &amp;quot;Unspecified/clover:30000&amp;quot; }&amp;quot;, 
            EndPoint: &amp;quot;Unspecified/clover:30000&amp;quot;, 
            State: &amp;quot;Disconnected&amp;quot;, 
            Type: &amp;quot;Unknown&amp;quot; 
        }, 
        { 
            ServerId: &amp;quot;{ ClusterId : 1, EndPoint : &amp;quot;Unspecified/clover:30001&amp;quot; }&amp;quot;, 
            EndPoint: &amp;quot;Unspecified/clover:30001&amp;quot;, 
            State: &amp;quot;Connected&amp;quot;, 
            Type: &amp;quot;ReplicaSetSecondary&amp;quot;, 
            WireVersionRange: &amp;quot;[0, 3]&amp;quot; 
        }, 
        { 
            ServerId: &amp;quot;{ ClusterId : 1, EndPoint : &amp;quot;Unspecified/clover:30002&amp;quot; }&amp;quot;, 
            EndPoint: &amp;quot;Unspecified/clover:30002&amp;quot;, 
            State: &amp;quot;Disconnected&amp;quot;, 
            Type: &amp;quot;Unknown&amp;quot;
        }, 
    ] 
}.
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Inspecting this error will tell you that we were attempting to find a writable server. The servers that are known are &lt;code&gt;clover:30000&lt;/code&gt;, &lt;code&gt;clover:30001&lt;/code&gt;, and &lt;code&gt;clover:30002&lt;/code&gt;. Of these, &lt;code&gt;clover:30000&lt;/code&gt; and &lt;code&gt;clover:30002&lt;/code&gt; are disconnected and &lt;code&gt;clover:30001&lt;/code&gt; is connected and a secondary. By default, we wait for 30 seconds to fulfill the request. During this time, we are trying to connect to &lt;code&gt;clover:30000&lt;/code&gt; and &lt;code&gt;clover:30002&lt;/code&gt; in hopes that one of them becomes available and and takes the role of primary. In this case, we timed out waiting.&lt;/p&gt;

&lt;p&gt;&lt;div class=&#34;admonition note&#34;&gt;
&lt;h5 class=&#34;admonition-title&#34;&gt;Note&lt;/h5&gt;
Even though the above scenario prevents any writes from occuring, reads can still be sent to &lt;code&gt;clover:30001&lt;/code&gt; as long as the read preference is &lt;code&gt;Secondary&lt;/code&gt;, &lt;code&gt;SecondaryPreferred&lt;/code&gt;, or &lt;code&gt;Nearest&lt;/code&gt;.
&lt;/div&gt;
&lt;/p&gt;

&lt;h2 id=&#34;connection-errors&#34;&gt;Connection Errors&lt;/h2&gt;

&lt;p&gt;A server may be unavailable for a variety of reasons. Each of these reasons will manifest themselves as a &lt;a href=&#34;https://msdn.microsoft.com/en-us/library/system.timeoutexception.aspx&#34;&gt;&lt;code&gt;TimeoutException&lt;/code&gt;&lt;/a&gt;. This is because, over time, it is entirely possible for the state of the servers to change in such a way
that a matching server becomes available.&lt;/p&gt;

&lt;p&gt;&lt;div class=&#34;admonition important&#34;&gt;
&lt;h5 class=&#34;admonition-title&#34;&gt;important&lt;/h5&gt;
There is nothing that can be done at runtime by your application to resolve these problems. The best thing to do is to catch them, log them, and raise a notification so that someone in your ops team can handle them.
&lt;/div&gt;
&lt;/p&gt;

&lt;p&gt;&lt;div class=&#34;admonition note&#34;&gt;
&lt;h5 class=&#34;admonition-title&#34;&gt;Note&lt;/h5&gt;
&lt;p&gt;If you are having trouble discovering why the driver can&amp;rsquo;t connect, &lt;a href=&#34;https://msdn.microsoft.com/en-us/library/ty48b824.aspx&#34;&gt;enabling network tracing&lt;/a&gt; on the &lt;code&gt;System.Net.Sockets&lt;/code&gt; source may help discover the problem.&lt;/p&gt;

&lt;/div&gt;
&lt;/p&gt;

&lt;h3 id=&#34;server-is-unavailable&#34;&gt;Server is unavailable&lt;/h3&gt;

&lt;p&gt;When a server is not listening at the location specified, the driver can&amp;rsquo;t connect to it.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;System.TimeoutException: A timeout occured after 30000ms selecting a server using
CompositeServerSelector{ 
    Selectors = 
        WritableServerSelector, 
        LatencyLimitingServerSelector{ AllowedLatencyRange = 00:00:00.0150000 } 
}. 

Client view of cluster state is 
{ 
    ClusterId : &amp;quot;1&amp;quot;, 
    Type : &amp;quot;Unknown&amp;quot;, 
    State : &amp;quot;Disconnected&amp;quot;, 
    Servers : [
        { 
            ServerId: &amp;quot;{ ClusterId : 1, EndPoint : &amp;quot;Unspecified/localhost:27017&amp;quot; }&amp;quot;, 
            EndPoint: &amp;quot;Unspecified/localhost:27017&amp;quot;, 
            State: &amp;quot;Disconnected&amp;quot;, 
            Type: &amp;quot;Unknown&amp;quot;, 
            HeartbeatException: &amp;quot;MongoDB.Driver.MongoConnectionException: An exception occurred while opening a connection to the server. 
---&amp;gt; System.Net.Sockets.SocketException: No connection could be made because the target machine actively refused it 127.0.0.1:27017
   at System.Net.Sockets.Socket.EndConnect(IAsyncResult asyncResult).
   ... snip ...&amp;quot;
        }
    ]
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;We see that we are attempting to connect to &lt;code&gt;localhost:27017&lt;/code&gt;, but &amp;ldquo;No connection could be made because the target machine actively refused it&amp;rdquo;.&lt;/p&gt;

&lt;p&gt;Fixing this problem either involves starting a server at the specified location or restarting your application with the correct host and port.&lt;/p&gt;

&lt;h3 id=&#34;dns-problems&#34;&gt;DNS problems&lt;/h3&gt;

&lt;p&gt;When DNS is misconfigured, or the hostname provided is not registered, resolution from hostname to IP address may fail.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;System.TimeoutException: A timeout occured after 30000ms selecting a server using 
CompositeServerSelector{ 
    Selectors = 
        WritableServerSelector, 
        LatencyLimitingServerSelector{ AllowedLatencyRange = 00:00:00.0150000 } 
}. 

Client view of cluster state is 
{ 
    ClusterId : &amp;quot;1&amp;quot;, 
    Type : &amp;quot;Unknown&amp;quot;, 
    State : &amp;quot;Disconnected&amp;quot;, 
    Servers : [
        { 
            ServerId: &amp;quot;{ ClusterId : 1, EndPoint : &amp;quot;Unspecified/idonotexist:27017&amp;quot; }&amp;quot;, 
            EndPoint: &amp;quot;Unspecified/idonotexist:27017&amp;quot;, 
            State: &amp;quot;Disconnected&amp;quot;, 
            Type: &amp;quot;Unknown&amp;quot;, 
            HeartbeatException: &amp;quot;MongoDB.Driver.MongoConnectionException: An exception occurred while opening a connection to the server. 
---&amp;gt; System.Net.Sockets.SocketException: No such host is known
   at System.Net.Sockets.Socket.EndConnect(IAsyncResult asyncResult)
   ... snip ...&amp;quot;
        }
    ]
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;We see that we are attempting to connect to &lt;code&gt;idonotexist:27017&lt;/code&gt;, but &amp;ldquo;No such host is known&amp;rdquo;.&lt;/p&gt;

&lt;p&gt;Fixing this problem either involves bringing up a server at the specified location, fixing DNS to resolve the host correctly, or modifing your hosts file.&lt;/p&gt;

&lt;h4 id=&#34;replica-set-misconfiguration&#34;&gt;Replica Set Misconfiguration&lt;/h4&gt;

&lt;p&gt;DNS problems might be seen when a replica set is misconfigured. It is imperative that the hosts in your replica set configuration be DNS resolvable from the client. Just because the replica set members can talk to one another does not mean that your application servers can also talk to the replica set members.&lt;/p&gt;

&lt;p&gt;&lt;div class=&#34;admonition warning&#34;&gt;
&lt;h5 class=&#34;admonition-title&#34;&gt;warning&lt;/h5&gt;
Even when providing a seed list with resolvable host names, if the replica set configuration uses unresolvable host names, the driver will fail to connect.
&lt;/div&gt;
&lt;/p&gt;

&lt;h3 id=&#34;taking-too-long-to-respond&#34;&gt;Taking too long to respond&lt;/h3&gt;

&lt;p&gt;When the latency between the driver and the server is too great, the driver may give up.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;System.TimeoutException: A timeout occured after 30000ms selecting a server using
CompositeServerSelector{ 
    Selectors = 
        WritableServerSelector, 
        LatencyLimitingServerSelector{ AllowedLatencyRange = 00:00:00.0150000 } 
}.

Client view of cluster state is 
{ 
    ClusterId : &amp;quot;1&amp;quot;, 
    Type : &amp;quot;Unknown&amp;quot;, 
    State : &amp;quot;Disconnected&amp;quot;, 
    Servers : [
        {
            ServerId: &amp;quot;{ ClusterId : 1, EndPoint : &amp;quot;Unspecified/somefaroffplace:27017&amp;quot; }&amp;quot;, 
            EndPoint: &amp;quot;Unspecified/somefaroffplace:27017&amp;quot;, 
            State: &amp;quot;Disconnected&amp;quot;, 
            Type: &amp;quot;Unknown&amp;quot;,
            HeartbeatException: &amp;quot;MongoDB.Driver.MongoConnectionException: An exception occurred while opening a connection to the server. 
---&amp;gt; System.TimeoutException: Timed out connecting to Unspecified/somefaroffplace:27017. Timeout was 00:00:30.
   at MongoDB.Driver.Core.Connections.TcpStreamFactory.&amp;lt;ConnectAsync&amp;gt;d__7.MoveNext()
   ... snip ...
        }
    ]
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;We see that attempting to connect to &lt;code&gt;somefaroffplace:27017&lt;/code&gt; failed because we &amp;ldquo;Timed out connecting to Unspecified/somefaroffplace:27017. Timeout was 00:00:30.&amp;rdquo;&lt;/p&gt;

&lt;p&gt;The default connection timeout is 30 seconds and can be changed using the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/P_MongoDB_Driver_MongoClientSettings_ConnectTimeout.htm
&#34;&gt;&lt;code&gt;MongoClientSettings.ConnectTimeout&lt;/code&gt;&lt;/a&gt; property or the &lt;code&gt;connectTimeout&lt;/code&gt; option on a &lt;a href=&#34;http://docs.mongodb.org/manual/reference/connection-string/
&#34;&gt;connection string&lt;/a&gt;.&lt;/p&gt;

&lt;h3 id=&#34;authentication-errors&#34;&gt;Authentication Errors&lt;/h3&gt;

&lt;p&gt;When the credentials or the authentication mechanism is incorrect, the application will fail to connect.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;System.TimeoutException: A timeout occured after 30000ms selecting a server using
CompositeServerSelector{ 
    Selectors = 
        WritableServerSelector, 
        LatencyLimitingServerSelector{ AllowedLatencyRange = 00:00:00.0150000 } 
}. 
        
Client view of cluster state is 
{ 
    ClusterId : &amp;quot;1&amp;quot;, 
    Type : &amp;quot;Unknown&amp;quot;, 
    State : &amp;quot;Disconnected&amp;quot;, 
    Servers : [
        {
            ServerId: &amp;quot;{ ClusterId : 1, EndPoint : &amp;quot;Unspecified/localhost:27017&amp;quot; }&amp;quot;, 
            EndPoint: &amp;quot;Unspecified/localhost:27017&amp;quot;,
            State: &amp;quot;Disconnected&amp;quot;, 
            Type: &amp;quot;Unknown&amp;quot;, 
            HeartbeatException: &amp;quot;MongoDB.Driver.MongoConnectionException: An exception occurred while opening a connection to the server. 
 ---&amp;gt; MongoDB.Driver.MongoAuthenticationException: Unable to authenticate using sasl protocol mechanism SCRAM-SHA-1. 
 ---&amp;gt; MongoDB.Driver.MongoCommandException: Command saslStart failed: Authentication failed..
   ... snip ...
        }
    ]
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;We see that attempting to connect to &lt;code&gt;localhost:27017&lt;/code&gt; failed because the driver was &amp;ldquo;Unable to authenticate using sasl protocol mechanism SCRAM-SHA-1.&amp;rdquo; In place of SCRAM-SHA-1 could be any other authentication protocol supported by MongoDB.&lt;/p&gt;

&lt;p&gt;Fixing this problem either involves adding the specified user to the server or restarting the application with the correct credentials and mechanisms.&lt;/p&gt;

&lt;h2 id=&#34;operation-errors&#34;&gt;Operation Errors&lt;/h2&gt;

&lt;p&gt;After successfully selecting a server to run an operation against, errors are still possible. Unlike &lt;a href=&#34;#connection-errors&#34;&gt;connection errors&lt;/a&gt;, it is sometimes possible to take action at runtime.&lt;/p&gt;

&lt;p&gt;&lt;div class=&#34;admonition note&#34;&gt;
&lt;h5 class=&#34;admonition-title&#34;&gt;Note&lt;/h5&gt;
&lt;p&gt;Most of the exceptions that are thrown from an operation inherit from &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_MongoException.htm&#34;&gt;&lt;code&gt;MongoException&lt;/code&gt;&lt;/a&gt;. In many cases, they also inherit from &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_MongoServerException.htm&#34;&gt;&lt;code&gt;MongoServerException&lt;/code&gt;&lt;/a&gt;. The server exception contains a &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/P_MongoDB_Driver_MongoServerException_ConnectionId.htm&#34;&gt;&lt;code&gt;ConnectionId&lt;/code&gt;&lt;/a&gt; which can be used to tie the operation back to a specific server and a specific connection on that server. It is then possible correllate the error you are seeing in your application with an error in the server logs.&lt;/p&gt;

&lt;/div&gt;
&lt;/p&gt;

&lt;h3 id=&#34;connection-errors-1&#34;&gt;Connection Errors&lt;/h3&gt;

&lt;p&gt;A server may go down after it was selected, but before the operation was executed. These will always manifest as a &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_MongoConnectionException.htm
&#34;&gt;&lt;code&gt;MongoConnectionException&lt;/code&gt;&lt;/a&gt;. Inspecting the inner exception will provide the actual details of the error.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;MongoDB.Driver.MongoConnectionException: An exception occurred while receiving a message from the server. 
---&amp;gt; System.IO.IOException: Unable to read data from the transport connection: Anestablished connection was aborted by the software in your host machine. 
---&amp;gt; System.Net.Sockets.SocketException: An established connection was aborted by the software in your host machine at System.Net.Sockets.Socket.BeginReceive(Byte[] buffer, Int32 offset, Int32 size, SocketFlags socketFlags, AsyncCallback callback, Object state)
   at System.Net.Sockets.NetworkStream.BeginRead(Byte[] buffer, Int32 offset, Int32 size, AsyncCallback callback, Object state)
   --- End of inner exception stack trace ---
... snip ...
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;We see from this exception that a transport connection that was successfully open at one point has been aborted.&lt;/p&gt;

&lt;p&gt;There are too many forms of this type of exception to enumerate. In general, it is not safe to retry operations that threw a &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_MongoConnectionException.htm
&#34;&gt;&lt;code&gt;MongoConnectionException&lt;/code&gt;&lt;/a&gt; unless the operation was idempotent. Simply getting an exception of this type doesn&amp;rsquo;t give any insight into whether the operations was received by the server or what happened in the server if it was received.&lt;/p&gt;

&lt;h3 id=&#34;write-exceptions&#34;&gt;Write Exceptions&lt;/h3&gt;

&lt;p&gt;When performing a write, it is possible to receive a &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_MongoWriteException.htm
&#34;&gt;&lt;code&gt;MongoWriteException&lt;/code&gt;&lt;/a&gt;. This exception has two important properties, &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/P_MongoDB_Driver_MongoWriteException_WriteError.htm
&#34;&gt;&lt;code&gt;WriteError&lt;/code&gt;&lt;/a&gt; and &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/P_MongoDB_Driver_MongoWriteException_WriteConcernError.htm
&#34;&gt;&lt;code&gt;WriteConcernError&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;h4 id=&#34;write-error&#34;&gt;Write Error&lt;/h4&gt;

&lt;p&gt;A write error means that there was an error applying the write. The cause could be many different things. The &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_WriteError.htm
&#34;&gt;&lt;code&gt;WriteError&lt;/code&gt;&lt;/a&gt; contains a number of properties which may help in the diagnosis of the problem. The &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/P_MongoDB_Driver_WriteError_Code.htm
&#34;&gt;&lt;code&gt;Code&lt;/code&gt;&lt;/a&gt; property will indicate specifically what went wrong. For general categories of errors, the driver also provides a helpful &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/P_MongoDB_Driver_WriteError_Category..htm
&#34;&gt;&lt;code&gt;Category&lt;/code&gt;&lt;/a&gt; property which classifies certain codes.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;MongoDB.Driver.MongoWriteException: A write operation resulted in an error. E11000 duplicate key error index: test.people.$_id_ dup key: { : 0 } 
---&amp;gt; MonoDB.Driver.MongoBulkWriteException`1[MongoDB.Bson.BsonDocument]: A bulk write oeration resulted in one or more errors. E11000 duplicate key error index: test.people.$_id_ dup key: { : 0 }
   at MongoDB.Driver.MongoCollectionImpl`1.&amp;lt;BulkWriteAsync&amp;gt;d__11.MoveNext() in :\projects\mongo-csharp-driver\src\MongoDB.Driver\MongoCollectionImpl.cs:line 16
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;We see from this exception that we&amp;rsquo;ve attempted to insert a document with a duplicate _id field. In this case, the write error would contain the category &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_ServerErrorCategory.htm
&#34;&gt;&lt;code&gt;DuplicateKeyError&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;h4 id=&#34;write-concern-error&#34;&gt;Write Concern Error&lt;/h4&gt;

&lt;p&gt;A &lt;a href=&#34;http://docs.mongodb.org/manual/core/write-concern/
&#34;&gt;write concern&lt;/a&gt; error indicates that the server was unable to guarantee the write operation to the level specified. See the &lt;a href=&#34;http://docs.mongodb.org/manual/core/write-concern/
&#34;&gt;server&amp;rsquo;s documentation&lt;/a&gt; for more information.&lt;/p&gt;

&lt;h3 id=&#34;bulk-write-exceptions&#34;&gt;Bulk Write Exceptions&lt;/h3&gt;

&lt;p&gt;A &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Driver_MongoBulkWriteException_1.htm
&#34;&gt;&lt;code&gt;MongoBulkWriteException&lt;/code&gt;&lt;/a&gt; will occur when using the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/M_MongoDB_Driver_IMongoCollection_1_InsertManyAsync.htm
&#34;&gt;&lt;code&gt;InsertManyAsync&lt;/code&gt;&lt;/a&gt; or &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/M_MongoDB_Driver_IMongoCollection_1_BulkWriteAsync.htm
&#34;&gt;&lt;code&gt;BulkWriteAsync&lt;/code&gt;&lt;/a&gt;. This exception is just a rollup of a bunch of individual &lt;a href=&#34;#write-error&#34;&gt;write errors&lt;/a&gt;. It also includes a &lt;a href=&#34;#write-concern-error&#34;&gt;write concern error&lt;/a&gt; and a &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/P_MongoDB_Driver_MongoBulkWriteException_1_Result.htm
&#34;&gt;&lt;code&gt;Result&lt;/code&gt;&lt;/a&gt; property.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-bash&#34;&gt;MongoDB.Driver.MongoBulkWriteException`1[MongoDB.Bson.BsonDocument]: A bulk write operation resulted in one or more errors. 
  E11000 duplicate key error index: test.people.$_id_ dup key: { : 0 }
   at MongoDB.Driver.MongoCollectionImpl`1.&amp;lt;BulkWriteAsync&amp;gt;d__11.MoveNext() in c :\projects\mongo-csharp-driver\src\MongoDB.Driver\MongoCollectionImpl.cs:line 166
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Above, we see that a duplicate key exception occured. In this case, two writes existed in the batch. Inspected the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/P_MongoDB_Driver_MongoBulkWriteException_WriteErrors.htm
&#34;&gt;&lt;code&gt;WriteErrors&lt;/code&gt;&lt;/a&gt; property would allow the identification of which write failed.&lt;/p&gt;

&lt;h4 id=&#34;ordered-writes&#34;&gt;Ordered Writes&lt;/h4&gt;

&lt;p&gt;Bulk writes are allowed to be processed either in order or without order. When processing in order, the first error that occurs will stop the processing of all subsequent writes. In this case, all of the unprocessed writes will be available via the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/P_MongoDB_Driver_MongoBulkWriteException_1_UnprocessedRequests.htm
&#34;&gt;&lt;code&gt;UnprocessedRequests&lt;/code&gt;&lt;/a&gt; property.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Expressions</title>
      <link>/mongo-csharp-driver/2.0/reference/driver/expressions/</link>
      <pubDate>Tue, 17 Mar 2015 15:36:56 +0000</pubDate>
      
      <guid>/mongo-csharp-driver/2.0/reference/driver/expressions/</guid>
      <description>

&lt;h2 id=&#34;expressions&#34;&gt;Expressions&lt;/h2&gt;

&lt;p&gt;Many methods in the driver accept expressions as an argument.&lt;/p&gt;

&lt;p&gt;For the rest of this page, we&amp;rsquo;ll use the following class:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;class Person
{
    public string Name { get; set; }

    public int Age { get; set; }

    public IEnumerable&amp;lt;Pet&amp;gt; Pets { get; set; }

    public int[] FavoriteNumbers { get; set; }

    public HashSet&amp;lt;string&amp;gt; FavoriteNames { get; set; }

    public DateTime CreatedAtUtc { get; set; }
}

class Pet
{
    public string Name { get; set; }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;filters&#34;&gt;Filters&lt;/h2&gt;

&lt;p&gt;We&amp;rsquo;ll walk through the supported expressions below. The &lt;a href=&#34;https://github.com/mongodb/mongo-csharp-driver/blob/master/src/MongoDB.Driver.Tests/Linq/Translators/PredicateTranslatorTests.cs
&#34;&gt;tests&lt;/a&gt; are also a good reference.&lt;/p&gt;

&lt;h3 id=&#34;comparison&#34;&gt;Comparison&lt;/h3&gt;

&lt;p&gt;See the &lt;a href=&#34;http://docs.mongodb.org/manual/reference/operator/query/#comparison
&#34;&gt;MongoDB documentation&lt;/a&gt; for more information on each operator.&lt;/p&gt;

&lt;h4 id=&#34;eq&#34;&gt;$eq&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;Find(p =&amp;gt; p.Name == &amp;quot;Jack&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;becomes:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ Name: &#39;Jack&#39; }
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;div class=&#34;admonition note&#34;&gt;
&lt;h5 class=&#34;admonition-title&#34;&gt;Note&lt;/h5&gt;
This is the short form for equality. Depending on context, this might generate &lt;code&gt;{ Name: { $eq: &#39;Jack&#39; } }&lt;/code&gt;.
&lt;/div&gt;
&lt;/p&gt;

&lt;h4 id=&#34;gt&#34;&gt;$gt&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;Find(p =&amp;gt; p.Age &amp;gt; 10);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ Age: { $gt: 10 } }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;gte&#34;&gt;$gte&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;Find(p =&amp;gt; p.Age &amp;gt;= 10);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ Age: { $gte: 10 } }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;lt&#34;&gt;$lt&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;Find(p =&amp;gt; p.Age &amp;lt; 10);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ Age: { $lt: 10 } }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;lte&#34;&gt;$lte&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;Find(p =&amp;gt; p.Age &amp;lt;= 10);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ Age: { $lte: 10 } }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;ne&#34;&gt;$ne&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;Find(p =&amp;gt; p.Age != 10);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ Age: { $ne: 10 } }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;in&#34;&gt;$in&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;int[] localAges = new [] { 10, 20, 30 };
Find(p =&amp;gt; localAges.Contains(p.Age));
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ Age: { $in: [10, 20, 30] } }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;nin&#34;&gt;$nin&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;int[] localAges = new [] { 10, 20, 30 };
Find(p =&amp;gt; !localAges.Contains(p.Age));
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ Age: { $nin: [10, 20, 30] } }
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;logical&#34;&gt;Logical&lt;/h3&gt;

&lt;p&gt;See the &lt;a href=&#34;http://docs.mongodb.org/manual/reference/operator/query/#logical
&#34;&gt;MongoDB documentation&lt;/a&gt; for more information on each operator.&lt;/p&gt;

&lt;h4 id=&#34;or&#34;&gt;$or&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;Find(p =&amp;gt; p.Name == &amp;quot;Jack&amp;quot; || p.Age == 10);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $or: [{ Name: &#39;Jack&#39; }, { Age: 10 }] }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;and&#34;&gt;$and&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;Find(p =&amp;gt; p.Name == &amp;quot;Jack&amp;quot; &amp;amp;&amp;amp; p.Age &amp;lt; 40);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ Name: &#39;Jack&#39;, Age: { $lt: 40 } }
&lt;/code&gt;&lt;/pre&gt;

&lt;hr /&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;Find(p =&amp;gt; p.Age &amp;gt; 30 &amp;amp;&amp;amp; p.Age &amp;lt; 40);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ Age: { $gt: 30, $lt: 40 }
&lt;/code&gt;&lt;/pre&gt;

&lt;hr /&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;Find(p =&amp;gt; p.Name != &amp;quot;Jack&amp;quot; &amp;amp;&amp;amp; p.Name != &amp;quot;Jim&amp;quot;);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $and: [{ Name: { $ne: &#39;Jack&#39; } }, { Name: { $ne: &#39;Jim&#39; } }] }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;not&#34;&gt;$not&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;// no example yet
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;nor&#34;&gt;$nor&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;// no example yet
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;element&#34;&gt;Element&lt;/h3&gt;

&lt;p&gt;See the &lt;a href=&#34;http://docs.mongodb.org/manual/reference/operator/query/#element
&#34;&gt;MongoDB documentation&lt;/a&gt; for more information on each operator.&lt;/p&gt;

&lt;h4 id=&#34;exists&#34;&gt;$exists&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;// no example yet
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;type&#34;&gt;$type&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;// no example yet
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;evaluation&#34;&gt;Evaluation&lt;/h3&gt;

&lt;p&gt;See the &lt;a href=&#34;http://docs.mongodb.org/manual/reference/operator/query/#evaluation
&#34;&gt;MongoDB documentation&lt;/a&gt; for more information on each operator.&lt;/p&gt;

&lt;h4 id=&#34;mod&#34;&gt;$mod&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;// no example yet
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;regex&#34;&gt;$regex&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;// no example yet
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;text&#34;&gt;$text&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;// no example yet
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;where&#34;&gt;$where&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;// no example yet
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;geospatial&#34;&gt;Geospatial&lt;/h3&gt;

&lt;p&gt;See the &lt;a href=&#34;http://docs.mongodb.org/manual/reference/operator/query/#geospatial
&#34;&gt;MongoDB documentation&lt;/a&gt; for more information on each operator.&lt;/p&gt;

&lt;h4 id=&#34;geowithin&#34;&gt;$geoWithin&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;// no example yet
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;geointersects&#34;&gt;$geoIntersects&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;// no example yet
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;near&#34;&gt;$near&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;// no example yet
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;nearsphere&#34;&gt;$nearSphere&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;// no example yet
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;geospatial-1&#34;&gt;Geospatial&lt;/h3&gt;

&lt;p&gt;See the &lt;a href=&#34;http://docs.mongodb.org/manual/reference/operator/query/#array
&#34;&gt;MongoDB documentation&lt;/a&gt; for more information on each operator.&lt;/p&gt;

&lt;h4 id=&#34;all&#34;&gt;$all&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;// no example yet
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;elemmatch&#34;&gt;$elemMatch&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;Find(x =&amp;gt; x.Pets.Any(p =&amp;gt; p.Name == &amp;quot;Fluffy&amp;quot;);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ Pets: { $elemMatch: { Name: &#39;Fluffy&#39; } } }
&lt;/code&gt;&lt;/pre&gt;

&lt;hr /&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;Find(x =&amp;gt; x.FavoriteNumbers.Any(n =&amp;gt; n &amp;gt; 21));
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ FavoriteNumbers: { $elemMatch: { { $gt: 21 } } } }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;size&#34;&gt;$size&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;Find(x =&amp;gt; x.FavoriteNumbers.Length == 3);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ FavoriteNumbers: { $size: 3 } }
&lt;/code&gt;&lt;/pre&gt;

&lt;hr /&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;Find(x =&amp;gt; x.FavoriteNumbers.Length != 3);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ FavoriteNumbers: { $not: { $size: 3 } } }
&lt;/code&gt;&lt;/pre&gt;

&lt;hr /&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;Find(x =&amp;gt; x.FavoriteNumbers.Any());
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ FavoriteNumbers: { $ne: null, $not: { $size: 0 } } }
&lt;/code&gt;&lt;/pre&gt;

&lt;hr /&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;Find(x =&amp;gt; x.FavoriteNumbers.Count() == 3);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ FavoriteNumbers: { $size: 3 } }
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;aggregation-projections&#34;&gt;Aggregation Projections&lt;/h2&gt;

&lt;p&gt;We&amp;rsquo;ll walk through the supported expressions below. The &lt;a href=&#34;https://github.com/mongodb/mongo-csharp-driver/blob/master/src/MongoDB.Driver.Tests/Linq/Translators/AggregateProjectionTranslatorTests_Project.cs
&#34;&gt;tests&lt;/a&gt; are also a good reference.&lt;/p&gt;

&lt;h3 id=&#34;boolean-expressions&#34;&gt;Boolean Expressions&lt;/h3&gt;

&lt;p&gt;See the &lt;a href=&#34;http://docs.mongodb.org/manual/meta/aggregation-quick-reference/#boolean-expressions
&#34;&gt;MongoDB documentation&lt;/a&gt; for more information on each operator.&lt;/p&gt;

&lt;h4 id=&#34;and-1&#34;&gt;$and&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.Name == &amp;quot;Jack&amp;quot; &amp;amp;&amp;amp; p.Age &amp;lt; 40
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $and: [{ $eq: [&#39;$Name&#39;, &#39;Jack&#39;] }, { $lt: [&#39;$Age&#39;, 40] }] }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;or-1&#34;&gt;$or&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.Name == &amp;quot;Jack&amp;quot; || p.Age &amp;lt; 40
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $or: [{ $eq: [&#39;$Name&#39;, &#39;Jack&#39;] }, { $lt: [&#39;$Age&#39;, 40] }] }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;not-1&#34;&gt;$not&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; !(p.Name == &amp;quot;Jack&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $not: [{ $eq: [&#39;$Name&#39;, &#39;Jack&#39;] }]] }
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;set-expressions&#34;&gt;Set Expressions&lt;/h3&gt;

&lt;p&gt;See the &lt;a href=&#34;http://docs.mongodb.org/manual/meta/aggregation-quick-reference/#set-expressions
&#34;&gt;MongoDB documentation&lt;/a&gt; for more information on each operator.&lt;/p&gt;

&lt;h4 id=&#34;setequals&#34;&gt;$setEquals&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.FavoriteNames.SetEquals(new [] { &amp;quot;Jack&amp;quot;, &amp;quot;Jane&amp;quot; });
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $setEquals: [&#39;$FavoriteNames&#39;, [ &#39;Jack&#39;, &#39;Jane&#39;] ] }
&lt;/code&gt;&lt;/pre&gt;

&lt;hr /&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;var localSet = new HashSet&amp;lt;int&amp;gt;(new [] { 1, 3, 5 });

p =&amp;gt; localSet.SetEquals(p.FavoriteNumbers);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $setEquals: [ [1, 3, 5], &#39;$FavoriteNumbers&#39; ] }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;setintersection&#34;&gt;$setIntersection&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.FavoriteNumbers.Intersect(new [] { 1, 3 });
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $setIntersection: [ &#39;$FavoriteNumbers&#39;, [ 1, 3 ] ] }
&lt;/code&gt;&lt;/pre&gt;

&lt;hr /&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; new [] { 1, 3 }.Intersect(p.FavoriteNumbers);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $setIntersection: [ [ 1, 3 ], &#39;$FavoriteNumbers&#39; ] }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;setunion&#34;&gt;$setUnion&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.FavoriteNumbers.Union(new [] { 1, 3 });
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $setUnion: [ &#39;$FavoriteNumbers&#39;, [ 1, 3 ] ] }
&lt;/code&gt;&lt;/pre&gt;

&lt;hr /&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; new [] { 1, 3 }.Union(p.FavoriteNumbers);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $setUnion: [ [ 1, 3 ], &#39;$FavoriteNumbers&#39; ] }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;setdifference&#34;&gt;$setDifference&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.FavoriteNumbers.Except(new [] { 1, 3 });
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $setDifference: [ &#39;$FavoriteNumbers&#39;, [ 1, 3 ] ] }
&lt;/code&gt;&lt;/pre&gt;

&lt;hr /&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; new [] { 1, 3 }.Except(p.FavoriteNumbers);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $setDifference: [ [ 1, 3 ], &#39;$FavoriteNumbers&#39; ] }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;setissubset&#34;&gt;$setIsSubset&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.FavoriteNames.IsSubsetOf(new [] { &amp;quot;Jack&amp;quot;, &amp;quot;Jane&amp;quot; });
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $setIsSubset: [&#39;$FavoriteNames&#39;, [ &#39;Jack&#39;, &#39;Jane&#39;] ] }
&lt;/code&gt;&lt;/pre&gt;

&lt;hr /&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;var localSet = new HashSet&amp;lt;int&amp;gt;(new [] { 1, 3, 5 });

p =&amp;gt; localSet.IsSubsetOf(p.FavoriteNumbers);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $setIsSubset: [ [1, 3, 5], &#39;$FavoriteNumbers&#39; ] }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;anyelementtrue&#34;&gt;$anyElementTrue&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.FavoriteNumbers.Any(x =&amp;gt; x &amp;gt; 20);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $anyElementTrue: { $map: { input: &#39;$FavoriteNumbers&#39;, as: &#39;x&#39;, in: { $gt: [ &#39;$$x&#39;, 20 ] } } } }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;allelementstrue&#34;&gt;$allElementsTrue&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.FavoriteNumbers.All(x =&amp;gt; x &amp;gt; 20);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $allElementsTrue: { $map: { input: &#39;$FavoriteNumbers&#39;, as: &#39;x&#39;, in: { $gt: [ &#39;$$x&#39;, 20 ] } } } }
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;comparison-expressions&#34;&gt;Comparison Expressions&lt;/h3&gt;

&lt;p&gt;See the &lt;a href=&#34;http://docs.mongodb.org/manual/meta/aggregation-quick-reference/#comparison-expressions
&#34;&gt;MongoDB documentation&lt;/a&gt; for more information on each operator.&lt;/p&gt;

&lt;h4 id=&#34;cmp&#34;&gt;$cmp&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.Name.CompareTo(&amp;quot;Jimmy&amp;quot;);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $cmp: [ &#39;$Name&#39;, &#39;Jimmy&#39; ] }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;eq-1&#34;&gt;$eq&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.Name == &amp;quot;Jimmy&amp;quot;;
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $eq: [ &#39;$Name&#39;, &#39;Jimmy&#39; ] }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;gt-1&#34;&gt;$gt&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.Age &amp;gt; 20;
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $gt: [ &#39;$Age&#39;, 20 ] }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;gte-1&#34;&gt;$gte&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.Age &amp;gt;= 20;
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $gte: [ &#39;$Age&#39;, 20 ] }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;lt-1&#34;&gt;$lt&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.Age &amp;lt; 20;
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $lt: [ &#39;$Age&#39;, 20 ] }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;lte-1&#34;&gt;$lte&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.Age &amp;lt;= 20;
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $lte: [ &#39;$Age&#39;, 20 ] }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;ne-1&#34;&gt;$ne&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.Age != 20;
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $ne: [ &#39;$Age&#39;, 20 ] }
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;arithmetic-expressions&#34;&gt;Arithmetic Expressions&lt;/h3&gt;

&lt;p&gt;See the &lt;a href=&#34;http://docs.mongodb.org/manual/meta/aggregation-quick-reference/#arithmetic-expressions
&#34;&gt;MongoDB documentation&lt;/a&gt; for more information on each operator.&lt;/p&gt;

&lt;h4 id=&#34;add&#34;&gt;$add&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.Age + 2;
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $add: [ &#39;$Age&#39;, 2 ] }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;subtract&#34;&gt;$subtract&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.Age - 2;
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $subtract: [ &#39;$Age&#39;, 2 ] }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;multiply&#34;&gt;$multiply&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.Age * 2;
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $multiply: [ &#39;$Age&#39;, 2 ] }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;divide&#34;&gt;$divide&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.Age / 2;
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $divide: [ &#39;$Age&#39;, 2 ] }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;mod-1&#34;&gt;$mod&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.Age % 2;
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $mod: [ &#39;$Age&#39;, 2 ] }
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;string-expressions&#34;&gt;String Expressions&lt;/h3&gt;

&lt;p&gt;See the &lt;a href=&#34;http://docs.mongodb.org/manual/meta/aggregation-quick-reference/#string-expressions
&#34;&gt;MongoDB documentation&lt;/a&gt; for more information on each operator.&lt;/p&gt;

&lt;h4 id=&#34;concat&#34;&gt;$concat&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.Name + &amp;quot;Awesome&amp;quot;;
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $concat: [ &#39;$Name&#39;, &#39;Awesome&#39; ] }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;substr&#34;&gt;$substr&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.Name.Substring(3, 20)
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $substr: [ &#39;$Name&#39;, 3, 20 ] }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;tolower&#34;&gt;$toLower&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.Name.ToLower()
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $toLower: &#39;$Name&#39; }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;toupper&#34;&gt;$toUpper&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.Name.ToUpper()
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $toUpper: &#39;$Name&#39; }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;strcasecmp&#34;&gt;$strcasecmp&lt;/h4&gt;

&lt;p&gt;You must use &lt;code&gt;StringComparison.OrdinalIgnoreCase&lt;/code&gt; for this method.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.Name.Equals(&amp;quot;balloon&amp;quot;, StringComparison.OrdinalIgnoreCase);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $strcasecmp: [&#39;$Name&#39;, &#39;balloon&#39; ] }
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;text-search-expressions&#34;&gt;Text Search Expressions&lt;/h3&gt;

&lt;p&gt;See the &lt;a href=&#34;http://docs.mongodb.org/manual/meta/aggregation-quick-reference/#text-search-expressions
&#34;&gt;MongoDB documentation&lt;/a&gt; for more information on each operator.&lt;/p&gt;

&lt;h4 id=&#34;meta&#34;&gt;$meta&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;// no example yet
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;array-expressions&#34;&gt;Array Expressions&lt;/h3&gt;

&lt;p&gt;See the &lt;a href=&#34;http://docs.mongodb.org/manual/meta/aggregation-quick-reference/#array-expressions
&#34;&gt;MongoDB documentation&lt;/a&gt; for more information on each operator.&lt;/p&gt;

&lt;h4 id=&#34;size-1&#34;&gt;$size&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.FavoriteNumbers.Length;
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $size: &#39;$FavoriteNumbers&#39; }
&lt;/code&gt;&lt;/pre&gt;

&lt;hr /&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.FavoriteNumbers.Count();
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $size: &#39;$FavoriteNumbers&#39; }
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;variable-expressions&#34;&gt;Variable Expressions&lt;/h3&gt;

&lt;p&gt;See the &lt;a href=&#34;http://docs.mongodb.org/manual/meta/aggregation-quick-reference/#variable-expressions
&#34;&gt;MongoDB documentation&lt;/a&gt; for more information on each operator.&lt;/p&gt;

&lt;h4 id=&#34;map&#34;&gt;$map&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.Pets.Select(x =&amp;gt; x.Name + &amp;quot; is awesome&amp;quot;);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $map: { input: &#39;$Name&#39;, as: &#39;x&#39;, in: { $concat: [ &#39;$$x&#39;, &#39; is awesome&#39; ] } } }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;let&#34;&gt;$let&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;// no example yet
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;literal-expressions&#34;&gt;Literal Expressions&lt;/h3&gt;

&lt;p&gt;See the &lt;a href=&#34;http://docs.mongodb.org/manual/meta/aggregation-quick-reference/#literal-expressions
&#34;&gt;MongoDB documentation&lt;/a&gt; for more information on each operator.&lt;/p&gt;

&lt;h4 id=&#34;literal&#34;&gt;$literal&lt;/h4&gt;

&lt;p&gt;The only time &lt;code&gt;$literal&lt;/code&gt; will be used from the driver is if the constant starts with a &lt;code&gt;$&lt;/code&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.Name == &amp;quot;$1&amp;quot;);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $eq: [ &#39;$Name&#39;, { $literal: &#39;$1&#39; } ] }
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;date-expressions&#34;&gt;Date Expressions&lt;/h3&gt;

&lt;p&gt;See the &lt;a href=&#34;http://docs.mongodb.org/manual/meta/aggregation-quick-reference/#date-expressions
&#34;&gt;MongoDB documentation&lt;/a&gt; for more information on each operator.&lt;/p&gt;

&lt;h4 id=&#34;dayofyear&#34;&gt;$dayOfYear&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.CreatedAtUtc.DayOfYear);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $dayOfYear: &#39;$CreatedAtUtc&#39; }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;dayofmonth&#34;&gt;$dayOfMonth&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.CreatedAtUtc.Day);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $dayOfMonth: &#39;$CreatedAtUtc&#39; }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;dayofweek&#34;&gt;$dayOfWeek&lt;/h4&gt;

&lt;p&gt;The .NET constant for day of week is 1 less than that in MongoDB. As such, we must subtract 1 from the MongoDB version in order for mapping back to the .NET type to be accurate.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.CreatedAtUtc.DayOfWeek);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $subtract: [ { $dayOfWeek: &#39;$CreatedAtUtc&#39; }, 1 ] }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;year&#34;&gt;$year&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.CreatedAtUtc.Year);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $year: &#39;$CreatedAtUtc&#39; }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;month&#34;&gt;$month&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.CreatedAtUtc.Month);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $month: &#39;$CreatedAtUtc&#39; }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;week&#34;&gt;$week&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;// no example yet
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;hour&#34;&gt;$hour&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.CreatedAtUtc.Hour);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $hour: &#39;$CreatedAtUtc&#39; }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;minute&#34;&gt;$minute&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.CreatedAtUtc.Minute);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $minute: &#39;$CreatedAtUtc&#39; }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;second&#34;&gt;$second&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.CreatedAtUtc.Second);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $second: &#39;$CreatedAtUtc&#39; }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;millisecond&#34;&gt;$millisecond&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.CreatedAtUtc.Millisecond);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $millisecond: &#39;$CreatedAtUtc&#39; }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;datetostring&#34;&gt;$dateToString&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;// no example yet
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;conditional-expressions&#34;&gt;Conditional Expressions&lt;/h3&gt;

&lt;p&gt;See the &lt;a href=&#34;http://docs.mongodb.org/manual/meta/aggregation-quick-reference/#conditional-expressions
&#34;&gt;MongoDB documentation&lt;/a&gt; for more information on each operator.&lt;/p&gt;

&lt;h4 id=&#34;cond&#34;&gt;$cond&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.Name == &amp;quot;Jack&amp;quot; ? &amp;quot;a&amp;quot; : &amp;quot;b&amp;quot;;
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $cond: [ { $eq: [ &#39;$Name&#39;, &#39;Jack&#39; ] }, &#39;a&#39;, &#39;b&#39; ] }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;ifnull&#34;&gt;$ifNull&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;p =&amp;gt; p.Name ?? &amp;quot;awesome&amp;quot;;
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $ifNull: [ &#39;$Name&#39;, &#39;awesome&#39; ] }
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;accumulators&#34;&gt;Accumulators&lt;/h3&gt;

&lt;p&gt;See the &lt;a href=&#34;http://docs.mongodb.org/manual/meta/aggregation-quick-reference/#accumulators
&#34;&gt;MongoDB documentation&lt;/a&gt; for more information on each operator.&lt;/p&gt;

&lt;p&gt;Also, the &lt;a href=&#34;https://github.com/mongodb/mongo-csharp-driver/blob/master/src/MongoDB.Driver.Tests/Linq/Translators/AggregateProjectionTranslatorTests_Group.cs
&#34;&gt;tests&lt;/a&gt; are a good reference.&lt;/p&gt;

&lt;p&gt;&lt;div class=&#34;admonition note&#34;&gt;
&lt;h5 class=&#34;admonition-title&#34;&gt;Note&lt;/h5&gt;
These are only supported in a grouping expression.
&lt;/div&gt;
&lt;/p&gt;

&lt;p&gt;In the examples below, it should be assumed that &lt;code&gt;g&lt;/code&gt; is of type &lt;a href=&#34;https://msdn.microsoft.com/en-us/library/bb344977.aspx&#34;&gt;&lt;code&gt;IGrouping&amp;lt;TKey, TElement&amp;gt;&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;h4 id=&#34;sum&#34;&gt;$sum&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;g =&amp;gt; g.Sum(x =&amp;gt; x.Age);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $sum: &#39;$Age&#39; }
&lt;/code&gt;&lt;/pre&gt;

&lt;hr /&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;g =&amp;gt; g.Count()
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $sum: 1 }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;avg&#34;&gt;$avg&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;g =&amp;gt; g.Average(x =&amp;gt; x.Age);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $avg: &#39;$Age&#39; }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;first&#34;&gt;$first&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;g =&amp;gt; g.First().Age);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $first: &#39;$Age&#39; }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;last&#34;&gt;$last&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;g =&amp;gt; g.Last().Age);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $last: &#39;$Age&#39; }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;max&#34;&gt;$max&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;g =&amp;gt; g.Max(x =&amp;gt; x.Age);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $max: &#39;$Age&#39; }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;min&#34;&gt;$min&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;g =&amp;gt; g.Min(x =&amp;gt; x.Age);
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $min: &#39;$Age&#39; }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;push&#34;&gt;$push&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;g =&amp;gt; g.Select(p =&amp;gt; p.Name)
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $push: &#39;$Name&#39; }
&lt;/code&gt;&lt;/pre&gt;

&lt;hr /&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;g =&amp;gt; g.Select(p =&amp;gt; p.Name).ToArray()
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $push: &#39;$Name&#39; }
&lt;/code&gt;&lt;/pre&gt;

&lt;hr /&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;g =&amp;gt; g.Select(p =&amp;gt; p.Name).ToList()
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $push: &#39;$Name&#39; }
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;addtoset&#34;&gt;$addToSet&lt;/h4&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;g =&amp;gt; new HashSet&amp;lt;string&amp;gt;(g.Select(p =&amp;gt; p.Name));
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $addToSet: &#39;$Name&#39; }
&lt;/code&gt;&lt;/pre&gt;

&lt;hr /&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;g =&amp;gt; g.Select(p =&amp;gt; p.Name).Distinct();
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ $addToSet: &#39;$Name&#39; }
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
    <item>
      <title>Handling Schema Changes</title>
      <link>/mongo-csharp-driver/2.0/reference/bson/mapping/schema_changes/</link>
      <pubDate>Tue, 17 Mar 2015 15:36:56 +0000</pubDate>
      
      <guid>/mongo-csharp-driver/2.0/reference/bson/mapping/schema_changes/</guid>
      <description>

&lt;h2 id=&#34;handling-schema-changes&#34;&gt;Handling Schema Changes&lt;/h2&gt;

&lt;p&gt;Just because MongoDB is schema-less does not mean that your code can handle a schema-less document. Most likely, if you are using a statically typed language like C# or VB.NET, then your code is not flexible and needs to be mapped to a known schema.&lt;/p&gt;

&lt;p&gt;There are a number of different ways that a schema can change from one version of your application to the next.&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;&lt;a href=&#34;#a-member-has-been-added&#34;&gt;A new member is added&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#a-member-has-been-removed&#34;&gt;A member is removed&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#a-member-has-been-renamed&#34;&gt;A member is renamed&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#the-type-of-a-member-is-changed&#34;&gt;The type of a member is changed&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;#the-representation-of-a-member-is-changed&#34;&gt;The representation of a member is changed&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;How you handle these is up to you. There are two different strategies:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;Write an upgrade script.&lt;/li&gt;
&lt;li&gt;Incrementally update your documents as they are used.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;The easiest strategy is to write an upgrade script. There is effectively no difference to this method between a relational database (SQL Server, Oracle) and MongoDB. Identify the documents that need to be changed and update them.&lt;/p&gt;

&lt;p&gt;Alternatively, and not supportable in most relational databases, is the incremental upgrade. The idea is that your documents get updated as they are used. Documents that are never used never get updated. Because of this, there are some definite pitfalls you will need to be aware of.&lt;/p&gt;

&lt;p&gt;First, queries against a schema where half the documents are version 1 and half the documents are version 2 could go awry. For instance, if you rename an element, then your query will need to test both the old element name and the new element name to get all the results.&lt;/p&gt;

&lt;p&gt;Second, any incremental upgrade code must stay in the code-base until all the documents have been upgraded. For instance, if there have been 3 versions of a document, [1, 2, and 3] and we remove the upgrade code from version 1 to version 2, any documents that still exist as version 1 are un-upgradeable.&lt;/p&gt;

&lt;h2 id=&#34;a-member-has-been-added&#34;&gt;A Member Has Been Added&lt;/h2&gt;

&lt;p&gt;When a new member is added to an entity, there is nothing that needs to be done other than restarting the application if you are using the auto mapping features. If not, then you will manually need to map the member in the same way all the other members are getting mapped.&lt;/p&gt;

&lt;p&gt;Existing documents will not have this element and it will show up in your class with its default value. You can, of course, specify a default value.&lt;/p&gt;

&lt;h2 id=&#34;a-member-has-been-removed&#34;&gt;A Member Has Been Removed&lt;/h2&gt;

&lt;p&gt;When a member has been removed from am entity, it will continue to exist in the documents. The serializer will throw an exception when this element is seen because it doesn’t know what to do with it. See the sections on &lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/bson/mapping/#supporting-extra-elements&#34;&gt;supporting extra elements&lt;/a&gt; and &lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/bson/mapping/#ignoring-extra-elements&#34;&gt;ignoring extra elements&lt;/a&gt; for information on how to deal with this.&lt;/p&gt;

&lt;h2 id=&#34;a-member-has-been-renamed&#34;&gt;A Member Has Been Renamed&lt;/h2&gt;

&lt;p&gt;When a member has been renamed, it will exist in old documents with the old name and in new documents with the new name. The way to handle incremental upgrades for this rename would be to implement an &lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/bson/mapping/#supporting-extra-elements&#34;&gt;ExtraElements&lt;/a&gt; member in conjunction with &lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/bson/mapping/#issuportinitialize&#34;&gt;ISupportInitialize&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;For example, let’s say that a class used to have a &lt;code&gt;Name&lt;/code&gt; property which has now been split into a &lt;code&gt;FirstName&lt;/code&gt; and a &lt;code&gt;LastName&lt;/code&gt; property.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;public class MyClass : ISupportInitialize 
{
    public string FirstName { get; set; }
    public string LastName { get; set; }

    [BsonExtraElements]
    public IDictionary&amp;lt;string, object&amp;gt; ExtraElements { get; set; }

    void ISupportInitialize.BeginInit() 
    {
        // nothing to do at beginning
    }

    void ISupportInitialize.EndInit() 
    {
        object nameValue;
        if (!ExtraElements.TryGetValue(&amp;quot;Name&amp;quot;, out nameValue)) {
            return;
        }

        var name = (string)nameValue;

        // remove the Name element so that it doesn&#39;t get persisted back to the database
        ExtraElements.Remove(&amp;quot;Name&amp;quot;);

        // assuming all names are &amp;quot;First Last&amp;quot;
        var nameParts = name.Split(&#39; &#39;);

        FirstName = nameParts[0];
        LastName = nameParts[1];
    }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;the-type-of-a-member-is-changed&#34;&gt;The Type of a Member Is Changed&lt;/h2&gt;

&lt;p&gt;If the .NET type is compatible with the old type (an integer is changed to a double), then everything will continue to work. Otherwise, a custom serializer or a migration script will be required.&lt;/p&gt;

&lt;h2 id=&#34;the-representation-of-a-member-is-changed&#34;&gt;The Representation of a Member Is Changed&lt;/h2&gt;

&lt;p&gt;If the &lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/bson/mapping/#representation&#34;&gt;representation of a member&lt;/a&gt; is changed and the representations are compatible, then everything will continue to work. Otherwise, a custom serializer or a migration script will be required.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Mapping Classes</title>
      <link>/mongo-csharp-driver/2.0/reference/bson/mapping/</link>
      <pubDate>Tue, 17 Mar 2015 15:36:56 +0000</pubDate>
      
      <guid>/mongo-csharp-driver/2.0/reference/bson/mapping/</guid>
      <description>

&lt;h2 id=&#34;mapping-classes&#34;&gt;Mapping Classes&lt;/h2&gt;

&lt;p&gt;Using a &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_BsonDocument.htm
&#34;&gt;&lt;code&gt;BsonDocument&lt;/code&gt;&lt;/a&gt; will work when a schema is fluid and dynamic. However, most applications are built with a schema modeled in the application itself rather than the database. In these cases, it is likely that the application uses classes.&lt;/p&gt;

&lt;p&gt;The .NET BSON library supports mapping these classes to and from BSON/JSON using a &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_BsonClassMap_1.htm
&#34;&gt;&lt;code&gt;BsonClassMap&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;h2 id=&#34;creating-a-class-map&#34;&gt;Creating a Class Map&lt;/h2&gt;

&lt;p&gt;In a majority of cases, the driver will be able to automatically map your class for you. This will happen if you begin to use a class for which no &lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/bson/serialization/#serializers&#34;&gt;serializer&lt;/a&gt; has yet been registered in the &lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/bson/serialization/#serializer-registry&#34;&gt;serializer registry&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;You can choose to register the class map using the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/M_MongoDB_Bson_Serialization_BsonClassMap_RegisterClassMap__1_1.htm
&#34;&gt;&lt;code&gt;RegisterClassMap&lt;/code&gt;&lt;/a&gt; method:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;BsonClassMap.RegisterClassMap&amp;lt;MyClass&amp;gt;();
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;div class=&#34;admonition note&#34;&gt;
&lt;h5 class=&#34;admonition-title&#34;&gt;Note&lt;/h5&gt;
It is very important that the registration of class maps occur prior to them being needed. The best place to register them is at app startup prior to initializing a connection with MongoDB.
&lt;/div&gt;
&lt;/p&gt;

&lt;p&gt;If you want to control the creation of the class map, you can provide your own initialization code in the form of a lambda expression:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;BsonClassMap.RegisterClassMap&amp;lt;MyClass&amp;gt;(cm =&amp;gt; 
{
    cm.MapMember(c =&amp;gt; c.SomeProperty);
    cm.MapMember(c =&amp;gt; c.AnotherProperty);
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;When your lambda expression is executed, the &lt;code&gt;cm&lt;/code&gt; (short for class map) parameter is passed an empty class map for you to fill in. In this example, two properties are added to the class map by calling the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/M_MongoDB_Bson_Serialization_BsonClassMap_1_MapMember__1.htm
&#34;&gt;&lt;code&gt;MapMember&lt;/code&gt;&lt;/a&gt; method. The arguments to the method are themselves lambda expressions which identify the member of the class. The advantage of using a lambda expression instead of just a string parameter with the name of the property is that Intellisense and compile time checking ensure that you can’t misspell the name of the property.&lt;/p&gt;

&lt;h2 id=&#34;automap&#34;&gt;AutoMap&lt;/h2&gt;

&lt;p&gt;It is also possible to use automapping and then override some of the results using the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/M_MongoDB_Bson_Serialization_BsonClassMap_AutoMap.htm
&#34;&gt;&lt;code&gt;AutoMap&lt;/code&gt;&lt;/a&gt; method. This method should be called first in the lambda expression.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;BsonClassMap.RegisterClassMap&amp;lt;MyClass&amp;gt;(cm =&amp;gt; 
{
    cm.AutoMap();
    cm.MapMember(c =&amp;gt; c.SomeProperty);
    cm.MapMember(c =&amp;gt; c.AnotherProperty);
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/M_MongoDB_Bson_Serialization_BsonClassMap_AutoMap.htm
&#34;&gt;&lt;code&gt;AutoMap&lt;/code&gt;&lt;/a&gt; uses conventions to map the class and its members. See the &lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/bson/mapping/conventions/&#34;&gt;convention documentation&lt;/a&gt; for more information.&lt;/p&gt;

&lt;h2 id=&#34;class-customization&#34;&gt;Class Customization&lt;/h2&gt;

&lt;p&gt;There are several serialization options that are related to the class itself instead of to any particular field or property. You can set these class level options either by decorating the class with serialization related attributes or by writing initialization code.&lt;/p&gt;

&lt;h3 id=&#34;ignoring-extra-elements&#34;&gt;Ignoring Extra Elements&lt;/h3&gt;

&lt;p&gt;When a BSON document is deserialized, the name of each element is used to look up a matching member in the class map. Normally, if no matching member is found, an exception will be thrown. If you want to ignore extra elements during deserialization, use a &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_Attributes_BsonIgnoreExtraElementsAttribute.htm
&#34;&gt;&lt;code&gt;BsonIgnoreExtraElementsAttribute&lt;/code&gt;&lt;/a&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;[BsonIgnoreExtraElements]
public MyClass 
{
    // fields and properties
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Or via code:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;BsonClassMap.RegisterClassMap&amp;lt;MyClass&amp;gt;(cm =&amp;gt; 
{
    cm.AutoMap();
    cm.SetIgnoreExtraElements(true);
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;div class=&#34;admonition important&#34;&gt;
&lt;h5 class=&#34;admonition-title&#34;&gt;important&lt;/h5&gt;
When you ignore extra elements, if the class is rendered back to BSON, those extra elements will not exist and may be lost forever.
&lt;/div&gt;
&lt;/p&gt;

&lt;h3 id=&#34;supporting-extra-elements&#34;&gt;Supporting Extra Elements&lt;/h3&gt;

&lt;p&gt;You can design your class to be capable of handling any extra elements that might be found in a BSON document during deserialization. To do so, you must have a property of type &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_BsonDocument.htm
&#34;&gt;&lt;code&gt;BsonDocument&lt;/code&gt;&lt;/a&gt; (or &lt;a href=&#34;https://msdn.microsoft.com/en-us/library/s4ys34ea.aspx&#34;&gt;&lt;code&gt;IDictionary&amp;lt;string, object&amp;gt;&lt;/code&gt;&lt;/a&gt;) and you must identify that property as the one that should hold any extra elements that are found. By &lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/bson/mapping/conventions/&#34;&gt;convention&lt;/a&gt;, the member may be named &lt;code&gt;ExtraElements&lt;/code&gt;. For example:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;public MyClass 
{
    // fields and properties
    [BsonExtraElements]
    public BsonDocument CatchAll { get; set; }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Or via code:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;BsonClassMap.RegisterClassMap&amp;lt;MyClass&amp;gt;(cm =&amp;gt; 
{
    cm.AutoMap();
    cm.MapExtraElementsMember(c =&amp;gt; c.CatchAll);
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;When a BSON document is deserialized, any extra elements found will be stored in the extra elements property. When the class is serialized, the extra elements will be serialized also. One thing to note though is that the serialized class will probably not have the elements in exactly the same order as the original document. All extra elements will be serialized together when the extra elements member is serialized.&lt;/p&gt;

&lt;h3 id=&#34;discriminators&#34;&gt;Discriminators&lt;/h3&gt;

&lt;p&gt;See the &lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/bson/mapping/polymorphism/&#34;&gt;polymorphism&lt;/a&gt; section for documentation on discriminators and polymorphism.&lt;/p&gt;

&lt;p&gt;To specify a discriminator, use a &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_Attributes_BsonDiscriminatorAttribute.htm
&#34;&gt;&lt;code&gt;BsonDiscriminatorAttribute&lt;/code&gt;&lt;/a&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;[BsonDiscriminator(&amp;quot;myclass&amp;quot;)]
public MyClass 
{
    // fields and properties
}
&lt;/code&gt;&lt;/pre&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;BsonClassMap.RegisterClassMap&amp;lt;MyClass&amp;gt;(cm =&amp;gt; 
{
    cm.AutoMap();
    cm.SetDiscriminator(&amp;quot;myclass&amp;quot;);
});
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;isupportinitialize&#34;&gt;ISupportInitialize&lt;/h3&gt;

&lt;p&gt;If your class implements &lt;a href=&#34;https://msdn.microsoft.com/en-us/library/system.componentmodel.isupportinitialize.aspx&#34;&gt;&lt;code&gt;ISupportInitialize&lt;/code&gt;&lt;/a&gt;, the driver will call the &lt;a href=&#34;https://msdn.microsoft.com/en-us/library/system.componentmodel.isupportinitialize.begininit.aspx&#34;&gt;&lt;code&gt;BeginInit&lt;/code&gt;&lt;/a&gt; method before deserialization and the &lt;a href=&#34;https://msdn.microsoft.com/en-us/library/system.componentmodel.isupportinitialize.endinit.aspx&#34;&gt;&lt;code&gt;EndInit&lt;/code&gt;&lt;/a&gt; method upon completion. It is useful for running operations before or after deserialization such as handling schema changes are pre-calculating some expensive operations.&lt;/p&gt;

&lt;h2 id=&#34;creation-customization&#34;&gt;Creation Customization&lt;/h2&gt;

&lt;p&gt;By default, classes must contain a no-argument constructor that will be used to instantiate the class to rehydrate. However, it is possible to configure a constructor whose arguments are correlated with mapped properties or fields. There are a couple of ways to do this.&lt;/p&gt;

&lt;p&gt;Using an expression, you can instruct the driver to use a creator map as follows:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;public class Person
{
    public string FirstName { get; private set; }
    public string LastName { get; private set; }

    public Person(string firstName, string lastName)
    {
        FirstName = firstName;
        LastName = lastName;
    }
}

// snip...

BsonClassMap.RegisterClassMap&amp;lt;Person&amp;gt;(cm =&amp;gt;
{
    cm.AutoMap();
    cm.MapCreator(p =&amp;gt; new Person(p.FirstName, p.LastName));
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Parsing the expression tree correlates the first constructor argument with the FirstName property and the second constructor argument with the LastName property. There are other, more complicated ways of handling this which can be explored on your own should the need arise.&lt;/p&gt;

&lt;p&gt;Using attributes instead:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;public class Person
{
    public string FirstName { get; set; }
    public string LastName { get; set; }

    [BsonConstructor]
    public Person(string firstName, string lastName)
    {
        FirstName = firstName;
        LastName = lastName;
    }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;By default, a convention runs on every CreatorMap with no mapped arguments and attempts to correlate the names of the constructor arguments with the names of mapped members. If your names differ in more than just case, there are overloads of BsonConstructor which can be used to explicity tell the driver which members to use.&lt;/p&gt;

&lt;p&gt;When more than one constructor is found, we will use the constructor that has the most matching parameters. For example:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;public class Person
{
    public string FirstName { get; set; }
    public string LastName { get; set; }
    public DateTime? BirthDate { get; set; }

    [BsonConstructor]
    public Person(string firstName, string lastName)
    {
        // snip...
    }

    [BsonConstructor]
    public Person(string firstName, string lastName, DateTime birthDate)
    {
        // snip...
    }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;If the document in the database has a BirthDate element, we will choose to use the constructor with three parameters because it is more specific.&lt;/p&gt;

&lt;h2 id=&#34;member-customization&#34;&gt;Member Customization&lt;/h2&gt;

&lt;p&gt;You can also control serialization at the individual class or field or property level using code to configure the class and member maps or using attributes to decorate the class and members. For each aspect of serialization you can control, we will be showing both ways.&lt;/p&gt;

&lt;h3 id=&#34;opt-in&#34;&gt;Opt-In&lt;/h3&gt;

&lt;p&gt;A majority of classes will have their members &lt;a href=&#34;#automap&#34;&gt;mapped automatically&lt;/a&gt;. There are some circumstances where this does not happen. For instance, if your property is read-only, it will not get included in the automapping of a class by default. In order to include the member, you can use the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_Attributes_BsonElementAttribute.htm
&#34;&gt;&lt;code&gt;BsonElementAttribute&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;class MyClass
{
    private readonly string _someProperty;

    [BsonElement]
    public string SomeProperty
    {
        get { return _someProperty; }
    }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Or via code:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;BsonClassMap.RegisterClassMap&amp;lt;MyClass&amp;gt;(cm =&amp;gt; 
{
    cm.AutoMap();
    cm.MapProperty(c =&amp;gt; c.SomeProperty);
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;div class=&#34;admonition note&#34;&gt;
&lt;h5 class=&#34;admonition-title&#34;&gt;Note&lt;/h5&gt;
When a readonly property is serialized, it value is persisted to the database, but never read back out. This is useful for storing “computed” properties.
&lt;/div&gt;
&lt;/p&gt;

&lt;h3 id=&#34;element-name&#34;&gt;Element Name&lt;/h3&gt;

&lt;p&gt;To specify an element name using attributes, write:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;public class MyClass 
{
    [BsonElement(&amp;quot;sp&amp;quot;)]
    public string SomeProperty { get; set; }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Or via code:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;BsonClassMap.RegisterClassMap&amp;lt;MyClass&amp;gt;(cm =&amp;gt; 
{
    cm.AutoMap();
    cm.MapMember(c =&amp;gt; c.SomeProperty).SetElementName(&amp;quot;sp&amp;quot;);
});
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;element-order&#34;&gt;Element Order&lt;/h3&gt;

&lt;p&gt;If you want precise control over the order of the elements in the BSON document, you can use the Order named parameter to the BsonElement attribute:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;public class MyClass 
{
    [BsonElement(&amp;quot;sp&amp;quot;, Order = 1)]
    public string SomeProperty { get; set; }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Or via code:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;BsonClassMap.RegisterClassMap&amp;lt;MyClass&amp;gt;(cm =&amp;gt; 
{
    cm.AutoMap();
    cm.MapMember(c =&amp;gt; c.SomeProperty).SetElementName(&amp;quot;sp&amp;quot;).SetOrder(1);
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Any fields or properties that do not have an explicit Order will occur after those that do have an Order.&lt;/p&gt;

&lt;h3 id=&#34;the-id-member&#34;&gt;The Id Member&lt;/h3&gt;

&lt;p&gt;By &lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/bson/mapping/conventions/&#34;&gt;convention&lt;/a&gt;, a public member called &lt;code&gt;Id&lt;/code&gt;, &lt;code&gt;id&lt;/code&gt;, or &lt;code&gt;_id&lt;/code&gt; will be used as the identifier. You can be specific about this using the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_Attributes_BsonIdAttribute.htm
&#34;&gt;&lt;code&gt;BsonIdAttribute&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;public class MyClass 
{
    [BsonId]
    public string SomeProperty { get; set; }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Or via code:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;BsonClassMap.RegisterClassMap&amp;lt;MyClass&amp;gt;(cm =&amp;gt; 
{
    cm.AutoMap();
    cm.MapIdMember(c =&amp;gt; c.SomeProperty);
});
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;id-generators&#34;&gt;Id Generators&lt;/h4&gt;

&lt;p&gt;When you Insert a document, the driver checks to see if the &lt;code&gt;Id&lt;/code&gt; member has been assigned a value and, if not, generates a new unique value for it. Since the &lt;code&gt;Id&lt;/code&gt; member can be of any type, the driver requires the help of an &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_IIdGenerator.htm
&#34;&gt;&lt;code&gt;IIdGenerator&lt;/code&gt;&lt;/a&gt; to check whether the &lt;code&gt;Id&lt;/code&gt; has a value assigned to it and to generate a new value if necessary. The driver has the following Id generators built-in:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_IdGenerators_ObjectIdGenerator.htm
&#34;&gt;&lt;code&gt;ObjectIdGenerator&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_IdGenerators_StringObjectIdGenerator.htm
&#34;&gt;&lt;code&gt;StringObjectIdGenerator&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_IdGenerators_GuidGenerator.htm
&#34;&gt;&lt;code&gt;GuidGenerator&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_IdGenerators_CombGuidGenerator.htm
&#34;&gt;&lt;code&gt;CombGuidGenerator&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_IdGenerators_NullIdChecker.htm
&#34;&gt;&lt;code&gt;NullIdChecker&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_IdGenerators_ZeroIdChecker_1.htm
&#34;&gt;&lt;code&gt;ZeroIdChecker&amp;lt;T&amp;gt;&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_IdGenerators_BsonObjectIdGenerator.htm
&#34;&gt;&lt;code&gt;BsonObjectIdGenerator&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Some of these Id generators are used automatically for commonly used &lt;code&gt;Id&lt;/code&gt; types:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_IdGenerators_GuidGenerator.htm
&#34;&gt;&lt;code&gt;GuidGenerator&lt;/code&gt;&lt;/a&gt; is used for a &lt;a href=&#34;https://msdn.microsoft.com/en-us/library/system.guid.aspx&#34;&gt;&lt;code&gt;Guid&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_IdGenerators_ObjectIdGenerator.htm
&#34;&gt;&lt;code&gt;ObjectIdGenerator&lt;/code&gt;&lt;/a&gt; is used for an &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_ObjectId.htm
&#34;&gt;&lt;code&gt;ObjectId&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_IdGenerators_StringObjectIdGenerator.htm
&#34;&gt;&lt;code&gt;StringObjectIdGenerator&lt;/code&gt;&lt;/a&gt; is used for a &lt;a href=&#34;https://msdn.microsoft.com/en-us/library/system.string.aspx&#34;&gt;&lt;code&gt;string&lt;/code&gt;&lt;/a&gt; represented externally as &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_ObjectId.htm
&#34;&gt;&lt;code&gt;ObjectId&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;To specify the Id generator via an attribute:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;public class MyClass 
{
    [BsonId(IdGenerator = typeof(CombGuidGenerator))]
    public Guid Id { get; set; }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Or via code:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;BsonClassMap.RegisterClassMap&amp;lt;MyClass&amp;gt;(cm =&amp;gt; 
{
    cm.AutoMap();
    cm.MapIdMember(c =&amp;gt; c.Id).SetIdGenerator(CombGuidGenerator.Instance);
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;You could also say that you want to use the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_IdGenerators_CombGuidGenerator.htm
&#34;&gt;&lt;code&gt;CombGuidGenerator&lt;/code&gt;&lt;/a&gt; for all Guids.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;BsonSerializer.RegisterIdGenerator(
    typeof(Guid),
    CombGuidGenerator.Instance
);
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;ignoring-a-member&#34;&gt;Ignoring a Member&lt;/h3&gt;

&lt;p&gt;When constructing a class map manually, you can ignore a field or property simply by not adding it to the class map. When using AutoMap, you need a way to specify that a field or property should be ignored. Use the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_Attributes_BsonIgnoreAttribute.htm
&#34;&gt;&lt;code&gt;BsonIgnoreAttribute&lt;/code&gt;&lt;/a&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;public class MyClass 
{
    [BsonIgnore]
    public string SomeProperty { get; set; }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Or via code:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;BsonClassMap.RegisterClassMap&amp;lt;MyClass&amp;gt;(cm =&amp;gt; 
{
    cm.AutoMap();
    cm.UnmapMember(c =&amp;gt; c.SomeProperty);
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;When using code, &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/M_MongoDB_Bson_Serialization_BsonClassMap_AutoMap.htm
&#34;&gt;&lt;code&gt;AutoMap&lt;/code&gt;&lt;/a&gt; will have initially added the property to the class map automatically. &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/M_MongoDB_Bson_Serialization_BsonClassMap_1_UnmapMember__1.htm
&#34;&gt;&lt;code&gt;UnmapMember&lt;/code&gt;&lt;/a&gt; will remove it.&lt;/p&gt;

&lt;h3 id=&#34;ignoring-default-values&#34;&gt;Ignoring Default Values&lt;/h3&gt;

&lt;p&gt;By default, default values are serialized to the BSON document. An alternative is to serialize nothing to the BSON document when the member has a default value. For reference types, this value is &lt;code&gt;null&lt;/code&gt; and for value types, the default is whatever the default is for the value type. Use a &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_Attributes_BsonIgnoreIfDefaultAttribute.htm
&#34;&gt;&lt;code&gt;BsonIgnoreIfDefaultAttribute&lt;/code&gt;&lt;/a&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;public class MyClass 
{
    [BsonIgnoreIfDefault]
    public string SomeProperty { get; set; }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Or via code:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;BsonClassMap.RegisterClassMap&amp;lt;MyClass&amp;gt;(cm =&amp;gt; 
{
    cm.AutoMap();
    cm.MapMember(c =&amp;gt; c.SomeProperty).SetIgnoreIfDefault(true);
});
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;specifying-the-default-value&#34;&gt;Specifying the Default Value&lt;/h3&gt;

&lt;p&gt;You can specify a default value for a member using a &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_Attributes_BsonDefaultValueAttribute.htm
&#34;&gt;&lt;code&gt;BsonDefaultValueAttribute&lt;/code&gt;&lt;/a&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;public class MyClass 
{
    [BsonDefaultValue(&amp;quot;abc&amp;quot;)]
    public string SomeProperty { get; set; }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Or via code:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;BsonClassMap.RegisterClassMap&amp;lt;MyClass&amp;gt;(cm =&amp;gt; 
{
    cm.AutoMap();
    cm.MapMember(c =&amp;gt; c.SomeProperty).SetDefaultValue(&amp;quot;abc&amp;quot;);
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The default value and the ignoring of a default value work together. The following will serialize a &lt;code&gt;null&lt;/code&gt; value, but not &lt;code&gt;abc&lt;/code&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;public class MyClass 
{
    [BsonIgnoreIfDefault]
    [BsonDefaultValue(&amp;quot;abc&amp;quot;)]
    public string SomeProperty { get; set; }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;ignoring-a-member-at-runtime&#34;&gt;Ignoring a Member at Runtime&lt;/h3&gt;

&lt;p&gt;Sometimes the decision whether to serialize a member or not is more complicated than just whether the value is &lt;code&gt;null&lt;/code&gt; or equal to the default value. In these cases, you can write a method that determines whether a value should be serialized. Usually the method for member Xyz is named ShouldSerializeXyz. If you follow this naming convention then &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/M_MongoDB_Bson_Serialization_BsonClassMap_AutoMap.htm
&#34;&gt;&lt;code&gt;AutoMap&lt;/code&gt;&lt;/a&gt; will automatically detect the method and use it. For example:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;public class Employee 
{
    public ObjectId Id { get; set; }

    [BsonDateTimeOptions(DateOnly = true)]
    public DateTime DateOfBirth { get; set; }

    public bool ShouldSerializeDateOfBirth() 
    {
        return DateOfBirth &amp;gt; new DateTime(1900, 1, 1);
    }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;When using code, it can be specified as a lambda expression:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;BsonClassMap.RegisterClassMap&amp;lt;Employee&amp;gt;(cm =&amp;gt; 
{
    cm.AutoMap();
    cm.MapMember(c =&amp;gt; c.DateOfBirth).SetShouldSerializeMethod(
        obj =&amp;gt; ((Employee) obj).DateOfBirth &amp;gt; new DateTime(1900, 1, 1)
    );
});
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;specifying-the-serializer&#34;&gt;Specifying the Serializer&lt;/h3&gt;

&lt;p&gt;There are times when a specific serializer needs to be used rather than letting the BSON library choose. This can be done using a &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_Attributes_BsonSerializerAttribute.htm
&#34;&gt;&lt;code&gt;BsonSerializerAttribute&lt;/code&gt;&lt;/a&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;public class MyClass 
{
    public ObjectId Id { get; set; }

    [BsonSerializer(typeof(MyCustomStringSerializer))]
    public string X { get; set; }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Or via code:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;BsonClassMap.RegisterClassMap&amp;lt;MyClass&amp;gt;(cm =&amp;gt; 
{
    cm.AutoMap();
    cm.MapMember(c =&amp;gt; c.X).SetSerializer(new MyCustomStringSerializer());
});
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&#34;serialization-options&#34;&gt;Serialization Options&lt;/h3&gt;

&lt;p&gt;Serialization of some classes can be more finely controlled using serialization options. Whether a class uses serialization options or not, and which ones, depends on the particular class involved. The following sections describe the available serialization option classes and the classes that use them.&lt;/p&gt;

&lt;h4 id=&#34;datetime-serialization-options&#34;&gt;DateTime Serialization Options&lt;/h4&gt;

&lt;p&gt;Using a &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_Attributes_BsonDateTimeOptionsAttribute.htm
&#34;&gt;&lt;code&gt;BsonDateTimeOptionsAttribute&lt;/code&gt;&lt;/a&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;public class MyClass 
{
    [BsonDateTimeOptions(DateOnly = true)]
    public DateTime DateOfBirth { get; set; }

    [BsonDateTimeOptions(Kind = DateTimeKind.Local)]
    public DateTime AppointmentTime { get; set; }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;When done via code, a &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_Serializers_DateTimeSerializer.htm
&#34;&gt;&lt;code&gt;DateTimeSerializer&lt;/code&gt;&lt;/a&gt; should be set:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;BsonClassMap.RegisterClassMap&amp;lt;MyClass&amp;gt;(cm =&amp;gt; 
{
    cm.AutoMap();
    cm.MapMember(c =&amp;gt; c.DateOfBirth).SetSerializer(new DateTimeSerializer(dateOnly: true));
    cm.MapMember(c =&amp;gt; c.AppointmentTime).SetSerializer(new DateTimeSerializer(DateTimeKind.Local));
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Here we are specifying that the &lt;code&gt;DateOfBirth&lt;/code&gt; value holds a date only (so the TimeOfDay component will be zero). Additionally, because this is a date only, no timezone conversions at all will be performed. The &lt;code&gt;AppointmentTime&lt;/code&gt; value is in local time and will be converted to UTC when it is serialized and converted back to local time when it is deserialized.&lt;/p&gt;

&lt;p&gt;&lt;div class=&#34;admonition note&#34;&gt;
&lt;h5 class=&#34;admonition-title&#34;&gt;Note&lt;/h5&gt;
DateTime values in MongoDB are always saved as UTC.
&lt;/div&gt;
&lt;/p&gt;

&lt;h4 id=&#34;dictionary-serialization-options&#34;&gt;Dictionary Serialization Options&lt;/h4&gt;

&lt;p&gt;When serializing dictionaries, there are several alternative ways that the contents of the dictionary can be represented. The &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_Options_DictionaryRepresentation.htm
&#34;&gt;&lt;code&gt;DictionaryRepresentation&lt;/code&gt;&lt;/a&gt; enum indicates the supported methods. Using a &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_Attributes_BsonDictionaryOptionsAttribute.htm
&#34;&gt;&lt;code&gt;BsonDictionaryOptionsAttribute&lt;/code&gt;&lt;/a&gt;:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;public class C 
{
    public ObjectId Id;
   
    [BsonDictionaryOptions(DictionaryRepresentation.ArrayOfDocuments)]
    public Dictionary&amp;lt;string, int&amp;gt; Values;
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;When done via code, a &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_Serializers_DictionaryInterfaceImplementerSerializer_1.htm
&#34;&gt;&lt;code&gt;DictionaryInterfaceImplementerSerializer&lt;/code&gt;&lt;/a&gt; should be set:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;BsonClassMap.RegisterClassMap&amp;lt;C&amp;gt;(cm =&amp;gt; 
{
    cm.AutoMap();
    cm.MapMember(c =&amp;gt; c.Values).SetSerializer(new DictionaryInterfaceImplementerSerializer&amp;lt;Dictionary&amp;lt;string, int&amp;gt;&amp;gt;(DictionaryRepresentation.ArrayOfDocuments));
});
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The 3 options in the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_Options_DictionaryRepresentation.htm
&#34;&gt;&lt;code&gt;DictionaryRepresentation&lt;/code&gt;&lt;/a&gt; enum are as follows:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;code&gt;Document&lt;/code&gt;: A dictionary represented as a Document will be stored as a BsonDocument, and each entry in the dictionary will be represented by a BsonElement with the name equal to the key of the dictionary entry and the value equal to the value of the dictionary entry. This representation can only be used when all the keys in a dictionary are strings that are valid element names.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;code&gt;ArrayOfArrays&lt;/code&gt;: A dictionary represented as an ArrayOfArrays will be stored as a BsonArray of key/value pairs, where each key/value pair is stored as a nested two-element BsonArray where the two elements are the key and the value of the dictionary entry. This representation can be used even when the keys of the dictionary are not strings. This representation is very general and compact, and is the default representation when Document does not apply. One problem with this representation is that it is difficult to write queries against it, which motivated the introduction in the 1.2 version of the driver of the ArrayOfDocuments representation.&lt;/p&gt;&lt;/li&gt;

&lt;li&gt;&lt;p&gt;&lt;code&gt;ArrayOfDocuments&lt;/code&gt;: A dictionary represented as an ArrayOfDocuments will be stored as a BsonArray of key/value pairs, where each key/value pair is stored as a nested two-element BsonDocument of the form { k : key, v : value }. This representation is just as general as the ArrayOfArrays representation, but because the keys and values are tagged with element names it is much easier to write queries against it. For backward compatibility reasons this is not the default representation.&lt;/p&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&#34;representation&#34;&gt;Representation&lt;/h3&gt;

&lt;p&gt;For some .NET primitive types you can control what BSON type you want used to represent the value. For example, you can specify whether a char value should be represented as a BSON Int32 or as a one-character BSON String:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;public class MyClass 
{
    [BsonRepresentation(BsonType.Int32)]
    public char RepresentAsInt32 { get; set; }

    [BsonRepresentation(BsonType.String)]
    public char RepresentAsString { get; set; }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Or via code:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;BsonClassMap.RegisterClassMap&amp;lt;MyClass&amp;gt;(cm =&amp;gt; 
{
    cm.AutoMap();
    cm.MapMember(c =&amp;gt; c.RepresentAsInt32).SetSerializer(new CharSerializer(BsonType.Int32));
    cm.MapMember(c =&amp;gt; c.RepresentAsString).SetSerializer(new CharSerializer(BsonType.String));
});
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;objectids&#34;&gt;ObjectIds&lt;/h4&gt;

&lt;p&gt;One case that deserves special mention is representing a string externally as an ObjectId. For example:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;public class Employee 
{
    [BsonRepresentation(BsonType.ObjectId)]
    public string Id { get; set; }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;In this case, the serializer will convert the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_ObjectId.htm
&#34;&gt;&lt;code&gt;ObjectId&lt;/code&gt;&lt;/a&gt; to a &lt;code&gt;string&lt;/code&gt; when reading data from the database and will convert the &lt;code&gt;string&lt;/code&gt; back to an &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_ObjectId.htm
&#34;&gt;&lt;code&gt;ObjectId&lt;/code&gt;&lt;/a&gt; when writing data to the database (the &lt;code&gt;string&lt;/code&gt; value must be a valid &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_ObjectId.htm
&#34;&gt;&lt;code&gt;ObjectId&lt;/code&gt;&lt;/a&gt;). Typically this is done when you want to keep your domain classes free of any dependencies on the driver. To keep your domain classes free of dependencies on the C# driver you also won’t want to use attributes, so you can accomplish the same thing using initialization code instead of attributes:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;BsonClassMap.RegisterClassMap&amp;lt;Employee&amp;gt;(cm =&amp;gt; 
{
    cm.AutoMap();
    cm.IdMemberMap.SetRepresentation(BsonType.ObjectId);
});
&lt;/code&gt;&lt;/pre&gt;

&lt;h4 id=&#34;enums&#34;&gt;Enums&lt;/h4&gt;

&lt;p&gt;Another case that deserves mention is enums. Enums are, by default, represented as their underlying value. In other words, a plain enum will be represented as an integer value. However, it is possible to instruct the driver to represent an enum as a string.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;public enum Color
{
    Blue,
    Other
}

public class Person 
{
    [BsonRepresentation(BsonType.String)]
    public Color FavoriteColor { get; set; }
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Or via code:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;BsonClassMap.RegisterClassMap&amp;lt;Person&amp;gt;(cm =&amp;gt; 
{
    cm.AutoMap();
    cm.MapMember(c =&amp;gt; c.FavoriteColor).SetSerializer(new EnumSerializer&amp;lt;Color&amp;gt;(BsonType.String));
});
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;custom-attributes&#34;&gt;Custom Attributes&lt;/h2&gt;

&lt;p&gt;It is possible to implement custom attributes to contribute to the serialization infrastructure. There are 3 interfaces you might want to implement:&lt;/p&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_IBsonClassMapAttribute.htm
&#34;&gt;&lt;code&gt;IBsonClassMapAttribute&lt;/code&gt;&lt;/a&gt; is used to contribute to a class map.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_IBsonMemberMapAttribute.htm
&#34;&gt;&lt;code&gt;IBsonMemberMapAttribute&lt;/code&gt;&lt;/a&gt; is used to contribute to a member map.&lt;/li&gt;
&lt;li&gt;&lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_IBsonCreatorMapAttribute.htm
&#34;&gt;&lt;code&gt;IBsonCreatorMapAttribute&lt;/code&gt;&lt;/a&gt; is used to contribute to a creator map.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;All the provided attributes implement one or more of these interfaces, so they are good examples of how these interfaces function.&lt;/p&gt;
</description>
    </item>
    
    <item>
      <title>Polymorphism</title>
      <link>/mongo-csharp-driver/2.0/reference/bson/mapping/polymorphism/</link>
      <pubDate>Tue, 17 Mar 2015 15:36:56 +0000</pubDate>
      
      <guid>/mongo-csharp-driver/2.0/reference/bson/mapping/polymorphism/</guid>
      <description>

&lt;h2 id=&#34;polymorphism&#34;&gt;Polymorphism&lt;/h2&gt;

&lt;p&gt;When you have a class hierarchy and will be serializing instances of varying classes to the same collection you need a way to distinguish one from another. The normal way to do so is to write some kind of special value (called a “discriminator”) in the document along with the rest of the elements that you can later look at to tell them apart. Since there are potentially many ways you could discriminate between actual types, the default serializer uses conventions for discriminators. The default serializer provides two standard discriminators: &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_Conventions_ScalarDiscriminatorConvention.htm
&#34;&gt;&lt;code&gt;ScalarDiscriminatorConvention&lt;/code&gt;&lt;/a&gt; and &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_Conventions_HierarchicalDiscriminatorConvention.htm
&#34;&gt;&lt;code&gt;HierarchicalDiscriminatorConvention&lt;/code&gt;&lt;/a&gt;. The default is the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_Conventions_HierarchicalDiscriminatorConvention.htm
&#34;&gt;&lt;code&gt;HierarchicalDiscriminatorConvention&lt;/code&gt;&lt;/a&gt;, but it behaves just like the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_Conventions_ScalarDiscriminatorConvention.htm
&#34;&gt;&lt;code&gt;ScalarDiscriminatorConvention&lt;/code&gt;&lt;/a&gt; until certain options are set to trigger its hierarchical behavior.&lt;/p&gt;

&lt;p&gt;The default discriminator conventions both use an element named _t to store the discriminator value in the BSON document. This element will normally be the second element in the BSON document (right after the _id). In the case of the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_Conventions_ScalarDiscriminatorConvention.htm
&#34;&gt;&lt;code&gt;ScalarDiscriminatorConvention&lt;/code&gt;&lt;/a&gt;, the value of _t will be a single string. In the case of the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_Conventions_HierarchicalDiscriminatorConvention.htm
&#34;&gt;&lt;code&gt;HierarchicalDiscriminatorConvention&lt;/code&gt;&lt;/a&gt; the value of _t will be an array of discriminator values, one for each level of the class inheritance tree.&lt;/p&gt;

&lt;p&gt;While you will normally be just fine with the default discriminator convention, you might have to write a custom discriminator convention if you must work with data written by another driver or object mapper that uses a different convention for its discriminators.&lt;/p&gt;

&lt;h2 id=&#34;setting-the-discriminator-value&#34;&gt;Setting the Discriminator Value&lt;/h2&gt;

&lt;p&gt;The default value for the discriminator is the name of the class (without the namespace part). You can specify a different value using attributes:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;[BsonDiscriminator(&amp;quot;myclass&amp;quot;)]
public MyClass {
    // fields and properties
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Or via code:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;BsonClassMap.RegisterClassMap&amp;lt;MyClass&amp;gt;(cm =&amp;gt; {
    cm.AutoMap();
    cm.SetDiscriminator(&amp;quot;myclass&amp;quot;);
});
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;specifying-known-types&#34;&gt;Specifying Known Types&lt;/h2&gt;

&lt;p&gt;When deserializing polymorphic classes, it is important that the serializer know about all the classes in the hierarchy before deserialization begins. If you ever see an error message about an “Unknown discriminator”, it is because the deserializer can’t figure out the class for that discriminator. If you are mapping your classes programmatically simply make sure that all classes in the hierarchy have been mapped before beginning deserialization. When using attributes and &lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/bson/mapping/#automap&#34;&gt;automapping&lt;/a&gt;, you will need to inform the serializer about known types (i.e. subclasses) it should create class maps for. Here is an example of how to do this:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;[BsonKnownTypes(typeof(Cat), typeof(Dog)]
public class Animal 
{
}

[BsonKnownTypes(typeof(Lion), typeof(Tiger)]
public class Cat : Animal 
{
}

public class Dog : Animal 
{
}

public class Lion : Cat 
{
}

public class Tiger : Cat 
{
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_Attributes_BsonKnownTypesAttribute.htm
&#34;&gt;&lt;code&gt;BsonKnownTypesAttribute&lt;/code&gt;&lt;/a&gt; attribute lets the serializer know what subclasses it might encounter during deserialization, so when &lt;code&gt;Animal&lt;/code&gt; is &lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/bson/mapping/#automap&#34;&gt;automapped&lt;/a&gt;, the serializer will also &lt;a href=&#34;/mongo-csharp-driver/2.0/mongo-csharp-driver/2.0/reference/bson/mapping/#automap&#34;&gt;automap&lt;/a&gt; &lt;code&gt;Cat&lt;/code&gt; and &lt;code&gt;Dog&lt;/code&gt;, and recursively, &lt;code&gt;Lion&lt;/code&gt; and &lt;code&gt;Tiger&lt;/code&gt; as well.&lt;/p&gt;

&lt;p&gt;Or via code:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;BsonClassMap.RegisterClassMap&amp;lt;Animal&amp;gt;();
BsonClassMap.RegisterClassMap&amp;lt;Cat&amp;gt;();
BsonClassMap.RegisterClassMap&amp;lt;Dog&amp;gt;();
BsonClassMap.RegisterClassMap&amp;lt;Lion&amp;gt;();
BsonClassMap.RegisterClassMap&amp;lt;Tiger&amp;gt;();
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;scalar-and-hierarchical-discriminators&#34;&gt;Scalar and Hierarchical Discriminators&lt;/h2&gt;

&lt;p&gt;Normally a discriminator is simply the name of the class (although it could be different if you are using a custom discriminator convention or have explicitly specified a discriminator for a class). So a collection containing a mix of different type of Animal documents might look like:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ _id: ..., _t: &amp;quot;Animal&amp;quot;, ... }
{ _id: ..., _t: &amp;quot;Cat&amp;quot;, ... }
{ _id: ..., _t: &amp;quot;Dog&amp;quot;, ... }
{ _id: ..., _t: &amp;quot;Lion&amp;quot;, ... }
{ _id: ..., _t: &amp;quot;Tiger&amp;quot;, ... }
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Sometimes it can be helpful to record a hierarchy of discriminator values, one for each level of the hierarchy. To do this, you must first mark a base class as being the root of a hierarchy, and then the default &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_Conventions_HierarchicalDiscriminatorConvention.htm
&#34;&gt;&lt;code&gt;HierarchicalDiscriminatorConvention&lt;/code&gt;&lt;/a&gt; will automatically record discriminators as array values instead.&lt;/p&gt;

&lt;p&gt;To identify &lt;code&gt;Animal&lt;/code&gt; as the root of a hierarchy use the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/T_MongoDB_Bson_Serialization_Attributes_BsonDiscriminatorAttribute.htm
&#34;&gt;&lt;code&gt;BsonDiscriminatorAttribute&lt;/code&gt;&lt;/a&gt; attribute with the &lt;a href=&#34;http://api.mongodb.org/csharp/2.0/html/P_MongoDB_Bson_Serialization_Attributes_BsonDiscriminatorAttribute_RootClass.htm
&#34;&gt;&lt;code&gt;RootClass&lt;/code&gt;&lt;/a&gt; named parameter:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;[BsonDiscriminator(RootClass = true)]
[BsonKnownTypes(typeof(Cat), typeof(Dog)]
public class Animal 
{
}

// the rest of the hierarchy as before
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Or via code:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;BsonClassMap.RegisterClassMap&amp;lt;Animal&amp;gt;(cm =&amp;gt; {
    cm.AutoMap();
    cm.SetIsRootClass(true);
});
BsonClassMap.RegisterClassMap&amp;lt;Cat&amp;gt;();
BsonClassMap.RegisterClassMap&amp;lt;Dog&amp;gt;();
BsonClassMap.RegisterClassMap&amp;lt;Lion&amp;gt;();
BsonClassMap.RegisterClassMap&amp;lt;Tiger&amp;gt;();
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;Now that you have identified Animal as a root class, the discriminator values will look a little bit different:&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-json&#34;&gt;{ _id: ..., _t: &amp;quot;Animal&amp;quot;, ... }
{ _id: ..., _t: [&amp;quot;Animal&amp;quot;, &amp;quot;Cat&amp;quot;], ... }
{ _id: ..., _t: [&amp;quot;Animal&amp;quot;, &amp;quot;Dog&amp;quot;], ... }
{ _id: ..., _t: [&amp;quot;Animal&amp;quot;, &amp;quot;Cat&amp;quot;, &amp;quot;Lion&amp;quot;], ... }
{ _id: ..., _t: [&amp;quot;Animal&amp;quot;, &amp;quot;Cat&amp;quot;, &amp;quot;Tiger&amp;quot;], ... }
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;The main reason you might choose to use hierarchical discriminators is because it makes it possibly to query for all instances of any class in the hierarchy. For example, to read all the &lt;code&gt;Cat&lt;/code&gt; documents we can use the following filter.&lt;/p&gt;

&lt;pre&gt;&lt;code class=&#34;language-csharp&#34;&gt;var filter = new BsonDocument(&amp;quot;_t&amp;quot;, &amp;quot;Cat&amp;quot;);
&lt;/code&gt;&lt;/pre&gt;
</description>
    </item>
    
  </channel>
</rss>