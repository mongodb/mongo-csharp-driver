<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<meta name="author" content="">
<meta name="keyword" content="">

    <link rel="shortcut icon" href="/mongo-csharp-driver/2.0/img/favicon.png">

    <title>Upgrading</title>

    <link rel="stylesheet" href="/mongo-csharp-driver/2.0/lib/bootstrap.css" type="text/css" />
<link rel="stylesheet" href="/mongo-csharp-driver/2.0/lib/font-awesome/css/font-awesome.min.css" type="text/css" />
<link rel="stylesheet" href="/mongo-csharp-driver/2.0/css/mongodb-docs.css" type="text/css" />
<link rel="stylesheet" href="/mongo-csharp-driver/2.0/css/overrides.css" type="text/css" />
<link rel="stylesheet" href="/mongo-csharp-driver/2.0/lib/highlight/styles/idea.css" />
<link rel="stylesheet" href="/mongo-csharp-driver/2.0/lib/bootstrap-toggle/bootstrap-toggle.min.css" type="text/css" />
<link rel="stylesheet" href="/mongo-csharp-driver/2.0/css/dn.css" type="text/css" />


  </head>

  <body>
  
  <section id="container" class="">
      
      <header id="header-db" class="row" role="navigation">
  <div class="header-content">
    <div class="toggle-nav pull-left">
        <i class="fa fa-bars"></i>
        <div class="icon-reorder tooltips" data-original-title="Toggle Navigation" data-placement="bottom"></div>
    </div>
    
    <div class="logo pull-left">
      <a href="/mongo-csharp-driver/2.0/../">
        <img src="/mongo-csharp-driver/2.0/img/logo-mongodb-header.png", alt="MongoDB.org" />
      </a>
    </div>
    
    <div>
<div class="nav-items pull-right">
  <a href="http://try.mongodb.org/" data-toggle="tooltip" data-placement="bottom" title="Try MongoDB in the browser">Try it Out</a>
  <a href="http://www.mongodb.org/downloads" data-toggle="tooltip" data-placement="bottom" title="Download MongoDB">Downloads</a>
  <a href="http://www.mongodb.org/get-involved" data-toggle="tooltip" data-placement="bottom" title="Get involved with MongoDB">Community</a>
  <a href="http://docs.mongodb.org" data-toggle="tooltip" data-placement="bottom" title="The MongoDB Documentation">Docs</a>
  <a href="http://blog.mongodb.org" data-toggle="tooltip" data-placement="bottom" title="The MongoDB Blog">Blog</a>
  <div id="search">
<form method="get" action="//www.google.com/search" target="_blank">
    <input type="text" name="searchQuery" size="20" value="" autocomplete="off" placeholder="Search docs">
    <input type="hidden" name="site" value="/mongo-csharp-driver/2.0">
    <input type="hidden" name="q" value="">
    <label for="searchQuery"><i class="fa fa-search fa-1"></i></label>
</form>
</div>

</div>
</div>

  </div>
</header>

      

      
<aside id="sidebar" class="sidebar">
    <div class="ssidebar nav-collapse">
      <div class="ssidebarwrapper">
        <h3>
          <a class="index-link" href="/mongo-csharp-driver/2.0/../">MongoDB .NET Driver</a>
          <a class="version pull-right" href="/mongo-csharp-driver/2.0">2.0</a>
        </h3>

        
        <ul class="sidebar-menu">
          
          
          
          
          
          
          
          
          
          
          
          

          
          
            
            









  
    
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
    
      
    
  


          
            
            









  
    
    
      
      
        
        
        
        
        
        
        
        









  
  
  
  
  
  
  
  

  
    
    
    
      
    
  
  


        
      
    
    
  


          
            
            









  
    
    
      
      
    
      
      
    
      
      
    
    
  


          
            
            









  


          
            
            









  


          
            
            









  


          

          

          
            
            
















<li class="toctree-l1 ">
  <a href="/mongo-csharp-driver/2.0/getting_started/" class="">
      <i class='fa fa-road'></i>
      <span>Getting Started</span>
      <span class="menu-arrow fa fa-angle-right"></span>
  </a>
    <ul >
        
        
        
        
















    <li class="toctree-l2">
    <a href="/mongo-csharp-driver/2.0/getting_started/installation/">
        <i class='fa'></i>
        Installation
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l2">
    <a href="/mongo-csharp-driver/2.0/getting_started/quick_tour/">
        <i class='fa'></i>
        Quick Tour
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l2">
    <a href="/mongo-csharp-driver/2.0/getting_started/admin_quick_tour/">
        <i class='fa'></i>
        Admin Quick Tour
    </a>
  </li>


        
        
    </ul>
  </li>


          
            
            













  




<li class="toctree-l1  current">
  <a href="/mongo-csharp-driver/2.0/what_is_new/" class="">
      <i class='fa fa-star'></i>
      <span>What&#39;s New</span>
      <span class="menu-arrow fa fa-angle-down"></span>
  </a>
    <ul  class="current">
        
        
        
        













  




    <li class="toctree-l2">
    <a href="/mongo-csharp-driver/2.0/upgrading/">
        <i class='fa'></i>
        Upgrading
    </a>
  </li>


        
        
    </ul>
  </li>


          
            
            
















<li class="toctree-l1 ">
  <a href="/mongo-csharp-driver/2.0/reference/" class="">
      <i class='fa fa-book'></i>
      <span>Reference</span>
      <span class="menu-arrow fa fa-angle-right"></span>
  </a>
    <ul >
        
        
        
        
















<li class="toctree-l2 ">
  <a href="/mongo-csharp-driver/2.0/reference/bson/" class="">
      <i class='fa'></i>
      <span>BSON</span>
      
  </a>
    <ul >
        
        
        
        
















    <li class="toctree-l3">
    <a href="/mongo-csharp-driver/2.0/reference/bson/bson/">
        <i class='fa'></i>
        BSON/JSON
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l3">
    <a href="/mongo-csharp-driver/2.0/reference/bson/bson_document/">
        <i class='fa'></i>
        BsonDocument
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l3">
    <a href="/mongo-csharp-driver/2.0/reference/bson/serialization/">
        <i class='fa'></i>
        Serialization
    </a>
  </li>


        
        
        
        
        
















<li class="toctree-l3 ">
  <a href="/mongo-csharp-driver/2.0/reference/bson/mapping/" class="">
      <i class='fa'></i>
      <span>Mapping Classes</span>
      
  </a>
    <ul >
        
        
        
        
















    <li class="toctree-l4">
    <a href="/mongo-csharp-driver/2.0/reference/bson/mapping/polymorphism/">
        <i class='fa'></i>
        Polymorphism
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l4">
    <a href="/mongo-csharp-driver/2.0/reference/bson/mapping/conventions/">
        <i class='fa'></i>
        Conventions
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l4">
    <a href="/mongo-csharp-driver/2.0/reference/bson/mapping/schema_changes/">
        <i class='fa'></i>
        Handling Schema Changes
    </a>
  </li>


        
        
    </ul>
  </li>


        
        
    </ul>
  </li>


        
        
        
        
        
















<li class="toctree-l2 ">
  <a href="/mongo-csharp-driver/2.0/reference/driver/" class="">
      <i class='fa'></i>
      <span>Driver</span>
      
  </a>
    <ul >
        
        
        
        
















<li class="toctree-l3 ">
  <a href="/mongo-csharp-driver/2.0/reference/driver/connecting/" class="">
      <i class='fa'></i>
      <span>Connecting</span>
      
  </a>
    <ul >
        
        
        
        
















    <li class="toctree-l4">
    <a href="/mongo-csharp-driver/2.0/reference/driver/ssl/">
        <i class='fa'></i>
        SSL
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l4">
    <a href="/mongo-csharp-driver/2.0/reference/driver/authentication/">
        <i class='fa'></i>
        Authentication
    </a>
  </li>


        
        
    </ul>
  </li>


        
        
        
        
        
















<li class="toctree-l3 ">
  <a href="/mongo-csharp-driver/2.0/reference/driver/definitions/" class="">
      <i class='fa'></i>
      <span>Definitions and Builders</span>
      
  </a>
    <ul >
        
        
        
        
















    <li class="toctree-l4">
    <a href="/mongo-csharp-driver/2.0/reference/driver/expressions/">
        <i class='fa'></i>
        Expressions
    </a>
  </li>


        
        
    </ul>
  </li>


        
        
        
        
        
















    <li class="toctree-l3">
    <a href="/mongo-csharp-driver/2.0/reference/driver/admin/">
        <i class='fa'></i>
        Administration
    </a>
  </li>


        
        
        
        
        
















<li class="toctree-l3 ">
  <a href="/mongo-csharp-driver/2.0/reference/driver/crud/" class="">
      <i class='fa'></i>
      <span>Reading and Writing</span>
      
  </a>
    <ul >
        
        
        
        
















    <li class="toctree-l4">
    <a href="/mongo-csharp-driver/2.0/reference/driver/crud/reading/">
        <i class='fa'></i>
        Reading
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l4">
    <a href="/mongo-csharp-driver/2.0/reference/driver/crud/writing/">
        <i class='fa'></i>
        Writing
    </a>
  </li>


        
        
    </ul>
  </li>


        
        
        
        
        
















    <li class="toctree-l3">
    <a href="/mongo-csharp-driver/2.0/reference/driver/error_handling/">
        <i class='fa'></i>
        Error Handling
    </a>
  </li>


        
        
    </ul>
  </li>


        
        
        
        
        
















    <li class="toctree-l2">
    <a href="/mongo-csharp-driver/2.0/reference/driver_core/">
        <i class='fa'></i>
        Driver Core
    </a>
  </li>


        
        
    </ul>
  </li>


          
            
            
















    <li class="toctree-l1">
    <a href="http://api.mongodb.org/csharp/2.0">
        <i class='fa fa-file-text-o'></i>
        API Documentation
    </a>
  </li>


          
            
            
















    <li class="toctree-l1">
    <a href="https://github.com/mongodb/mongo-csharp-driver/tree/master">
        <i class='fa fa-github'></i>
        Source Code
    </a>
  </li>


          
            
            
















    <li class="toctree-l1">
    <a href="/mongo-csharp-driver/2.0/issues_help/">
        <i class='fa fa-life-ring'></i>
        Issues &amp; Help
    </a>
  </li>


          
        </ul>
        
    </div>
  </div>
  
</aside>

<div class="option-popup closed hidden" id="optionsVersionsPopup">
<div class="option-header">
  <i class="fa fa-gear"></i>
  <span>OPTIONS</span>
  <i class="fa fa-angle-up pull-right"></i>
</div>
<div class="option-body">
  <ul>
      
      <li>
        <label>Version</label>
        <div class="btn-group btn-group-xs pull-right">
          <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
            Select Version <span class="caret"></span>
          </button>
          <ul class="dropdown-menu" role="menu" id="optionsVersionsMenu">
          </ul>
        </div>
      </li>

   


    

  </ul>
</div>
</div>



      
      <section id="main-content" class="content">
          <section class="main-column pull-left">
            <div class="document">
              <div class="documentwrapper">
                <div class="bodywrapper">
                  <div class="body">


   
<a class="edit-link" href="https://github.com/mongodb/mongo-csharp-driver/blob/master/docs/reference/content/upgrading.md" target="_blank" title="Edit upgrading.md on GitHub"><i class="fa fa-pencil-square-o"></i></a>










<div class="bc">
<ul>
  
  
  
  
  
  <li><a href="/mongo-csharp-driver/2.0/what_is_new/">What&#39;s New</a> <i class="fa fa-angle-right"></i></li>
  <li>Upgrading</li>
</ul>
</div>




<h2 id="breaking-changes">Breaking Changes</h2>

<p>As 2.0 is a major revision, there are some breaking changes when coming from the 1.x assemblies. We&rsquo;ve tried our best to mitigate those breaking changes, but some were inevitable. These changes may not affect everyone, but take a moment to review the list of known changes below:</p>

<h3 id="system-requirements">System Requirements</h3>

<ul>
<li>.NET 3.5 and .NET 4.0 are no longer supported. If you still must use these platforms, the 1.x series of the driver will continue to be developed.</li>
<li><a href="https://jira.mongodb.org/browse/CSHARP-952">CSHARP-952</a>: We&rsquo;ve removed support for partially trusted callers.</li>
</ul>

<h3 id="packaging">Packaging</h3>

<ul>
<li>The nuget package <a href="http://nuget.org/packages/mongocsharpdriver">mongocsharpdriver</a> now includes the legacy driver. It depends on 3 new nuget packages, <a href="http://nuget.org/packages/MongoDB.Bson">MongoDB.Bson</a>, <a href="http://nuget.org/packages/MongoDB.Driver.Core">MongoDB.Driver.Core</a>, and <a href="http://nuget.org/packages/MongoDB.Driver">MongoDB.Driver</a>. <a href="http://nuget.org/packages/MongoDB.Driver">MongoDB.Driver</a> is the replacement for <a href="http://nuget.org/packages/mongocsharpdriver">mongocsharpdriver</a>.</li>
<li><a href="https://jira.mongodb.org/browse/CSHARP-616">CSHARP-616</a>: We are no longer strong naming  our assemblies. Our previous strong naming was signed with a key in our public repository. This did nothing other than satisfy certain tools. If you need MongoDB assemblies to be strongly named, it is relatively straight-forward to build the assemblies yourself.</li>
</ul>

<h3 id="bson">BSON</h3>

<ul>
<li><a href="https://jira.mongodb.org/browse/CSHARP-933">CSHARP-933</a>: Improved the BSON Serializer infrastructure. Anyone who has written a custom serializer will be affected by this. The changes are minor, but were necessary to support dynamic serializers as well as offering great speed improvements and improved memory management.</li>
<li>Certain methods, such as <code>BsonMemberMap.SetRepresentation</code> have been removed. The proper way to set a representation, for instance, would be to use <code>SetSerializer</code> and configure the serializer with the appropriate representation.</li>
<li><a href="https://jira.mongodb.org/browse/CSHARP-939">CSHARP-939</a>: Dynamic DictionaryRepresentation has been removed. Its intent was to store, in some manner, anything in a .NET dictionary. In practice, this leads to the same values getting stored in different ways depending on factors such as a &ldquo;.&rdquo; inside the key name. We made the decision to eliminate this variability. This means that documents that used to serialize correctly may start throwing a BsonSerializationException with a message indicating the key must be a valid string. <a href="https://jira.mongodb.org/browse/CSHARP-1165">CSHARP-1165</a> has a solution to this problem. It should be noted that we will continue to read these disparate representations without error.</li>
</ul>

<h3 id="driver">Driver</h3>

<ul>
<li><a href="https://jira.mongodb.org/browse/CSHARP-979">CSHARP-979</a>: <code>MongoConnectionStringBuilder</code> has been removed. Use the documented mongodb connection string format and/or <code>MongoUrlBuilder</code>.</li>
<li><code>MongoServer</code> is a deprecated class. Anyone using <code>MongoClient.GetServer()</code> will encounter a deprecation warning and, depending on how your build is setup, may receive an error. It is still safe to use this API until your code is ported to the new API. *Note that this API requires the use of the <a href="http://nuget.org/packages/mongocsharpdriver">mongocsharpdriver</a> to include the legacy API.</li>

<li><p><a href="https://jira.mongodb.org/browse/CSHARP-1043">CSHARP-1043</a> and <a href="https://jira.mongodb.org/browse/CSHARP-1044">CSHARP-1044</a>: <code>ReadPreference</code> and <code>WriteConcern</code> were rewritten. These classes are now immutable. Any current application code that sets values on these classes will no longer function. Instead, you should use the With method to alter a <code>ReadPreference</code> or <code>WriteConcern</code>.</p>

<pre><code class="language-csharp">var writeConcern = myCurrentWriteConcern.With(journal: true);
</code></pre></li>
</ul>

<h2 id="migrating">Migrating</h2>

<p>Below are some common actions in the old API and their counterpart in the new API.</p>

<h3 id="builders">Builders</h3>

<p><em><a href="/mongo-csharp-driver/2.0/reference/driver/definitions/">More information.</a></em></p>

<p>The old builders (<code>Query</code>, <code>Update</code>, etc&hellip;) have all been replaced by <code>Builders&lt;T&gt;.Filter</code>, <code>Builders&lt;T&gt;.Update</code>, etc&hellip;</p>

<pre><code class="language-csharp">// old API
var query = Query.And(
    Query&lt;Person&gt;.EQ(x =&gt; x.FirstName, &quot;Jack&quot;), 
    Query&lt;Person&gt;.LT(x =&gt; x.Age, 21));

// new API
var builder = Builders&lt;Person&gt;.Filter;
var filter = builder.Eq(x =&gt; x.FirstName, &quot;Jack&quot;) &amp; builder.Lt(x =&gt; x.Age, 21);
</code></pre>

<pre><code class="language-csharp">// old API
var update = Update.Combine(
    Update&lt;Person&gt;.Set(x =&gt; x.LastName, &quot;McJack&quot;),
    Update&lt;Person&gt;.Inc(x =&gt; x.Age, 1));

// new API
var update = Builders&lt;Person&gt;.Update
    .Set(x =&gt; x.LastName, &quot;McJack&quot;)
    .Inc(x =&gt; x.Age, 1);
</code></pre>

<h3 id="finding-all-documents">Finding All Documents</h3>

<p><em><a href="/mongo-csharp-driver/2.0/reference/driver/crud/reading/#finding-documents">More information.</a></em></p>

<p>To match all documents, you must specify an empty filter.</p>

<pre><code class="language-csharp">// old API
var list = collection.FindAll().ToList();

// new API
var list = await collection.Find(new BsonDocument()).ToListAsync();
</code></pre>

<h3 id="finding-one-document">Finding One Document</h3>

<p><em><a href="/mongo-csharp-driver/2.0/reference/driver/crud/reading/#single-results">More information.</a></em></p>

<p>To match all documents, you must specify an empty filter.</p>

<pre><code class="language-csharp">// old API
var document = collection.FindOne();

// new API
var document = await collection.Find(new BsonDocument()).FirstOrDefaultAsync();
</code></pre>

<h3 id="iteration">Iteration</h3>

<p><em><a href="/mongo-csharp-driver/2.0/reference/driver/crud/reading/#iteration">More information.</a></em></p>

<p>You cannot iterate synchronously using a foreach loop without first getting a list. However, there are alternative methods provided to loop over all the documents in an asynchronous manner.</p>

<pre><code class="language-csharp">// old API
foreach (var document in collection.Find(new QueryDocument(&quot;Name&quot;, &quot;Jack&quot;)))
{
    // do something
}

// new API
await collection.Find(new BsonDocument(&quot;Name&quot;, &quot;Jack&quot;))
    .ForEachAsync(document =&gt;
    {
        // do something
    });

await collection.Find(new BsonDocument(&quot;Name&quot;, &quot;Jack&quot;))
    .ForEachAsync(async document =&gt;
    {
        // do something with await
    });
</code></pre>

<h3 id="counting-all-documents">Counting All Documents</h3>

<p><em><a href="/mongo-csharp-driver/2.0/reference/driver/crud/reading/#counting-documents">More information.</a></em></p>

<p>To match all documents, you must specify an empty filter.</p>

<pre><code class="language-csharp">// old API
var count = collection.Count();

// new API
var count = await collection.CountAsync(new BsonDocument());
</code></pre>

<h3 id="mapping-setrepresentation">Mapping - SetRepresentation</h3>

<p><em><a href="/mongo-csharp-driver/2.0/reference/bson/mapping/#representation">More information.</a></em></p>

<p>You can still use attributes as you have done before. To set the representation via code:</p>

<pre><code class="language-csharp">class Test
{
    public char RepresentAsInt32 { get; set; }
}

// old API
BsonClassMap.RegisterClassMap&lt;Person&gt;(cm =&gt;
{
    // snip...
    cm.MapMember(x =&gt; x.RepresentAsInt32).SetRepresentation(BsonType.Int32);
});

// new API
BsonClassMap.RegisterClassMap&lt;Person&gt;(cm =&gt;
{
    // snip...
    cm.MapMember(x =&gt; x.RepresentAsInt32).SetSerializer(new CharSerializer(BsonType.Int32));
});
</code></pre>






<div id="btnv">
  
  
</div>
</div>


</div>
<div class="right-column">
<div class="wrapper">
  
  <div class="toc">
    <span class="toc-header">On this page</span>
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#breaking-changes">Breaking Changes</a>
<ul>
<li><a href="#system-requirements">System Requirements</a></li>
<li><a href="#packaging">Packaging</a></li>
<li><a href="#bson">BSON</a></li>
<li><a href="#driver">Driver</a></li>
</ul></li>
<li><a href="#migrating">Migrating</a>
<ul>
<li><a href="#builders">Builders</a></li>
<li><a href="#finding-all-documents">Finding All Documents</a></li>
<li><a href="#finding-one-document">Finding One Document</a></li>
<li><a href="#iteration">Iteration</a></li>
<li><a href="#counting-all-documents">Counting All Documents</a></li>
<li><a href="#mapping-setrepresentation">Mapping - SetRepresentation</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
  </div>
  
</div>
</div>

</div>
</div>
</div>
</section>
</section>

</section>


<script type="text/javascript">
  var DOCUMENTATION_OPTIONS = {
   URL_ROOT:    "/mongo-csharp-driver/2.0",
   VERSION:     "2.0",
   COLLAPSE_INDEX: false,
   FILE_SUFFIX: '.html',
   HAS_SOURCE:  true
  };
</script>
<script type="text/javascript" src="/mongo-csharp-driver/2.0/js/jquery.js"></script>
<script type="text/javascript" src="/mongo-csharp-driver/2.0/lib/bootstrap.js"></script>
<script type="text/javascript" src="/mongo-csharp-driver/2.0/js/navbar.js"></script>
<script type="text/javascript" src="/mongo-csharp-driver/2.0/lib/highlight/highlight.pack.js"></script>
<script type="text/javascript" src="/mongo-csharp-driver/2.0/js/scripts.js"></script>
<script type="text/javascript" src="/mongo-csharp-driver/2.0/lib/bootstrap-toggle/bootstrap-toggle.min.js"></script>
<script type="text/javascript" src="/mongo-csharp-driver/2.0/js/dn.js"></script>


<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-K75Z5Q"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push(
{'gtm.start': new Date().getTime(),event:'gtm.js'}
);var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-K75Z5Q');</script>


<script type="text/javascript">
var _elqQ = _elqQ || [];
_elqQ.push(['elqSetSiteId', '413370795']);
_elqQ.push(['elqTrackPageView']);
(function () {
function async_load()
{ var s = document.createElement('script'); s.type = 'text/javascript'; s.async = true; s.src = '//img03.en25.com/i/elqCfg.min.js'; var x = document.getElementsByTagName('script')[0]; x.parentNode.insertBefore(s, x); }
if (window.addEventListener) window.addEventListener('DOMContentLoaded', async_load, false);
else if (window.attachEvent) window.attachEvent('onload', async_load);
})();
</script>

</body>
</html>

