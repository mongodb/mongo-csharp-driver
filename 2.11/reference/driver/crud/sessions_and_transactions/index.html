<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<meta name="author" content="">
<meta name="keyword" content="">

    <link rel="shortcut icon" href="/mongo-csharp-driver/2.11/img/favicon.png">

    <title>Sessions and Transactions</title>

    <link rel="stylesheet" href="/mongo-csharp-driver/2.11/lib/bootstrap.css" type="text/css" />
<link rel="stylesheet" href="/mongo-csharp-driver/2.11/lib/font-awesome/css/font-awesome.min.css" type="text/css" />
<link rel="stylesheet" href="/mongo-csharp-driver/2.11/css/mongodb-docs.css" type="text/css" />
<link rel="stylesheet" href="/mongo-csharp-driver/2.11/css/overrides.css" type="text/css" />
<link rel="stylesheet" href="/mongo-csharp-driver/2.11/lib/highlight/styles/idea.css" />
<link rel="stylesheet" href="/mongo-csharp-driver/2.11/lib/bootstrap-toggle/bootstrap-toggle.min.css" type="text/css" />
<link rel="stylesheet" href="/mongo-csharp-driver/2.11/css/dn.css" type="text/css" />


  </head>

  <body>
  
  <section id="container" class="">
      
      <header id="header-db" class="row" role="navigation">
  <div class="header-content">
    <div class="toggle-nav pull-left">
        <i class="fa fa-bars"></i>
        <div class="icon-reorder tooltips" data-original-title="Toggle Navigation" data-placement="bottom"></div>
    </div>
    
    <div class="logo pull-left">
      <a href="/mongo-csharp-driver/2.11/../">
        <img src="/mongo-csharp-driver/2.11/img/logo-mongodb-header.png", alt="MongoDB.org" />
      </a>
    </div>
    
    <div>
<div class="nav-items pull-right">
  <a href="http://try.mongodb.org/" data-toggle="tooltip" data-placement="bottom" title="Try MongoDB in the browser">Try it Out</a>
  <a href="http://www.mongodb.org/downloads" data-toggle="tooltip" data-placement="bottom" title="Download MongoDB">Downloads</a>
  <a href="http://www.mongodb.org/get-involved" data-toggle="tooltip" data-placement="bottom" title="Get involved with MongoDB">Community</a>
  <a href="http://docs.mongodb.org" data-toggle="tooltip" data-placement="bottom" title="The MongoDB Documentation">Docs</a>
  <a href="http://blog.mongodb.org" data-toggle="tooltip" data-placement="bottom" title="The MongoDB Blog">Blog</a>
  <div id="search">
<form method="get" action="//www.google.com/search" target="_blank">
    <input type="text" name="searchQuery" size="20" value="" autocomplete="off" placeholder="Search docs">
    <input type="hidden" name="site" value="/mongo-csharp-driver/2.11">
    <input type="hidden" name="q" value="">
    <label for="searchQuery"><i class="fa fa-search fa-1"></i></label>
</form>
</div>

</div>
</div>

  </div>
</header>

      

      
<aside id="sidebar" class="sidebar">
    <div class="ssidebar nav-collapse">
      <div class="ssidebarwrapper">
        <h3>
          <a class="index-link" href="/mongo-csharp-driver/2.11/../">MongoDB .NET Driver</a>
          <a class="version pull-right" href="/mongo-csharp-driver/2.11">2.11</a>
        </h3>

        
        <ul class="sidebar-menu">
          
          
          
          
          
          
          
          
          
          
          
          

          
          
            
            









  
    
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
    
      
    
  


          
            
            









  
    
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
    
      
    
  


          
            
            









  
    
    
      
      
        
        
        
        
        
        
        
        









  
    
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  
    
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
    
      
    
  


        
          
        
      
    
    
      
    
  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  
    
    
      
      
        
        
        
        
        
        
        
        









  
    
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
    
      
    
  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  
    
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
    
      
    
  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  
    
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  
  
  
  
  
  
  
  

  
    
    
    
      
      
      
        
        
        
          
        
      
      
    
    
  
  


        
      
    
      
      
        
      
    
    
  


        
      
    
      
      
    
      
      
    
    
  


        
      
    
      
      
    
      
      
    
    
  


          
            
            









  
    
    
      
      
    
      
      
    
      
      
    
      
      
    
      
      
    
    
  


          
            
            









  


          
            
            









  


          
            
            









  


          

          

          
            
            
















<li class="toctree-l1 ">
  <a href="/mongo-csharp-driver/2.11/getting_started/" class="">
      <i class='fa fa-road'></i>
      <span>Getting Started</span>
      <span class="menu-arrow fa fa-angle-right"></span>
  </a>
    <ul >
        
        
        
        
















    <li class="toctree-l2">
    <a href="/mongo-csharp-driver/2.11/getting_started/installation/">
        <i class='fa'></i>
        Installation
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l2">
    <a href="/mongo-csharp-driver/2.11/getting_started/quick_tour/">
        <i class='fa'></i>
        Quick Tour
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l2">
    <a href="/mongo-csharp-driver/2.11/getting_started/admin_quick_tour/">
        <i class='fa'></i>
        Admin Quick Tour
    </a>
  </li>


        
        
    </ul>
  </li>


          
            
            
















<li class="toctree-l1 ">
  <a href="/mongo-csharp-driver/2.11/what_is_new/" class="">
      <i class='fa fa-star'></i>
      <span>What&#39;s New</span>
      <span class="menu-arrow fa fa-angle-right"></span>
  </a>
    <ul >
        
        
        
        
















    <li class="toctree-l2">
    <a href="/mongo-csharp-driver/2.11/upgrading/">
        <i class='fa'></i>
        Upgrading
    </a>
  </li>


        
        
    </ul>
  </li>


          
            
            













  




<li class="toctree-l1  current">
  <a href="/mongo-csharp-driver/2.11/reference/" class="">
      <i class='fa fa-book'></i>
      <span>Reference</span>
      <span class="menu-arrow fa fa-angle-down"></span>
  </a>
    <ul  class="current">
        
        
        
        
















<li class="toctree-l2 ">
  <a href="/mongo-csharp-driver/2.11/reference/bson/" class="">
      <i class='fa'></i>
      <span>BSON</span>
      
  </a>
    <ul >
        
        
        
        
















    <li class="toctree-l3">
    <a href="/mongo-csharp-driver/2.11/reference/bson/bson/">
        <i class='fa'></i>
        BSON/JSON
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l3">
    <a href="/mongo-csharp-driver/2.11/reference/bson/bson_document/">
        <i class='fa'></i>
        BsonDocument
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l3">
    <a href="/mongo-csharp-driver/2.11/reference/bson/serialization/">
        <i class='fa'></i>
        Serialization
    </a>
  </li>


        
        
        
        
        
















<li class="toctree-l3 ">
  <a href="/mongo-csharp-driver/2.11/reference/bson/mapping/" class="">
      <i class='fa'></i>
      <span>Mapping Classes</span>
      
  </a>
    <ul >
        
        
        
        
















    <li class="toctree-l4">
    <a href="/mongo-csharp-driver/2.11/reference/bson/mapping/polymorphism/">
        <i class='fa'></i>
        Polymorphism
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l4">
    <a href="/mongo-csharp-driver/2.11/reference/bson/mapping/conventions/">
        <i class='fa'></i>
        Conventions
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l4">
    <a href="/mongo-csharp-driver/2.11/reference/bson/mapping/schema_changes/">
        <i class='fa'></i>
        Handling Schema Changes
    </a>
  </li>


        
        
    </ul>
  </li>


        
        
    </ul>
  </li>


        
        
        
        
        













  




<li class="toctree-l2  current">
  <a href="/mongo-csharp-driver/2.11/reference/driver/" class="">
      <i class='fa'></i>
      <span>Driver</span>
      
  </a>
    <ul  class="current">
        
        
        
        
















<li class="toctree-l3 ">
  <a href="/mongo-csharp-driver/2.11/reference/driver/connecting/" class="">
      <i class='fa'></i>
      <span>Connecting</span>
      
  </a>
    <ul >
        
        
        
        
















    <li class="toctree-l4">
    <a href="/mongo-csharp-driver/2.11/reference/driver/ssl/">
        <i class='fa'></i>
        SSL
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l4">
    <a href="/mongo-csharp-driver/2.11/reference/driver/authentication/">
        <i class='fa'></i>
        Authentication
    </a>
  </li>


        
        
    </ul>
  </li>


        
        
        
        
        
















<li class="toctree-l3 ">
  <a href="/mongo-csharp-driver/2.11/reference/driver/definitions/" class="">
      <i class='fa'></i>
      <span>Definitions and Builders</span>
      
  </a>
    <ul >
        
        
        
        
















    <li class="toctree-l4">
    <a href="/mongo-csharp-driver/2.11/reference/driver/expressions/">
        <i class='fa'></i>
        Expressions
    </a>
  </li>


        
        
    </ul>
  </li>


        
        
        
        
        
















    <li class="toctree-l3">
    <a href="/mongo-csharp-driver/2.11/reference/driver/admin/">
        <i class='fa'></i>
        Administration
    </a>
  </li>


        
        
        
        
        













  




<li class="toctree-l3  current">
  <a href="/mongo-csharp-driver/2.11/reference/driver/crud/" class="">
      <i class='fa'></i>
      <span>Reading and Writing</span>
      
  </a>
    <ul  class="current">
        
        
        
        
















    <li class="toctree-l4">
    <a href="/mongo-csharp-driver/2.11/reference/driver/crud/reading/">
        <i class='fa'></i>
        Reading
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l4">
    <a href="/mongo-csharp-driver/2.11/reference/driver/crud/linq/">
        <i class='fa'></i>
        LINQ
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l4">
    <a href="/mongo-csharp-driver/2.11/reference/driver/crud/writing/">
        <i class='fa'></i>
        Writing
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l4">
    <a href="/mongo-csharp-driver/2.11/reference/driver/crud/compression/">
        <i class='fa'></i>
        Compression
    </a>
  </li>


        
        
        
        
        













  




    <li class="toctree-l4">
    <a href="/mongo-csharp-driver/2.11/reference/driver/crud/sessions_and_transactions/">
        <i class='fa'></i>
        Sessions and Transactions
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l4">
    <a href="/mongo-csharp-driver/2.11/reference/driver/crud/client_side_encryption/">
        <i class='fa fa-lock'></i>
        Client-Side Encryption
    </a>
  </li>


        
        
    </ul>
  </li>


        
        
        
        
        
















    <li class="toctree-l3">
    <a href="/mongo-csharp-driver/2.11/reference/driver/change_streams/">
        <i class='fa'></i>
        Change Streams
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l3">
    <a href="/mongo-csharp-driver/2.11/reference/driver/error_handling/">
        <i class='fa'></i>
        Error Handling
    </a>
  </li>


        
        
    </ul>
  </li>


        
        
        
        
        
















<li class="toctree-l2 ">
  <a href="/mongo-csharp-driver/2.11/reference/driver_core/" class="">
      <i class='fa'></i>
      <span>Driver Core</span>
      
  </a>
    <ul >
        
        
        
        
















<li class="toctree-l3 ">
  <a href="/mongo-csharp-driver/2.11/reference/driver_core/events/" class="">
      <i class='fa'></i>
      <span>Eventing</span>
      
  </a>
    <ul >
        
        
        
        
















    <li class="toctree-l4">
    <a href="/mongo-csharp-driver/2.11/reference/driver_core/sdamevents/">
        <i class='fa'></i>
        SDAM Events
    </a>
  </li>


        
        
    </ul>
  </li>


        
        
    </ul>
  </li>


        
        
        
        
        
















<li class="toctree-l2 ">
  <a href="/mongo-csharp-driver/2.11/reference/gridfs/" class="">
      <i class='fa'></i>
      <span>GridFS</span>
      
  </a>
    <ul >
        
        
        
        
















    <li class="toctree-l3">
    <a href="/mongo-csharp-driver/2.11/reference/gridfs/gettingstarted/">
        <i class='fa'></i>
        Getting Started
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l3">
    <a href="/mongo-csharp-driver/2.11/reference/gridfs/uploadingfiles/">
        <i class='fa'></i>
        Uploading Files
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l3">
    <a href="/mongo-csharp-driver/2.11/reference/gridfs/downloadingfiles/">
        <i class='fa'></i>
        Downloading Files
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l3">
    <a href="/mongo-csharp-driver/2.11/reference/gridfs/findingfiles/">
        <i class='fa'></i>
        Finding Files
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l3">
    <a href="/mongo-csharp-driver/2.11/reference/gridfs/deletingandrenamingfiles/">
        <i class='fa'></i>
        Deleting and Renaming Files
    </a>
  </li>


        
        
    </ul>
  </li>


        
        
    </ul>
  </li>


          
            
            
















<li class="toctree-l1 ">
  <a href="/mongo-csharp-driver/2.11/examples/" class="">
      <i class='fa fa-code'></i>
      <span>Examples</span>
      <span class="menu-arrow fa fa-angle-right"></span>
  </a>
    <ul >
        
        
        
        
















    <li class="toctree-l2">
    <a href="/mongo-csharp-driver/2.11/examples/exporting_json/">
        <i class='fa'></i>
        Exporting JSON
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l2">
    <a href="/mongo-csharp-driver/2.11/examples/importing_json/">
        <i class='fa'></i>
        Importing JSON
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l2">
    <a href="/mongo-csharp-driver/2.11/examples/mixing_static_and_dynamic/">
        <i class='fa'></i>
        Mixing Static and Dynamic Data
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l2">
    <a href="/mongo-csharp-driver/2.11/examples/tailable_cursor/">
        <i class='fa'></i>
        Using a Tailable Cursor
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l2">
    <a href="/mongo-csharp-driver/2.11/examples/user_management/">
        <i class='fa'></i>
        Managing Users
    </a>
  </li>


        
        
    </ul>
  </li>


          
            
            
















    <li class="toctree-l1">
    <a href="/mongo-csharp-driver/2.11/apidocs/">
        <i class='fa fa-file-text-o'></i>
        API Documentation
    </a>
  </li>


          
            
            
















    <li class="toctree-l1">
    <a href="https://github.com/mongodb/mongo-csharp-driver/tree/master">
        <i class='fa fa-github'></i>
        Source Code
    </a>
  </li>


          
            
            
















    <li class="toctree-l1">
    <a href="/mongo-csharp-driver/2.11/issues_help/">
        <i class='fa fa-life-ring'></i>
        Issues &amp; Help
    </a>
  </li>


          
        </ul>
        
    </div>
  </div>
  
</aside>

<div class="option-popup closed hidden" id="optionsVersionsPopup">
<div class="option-header">
  <i class="fa fa-gear"></i>
  <span>OPTIONS</span>
  <i class="fa fa-angle-up pull-right"></i>
</div>
<div class="option-body">
  <ul>
      
      <li>
        <label>Version</label>
        <div class="btn-group btn-group-xs pull-right">
          <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
            Select Version <span class="caret"></span>
          </button>
          <ul class="dropdown-menu" role="menu" id="optionsVersionsMenu">
          </ul>
        </div>
      </li>

   


    

  </ul>
</div>
</div>



      
      <section id="main-content" class="content">
          <section class="main-column pull-left">
            <div class="document">
              <div class="documentwrapper">
                <div class="bodywrapper">
                  <div class="body">


   
<a class="edit-link" href="https://github.com/mongodb/mongo-csharp-driver/blob/master/docs/reference/content/reference%5cdriver%5ccrud%5csessions_and_transactions.md" target="_blank" title="Edit reference\driver\crud\sessions_and_transactions.md on GitHub"><i class="fa fa-pencil-square-o"></i></a>










<div class="bc">
<ul>
  
  
  
  <li><a href="/mongo-csharp-driver/2.11/reference/">Reference</a> <i class="fa fa-angle-right"></i></li>
  <li><a href="/mongo-csharp-driver/2.11/reference/driver/">Driver</a> <i class="fa fa-angle-right"></i></li>
  <li><a href="/mongo-csharp-driver/2.11/reference/driver/crud/">Reading and Writing</a> <i class="fa fa-angle-right"></i></li>
  <li>Sessions and Transactions</li>
</ul>
</div>




<h2 id="sessions">Sessions</h2>

<p>A session is used to group together a series of operations that are related to each other and should be executed with the same session options. Sessions are also used for transactions.</p>

<p>New overloaded methods that take a session parameter have been added for all operation methods in the driver. You execute multiple operations in the same session by passing the same session value to each operation.</p>

<p>When you call an older operation method that does not take a session parameter, the driver will start an implicit session to execute that one operation and then immediately end the implicit session.</p>

<h3 id="startsession-and-startsessionasync">StartSession and StartSessionAsync</h3>

<pre><code class="language-csharp">IClientSessionHandle StartSession(ClientSessionOptions options = null, CancellationToken cancellationToken = default(CancellationToken));
Task&lt;IClientSessionHandle&gt; StartSessionAsync(ClientSessionOptions options = null, CancellationToken cancellationToken = default(CancellationToken));
</code></pre>

<p>A session is started by calling the StartSession or StartSessionAsync methods of IMongoClient:</p>

<p>You must end a session when you no longer need it. You end a session by calling Dispose, which will happen automatically if you put the session inside a using statement.</p>

<p>The recommended way of using a session is:</p>

<pre><code class="language-csharp">var sessionOptions = new ClientSessionOptions { ... };
using (var session = client.StartSession(sessionOptions, cancellationToken))
{
    // execute some operations passing the session as an argument to each operation
}
</code></pre>

<p>or</p>

<pre><code class="language-csharp">var sessionOptions = new ClientSessionOptions { ... };
using (var session = await client.StartSessionAsync(sessionOptions, cancellationToken))
{
    // execute some operations passing the session as an argument to each operation
}
</code></pre>

<p>A session is typically short lived. You start a session, execute some operations, and end the session.</p>

<h3 id="clientsessionoptions">ClientSessionOptions</h3>

<p>The ClientSessionOptions class is used to specify any desired options when calling StartSession.</p>

<pre><code class="language-csharp">public class ClientSessionOptions
{
    public bool? CausalConsistency { get; set; }
    public TransactionOptions DefaultTransactionOptions { get; set; }
}
</code></pre>

<h4 id="causalconsistency">CausalConsistency</h4>

<p>Set to true if you want all operations in a session to be causally consistent.</p>

<h4 id="defaulttransactionoptions">DefaultTransactionOptions</h4>

<p>You can provide default transaction options to be used for any options that are not provided when StartTransaction is called.</p>

<h3 id="iclientsession-properties-and-methods">IClientSession properties and methods</h3>

<p>The IClientSession interface defines the properties and methods available on a session.</p>

<pre><code class="language-csharp">public interface IClientSession : IDisposable
{
    IMongoClient Client { get; }
    BsonDocument ClusterTime { get; }
    bool IsInTransaction { get; }
    BsonTimestamp OperationTime { get; }
    ClientSessionOptions Options { get; }

    void AdvanceClusterTime(BsonDocument newClusterTime);
    void AdvanceOperationTime(BsonTimestamp newOperationTime);

    // see also transaction related methods documented below
}
</code></pre>

<p>Note: a few members of IClientSession have been deliberately omitted from this documentation, either because they are rarely used or because they are for internal use only.</p>

<h4 id="client">Client</h4>

<p>The Client property returns a reference to the IMongoClient instance that was used to start this session.</p>

<h4 id="clustertime">ClusterTime</h4>

<p>The ClusterTime property returns the highest cluster time that has been seen by this client. The value is an opaque BsonDocument containing a cluster time that has been returned by the server. While an application might never inspect the actual value, it might set this value (by calling AdvanceClusterTime) when initializing a causally consistent session.</p>

<h3 id="isintransaction">IsInTransaction</h3>

<p>Specifies whether the session is currently in a transaction. A session is in a transaction after StartTransaction has been called and until either AbortTransaction or CommitTransaction has been called.</p>

<h3 id="operationtime">OperationTime</h3>

<p>The operation time returned by the server for the most recent operation in this session. Operation times are used by the driver to ensure causal consistency when the ClientSessionOptions specify that causal consistency is desired. While an application might never use the actual value, it might set this value (by calling AdvanceOperationTime) when initializing a causally consistent session.</p>

<h3 id="options">Options</h3>

<p>Returns the options that were passed to StartSession.</p>

<h3 id="advanceclustertime-and-advanceoperationtime">AdvanceClusterTime and AdvanceOperationTime</h3>

<pre><code class="language-csharp">void AdvanceClusterTime(BsonDocument newClusterTime);
void AdvanceOperationTime(BsonTimestamp newOperationTime);
</code></pre>

<p>Call these methods to advance the cluster and operation times when you want subsequent operations in this session to be causally consistent with operations that have executed outside of this session. Typically the values you pass to AdvanceClusterTime and AdvanceOperation time will come from the ClusterTime and OperationTime properties of some other session.</p>

<h3 id="transaction-methods">Transaction methods</h3>

<p>The methods to start, abort or commit a transaction are documented in the next section.</p>

<h2 id="transactions">Transactions</h2>

<p>Transactions are started, committed or aborted using methods of IClientSession. A session can only execute one transaction at a time, but a session can execute more than one transaction as long as each transaction is committed or aborted before the next one is started.</p>

<h3 id="starttransaction">StartTransaction</h3>

<pre><code class="language-csharp">void StartTransaction(TransactionOptions transactionOptions = null);
</code></pre>

<p>Start a transaction by calling StartTransaction, optionally specifying options for the transaction.</p>

<p>Each transaction option can be specified at any of the following levels:</p>

<ol>
<li>StartTransaction in the options parameter</li>
<li>StartSession in the defaultTransactionOptions parameter</li>
<li>Defaulted</li>
</ol>

<p>You can specify different options at different levels. An option specified in StartTransaction overrides the same option specified in the defaultTransactionOptions passed to StartSession, which in turn overrides the default value.</p>

<h4 id="transactionoptions">TransactionOptions</h4>

<pre><code class="language-csharp">public class TransactionOptions
{
    public ReadConcern ReadConcern { get; };
    public ReadPreference ReadPreference { get; };
    public WriteConcern WriteConcern { get; };

    public TransactionOptions(
        Optional&lt;ReadConcern&gt; readConcern = default(Optional&lt;ReadConcern&gt;),
        Optional&lt;ReadPreference&gt; readPreference = default(Optional&lt;ReadPreference&gt;),
        Optional&lt;WriteConcern&gt; writeConcern = default(Optional&lt;WriteConcern&gt;));

    public TransactionOptions With(
        Optional&lt;ReadConcern&gt; readConcern = default(Optional&lt;ReadConcern&gt;),
        Optional&lt;ReadPreference&gt; readPreference = default(Optional&lt;ReadPreference&gt;),
        Optional&lt;WriteConcern&gt; writeConcern = default(Optional&lt;WriteConcern&gt;))
}
</code></pre>

<p>Create an instance of TransactionOptions either by calling the constructor with any desired optional arguments, or by calling the With method on an existing instance of TransactionOptions to create a new instance with some values changed.</p>

<h5 id="readconcern">ReadConcern</h5>

<p>The ReadConcern used while in the transaction. All operations in the transaction use the ReadConcern specified when StartTransaction is called.</p>

<h5 id="readpreference">ReadPreference</h5>

<p>The ReadPreference used while in the transaction. Currently, the ReadPreference for a transaction must be Primary.</p>

<h5 id="writeconcern">WriteConcern</h5>

<p>The WriteConcern used for this transaction. The WriteConcern only applies when committing the transaction, not to the individual operations executed while in the transaction.</p>

<h3 id="committransaction-and-committransactionasync">CommitTransaction and CommitTransactionAsync</h3>

<pre><code class="language-csharp">void CommitTransaction(CancellationToken cancellationToken = default(CancellationToken));
Task CommitTransactionAsync(CancellationToken cancellationToken = default(CancellationToken));
</code></pre>

<p>You must call CommitTransaction or CommitTransactionAsync in order for a transaction to be committed. If a session is ended while a transaction is in progress the transaction will be automatically aborted.</p>

<p>The commit is executed with the WriteConcern specified by the transaction options.</p>

<h3 id="aborttransaction-and-aborttransactionasync">AbortTransaction and AbortTransactionAsync</h3>

<pre><code class="language-csharp">void AbortTransaction(CancellationToken cancellationToken = default(CancellationToken));
Task AbortTransactionAsync(CancellationToken cancellationToken = default(CancellationToken));
</code></pre>

<p>Call AbortTransaction or AbortTransactionAsync to abort a transaction. Since any transaction in progress is automatically aborted when a session is ended, you can also implicitly abort an uncommitted transaction by simply ending the session.</p>

<p>In this example we rely on the implied transaction abort:</p>

<pre><code class="language-csharp">using (var session = client.StartSession())
{
    session.StartTransaction();
    // execute operations using the session
    session.CommitTransaction(); // if an exception is thrown before reaching here the transaction will be implicitly aborted
}
</code></pre>

<p>When writing an async program you may want to avoid using the implied abort transaction that occurs when Dispose is called on a session with a transaction in progress, because Dispose is a blocking operation. To be fully async, even in the case where the transaction needs to be aborted, you might instead write:</p>

<pre><code class="language-csharp">using (var session = await client.StartSessionAsync())
{
    try
    {
        // execute async operations using the session
    }
    catch
    {
        await session.AbortTransactionAsync(); // now Dispose on the session has nothing to do and won't block
        throw;
    }
    await session.CommitTransactionAsync();
}
</code></pre>






<div id="btnv">
  
  <div class="pull-left">
  <a class="navigation prev" href="/mongo-csharp-driver/2.11/reference/driver/crud/compression/">
      <i class="fa fa-long-arrow-left"> </i> Compression
  </a>
  </div>
  
  
  <div class="pull-right">
  <a class="navigation next" href="/mongo-csharp-driver/2.11/reference/driver/crud/client_side_encryption/">
    Client-Side Encryption <i class="fa fa-long-arrow-right"> </i>
  </a>
  
</div>
</div>


</div>
<div class="right-column">
<div class="wrapper">
  
  <div class="toc">
    <span class="toc-header">On this page</span>
    <nav id="TableOfContents">
<ul>
<li>
<ul>
<li><a href="#sessions">Sessions</a>
<ul>
<li><a href="#startsession-and-startsessionasync">StartSession and StartSessionAsync</a></li>
<li><a href="#clientsessionoptions">ClientSessionOptions</a>
<ul>
<li><a href="#causalconsistency">CausalConsistency</a></li>
<li><a href="#defaulttransactionoptions">DefaultTransactionOptions</a></li>
</ul></li>
<li><a href="#iclientsession-properties-and-methods">IClientSession properties and methods</a>
<ul>
<li><a href="#client">Client</a></li>
<li><a href="#clustertime">ClusterTime</a></li>
</ul></li>
<li><a href="#isintransaction">IsInTransaction</a></li>
<li><a href="#operationtime">OperationTime</a></li>
<li><a href="#options">Options</a></li>
<li><a href="#advanceclustertime-and-advanceoperationtime">AdvanceClusterTime and AdvanceOperationTime</a></li>
<li><a href="#transaction-methods">Transaction methods</a></li>
</ul></li>
<li><a href="#transactions">Transactions</a>
<ul>
<li><a href="#starttransaction">StartTransaction</a>
<ul>
<li><a href="#transactionoptions">TransactionOptions</a>
<ul>
<li><a href="#readconcern">ReadConcern</a></li>
<li><a href="#readpreference">ReadPreference</a></li>
<li><a href="#writeconcern">WriteConcern</a></li>
</ul></li>
</ul></li>
<li><a href="#committransaction-and-committransactionasync">CommitTransaction and CommitTransactionAsync</a></li>
<li><a href="#aborttransaction-and-aborttransactionasync">AbortTransaction and AbortTransactionAsync</a></li>
</ul></li>
</ul></li>
</ul>
</nav>
  </div>
  
</div>
</div>

</div>
</div>
</div>
</section>
</section>

</section>


<script type="text/javascript">
  var DOCUMENTATION_OPTIONS = {
   URL_ROOT:    "/mongo-csharp-driver/2.11",
   VERSION:     "2.11",
   COLLAPSE_INDEX: false,
   FILE_SUFFIX: '.html',
   HAS_SOURCE:  true
  };
</script>
<script type="text/javascript" src="/mongo-csharp-driver/2.11/js/jquery.js"></script>
<script type="text/javascript" src="/mongo-csharp-driver/2.11/lib/bootstrap.js"></script>
<script type="text/javascript" src="/mongo-csharp-driver/2.11/js/navbar.js"></script>
<script type="text/javascript" src="/mongo-csharp-driver/2.11/lib/highlight/highlight.pack.js"></script>
<script type="text/javascript" src="/mongo-csharp-driver/2.11/js/scripts.js"></script>
<script type="text/javascript" src="/mongo-csharp-driver/2.11/lib/bootstrap-toggle/bootstrap-toggle.min.js"></script>
<script type="text/javascript" src="/mongo-csharp-driver/2.11/js/dn.js"></script>


<noscript><iframe src="//www.googletagmanager.com/ns.html?id=GTM-K75Z5Q"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push(
{'gtm.start': new Date().getTime(),event:'gtm.js'}
);var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-K75Z5Q');</script>


<script type="text/javascript">
var _elqQ = _elqQ || [];
_elqQ.push(['elqSetSiteId', '413370795']);
_elqQ.push(['elqTrackPageView']);
(function () {
function async_load()
{ var s = document.createElement('script'); s.type = 'text/javascript'; s.async = true; s.src = '//img03.en25.com/i/elqCfg.min.js'; var x = document.getElementsByTagName('script')[0]; x.parentNode.insertBefore(s, x); }
if (window.addEventListener) window.addEventListener('DOMContentLoaded', async_load, false);
else if (window.attachEvent) window.attachEvent('onload', async_load);
})();
</script>

</body>
</html>

